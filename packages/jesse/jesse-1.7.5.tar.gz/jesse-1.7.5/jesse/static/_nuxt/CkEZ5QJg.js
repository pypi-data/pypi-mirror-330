import{_ as qe}from"./CESrXLPU.js";import{r as Ae,_ as Fe,a as He,b as Ye,c as Je,d as Qe,e as Ge}from"./Czzf8L1y.js";import{g as ee,h as Ee,i as j,r as R,j as K,k as ke,l as ze,c as m,o as a,F as W,b as s,m as pe,n as Ze,t as w,p as xe,q as z,w as S,d as r,s as Xe,v as Ve,x as _e,y as Ue,z as h,A as l,B as N,C as B,D as re,E as Se,G as Ke,H as Oe,I as ie,e as ye,J as he,K as Me,L as X,M as ce,N as je,O as Pe,P as et,Q as tt,R as st,S as ot,T as lt,U as ne,V as rt,W as at,X as nt,Y as it,Z as fe,$ as dt,a0 as ut,a1 as ct,a2 as ft}from"./Bxvlha2F.js";import{_ as mt}from"./CL1NekgX.js";import{_ as pt}from"./BqjHQvxc.js";import{T as we,s as me,l as Te,d as Le,_ as vt}from"./3fwocQef.js";import{_ as gt}from"./DBajIjv_.js";import{u as bt}from"./Blgg-j9U.js";import"./BHUS0Dxb.js";import"./CUpjPPUh.js";const Re={width:800,height:400,priceScale:{borderColor:"rgba(197, 203, 206, 1)"},timeScale:{borderColor:"rgba(197, 203, 206, 1)",timeVisible:!0,secondsVisible:!1}},yt={chart:{layout:{background:{color:"#ffffff"},textColor:"rgba(33, 56, 77, 1)"},grid:{vertLines:{color:"#f1f1f1",visible:!0},horzLines:{color:"#f1f1f1",visible:!0}},priceScale:{borderColor:"rgba(197, 203, 206, 0.6)"},timeScale:{borderColor:"rgba(197, 203, 206, 0.6)",timeVisible:!0,secondsVisible:!1}}},ht={chart:{layout:{background:{color:"#333333"},textColor:"#D1D5DB"},grid:{vertLines:{color:"#525252",visible:!0},horzLines:{color:"#525252",visible:!0}},priceScale:{borderColor:"#525252"},timeScale:{borderColor:"#525252",timeVisible:!0,secondsVisible:!1}}},wt={class:"mt-2"},kt={class:"ml-2"},xt=ee({__name:"EquityCurve",props:{data:{}},setup(O){const d=Ee(),p=j(()=>d.value),f=R();let n=null,b=[];const u=O;K(u.data,g=>{}),K(p,g=>{k(g)}),ke(async()=>{await t()});async function t(){Re.width=f.value.clientWidth,n=we(f.value,Re);for(const g of u.data){const i=n.addLineSeries({lineWidth:2});i.setData(g.data),b.push(i)}n.timeScale().fitContent(),k(p.value)}ze(()=>{v()});function v(){n!==null&&(n.remove(),n=null),b&&(b=[])}function k(g){n===null||b===null||n.applyOptions(g==="light"?yt.chart:ht.chart)}return(g,i)=>(a(),m(W,null,[s("div",{ref_key:"chartContainer",ref:f,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),s("div",wt,[(a(!0),m(W,null,pe(g.data,x=>(a(),m("span",{key:x.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[s("span",{class:"inline-block",style:Ze({backgroundColor:x.color,width:"25px",height:"10px"})},null,4),s("span",kt,w(x.name),1)]))),128))])],64))}}),_t={class:"flex items-center justify-between"},Ct=ee({__name:"FullscreenModal",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(O){const d=xe(O,"modelValue");return(p,f)=>{const n=_e,b=Xe,u=Ue;return a(),z(u,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=t=>d.value=t),fullscreen:""},{default:S(()=>[r(b,{ui:{base:"h-full flex flex-col",rounded:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",body:{base:"grow"}}},{header:S(()=>[s("div",_t,[s("div",null,[Ve(p.$slots,"title")]),r(n,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:f[0]||(f[0]=t=>d.value=!1)})])]),default:S(()=>[Ve(p.$slots,"default")]),_:3})]),_:3},8,["modelValue"])}}}),$t={class:"w-16 overflow-hidden"},Vt={class:"w-8 overflow-hidden"},St={key:0,class:"w-full transition-all overflow-hidden duration-300 bg-gray-50 dark:bg-gray-800"},jt=["onClick"],Tt={class:"w-16 overflow-hidden text-center"},Lt={class:"w-12 overflow-hidden text-center"},Rt={class:"w-8 overflow-hidden text-center"},Et={class:"p-4"},zt={class:"mt-4"},Ut={class:"w-full text-sm"},Ot={class:"w-full"},Mt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Pt={class:"w-full flex justify-between py-2 px-4"},It={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Dt={class:"w-full flex justify-between py-2 px-4"},Nt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Bt={class:"w-full flex justify-between py-2 px-4"},Wt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},qt={class:"w-full flex justify-between py-2 px-4"},At={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Ft={class:"w-full"},Ht={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Yt={class:"w-full flex justify-between py-2 px-4"},Jt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Qt={key:0,class:"w-full flex justify-between py-2 px-4"},Gt={key:1,class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Zt={key:2,class:"w-full flex justify-between py-2 px-4"},Xt={class:"flex justify-end mt-4"},Kt=ee({__name:"ChartOrders",props:{trade:{}},emits:["zoom"],setup(O,{emit:d}){const p=d,f=R(null),n=R(!1),b=R(!1);return(u,t)=>{const v=Ke,k=_e,g=Ue;return a(),m(W,null,[r(k,{variant:"ghost",color:"gray",class:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 text-xs border-b border-gray-100 dark:border-gray-800 rounded-none p-2",onClick:t[1]||(t[1]=i=>b.value=!l(b))},{default:S(()=>[s("div",{class:N(["w-2 transition-all duration-300",[l(b)?"rotate-90":"rotate-0"]])},t[4]||(t[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})],-1)]),2),s("div",$t,w(l(B).roundPrice(u.trade.entry_price)),1),t[5]||(t[5]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:N(["w-16 overflow-hidden",u.trade.type.toLowerCase()==="long"?"text-green-500":"text-red-500"])},w(l(re).round(u.trade.qty,2)),3),t[6]||(t[6]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:N([[u.trade.PNL_percentage>0?"text-green-500":"text-red-500"],"w-16 overflow-hidden text-xs"])},w(l(re).round(u.trade.PNL_percentage,2))+"% ",3),t[7]||(t[7]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Vt,[r(k,{color:"gray",size:"xs",onClick:t[0]||(t[0]=Se(i=>p("zoom",u.trade.orders[0].id),["stop"]))},{default:S(()=>[r(v,{name:"i-heroicons-arrow-right"})]),_:1})])]),_:1}),l(b)?(a(),m("div",St,[t[12]||(t[12]=Oe('<div class="flex justify-between items-center border-b-2 border-gray-200 dark:border-gray-700 px-1 py-2 text-xs"><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PRICE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-12 overflow-hidden italic font-bold uppercase text-center">TYPE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">SIDE</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(a(!0),m(W,null,pe(u.trade.orders,(i,x)=>(a(),m("div",{key:x,class:"w-full flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-900 text-xs py-2 border-b border-gray-200 cursor-pointer dark:border-gray-700 px-1",onClick:E=>{f.value=i,n.value=!0}},[s("div",Tt,w(l(B).roundPrice(i.price)),1),t[8]||(t[8]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:N(["w-10 overflow-hidden text-center",i.side==="buy"?"text-green-500":"text-red-500"])},w(l(re).round(i.qty,2)),3),t[9]||(t[9]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Lt,w(i.type),1),t[10]||(t[10]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:N([[i.side==="buy"?"text-green-500":"text-red-500"],"w-10 overflow-hidden text-center"])},w(i.side.toUpperCase()),3),t[11]||(t[11]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Rt,[r(k,{color:"gray",size:"xs",onClick:Se(E=>p("zoom",i.id),["stop"])},{default:S(()=>[r(v,{name:"i-heroicons-arrow-right"})]),_:2},1032,["onClick"])])],8,jt))),128))])):h("",!0),r(g,{modelValue:l(n),"onUpdate:modelValue":t[3]||(t[3]=i=>ie(n)?n.value=i:null)},{default:S(()=>{var i,x,E,U,F,te,q,A,H,Y,se;return[s("div",Et,[s("div",zt,[s("div",Ut,[t[28]||(t[28]=s("h2",{class:"text-lg mb-2 font-bold italic dark:text-white text-center"}," Trade ",-1)),s("div",Ot,[s("div",Mt,[t[13]||(t[13]=s("div",{class:"font-bold"},"Entry Price",-1)),s("div",null,w(l(B).roundPrice(u.trade.entry_price)),1)]),s("div",Pt,[t[14]||(t[14]=s("div",{class:"font-bold"},"Exit Price",-1)),s("div",null,w(l(B).roundPrice(u.trade.exit_price)),1)]),s("div",It,[t[15]||(t[15]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,w(u.trade.qty),1)]),s("div",Dt,[t[16]||(t[16]=s("div",{class:"font-bold"},"Size",-1)),s("div",null,w(l(B).roundPrice(u.trade.size)),1)]),s("div",Nt,[t[17]||(t[17]=s("div",{class:"font-bold"},"PNL",-1)),s("div",{class:N([u.trade.PNL>0?"text-green-500":"text-red-500"])},w(l(re).round(u.trade.PNL,2))+" ("+w(l(re).round(u.trade.PNL_percentage,2))+"%) ",3)]),s("div",Bt,[t[18]||(t[18]=s("div",{class:"font-bold"},"Fee",-1)),s("div",null,w(l(re).round(u.trade.fee,2)),1)]),s("div",Wt,[t[19]||(t[19]=s("div",{class:"font-bold"},"Holding Period",-1)),s("div",null,w(l(B).secondsToHumanReadable(u.trade.holding_period)),1)]),s("div",qt,[t[20]||(t[20]=s("div",{class:"font-bold"},"Opened At",-1)),s("div",null,w(new Date(u.trade.opened_at).toLocaleString()),1)]),s("div",At,[t[21]||(t[21]=s("div",{class:"font-bold"},"Closed At",-1)),s("div",null,w(new Date(u.trade.closed_at).toLocaleString()),1)])]),t[29]||(t[29]=s("h2",{class:"text-lg font-bold italic dark:text-white mt-6 mb-2 text-center"}," Order ",-1)),s("div",Ft,[s("div",Ht,[t[22]||(t[22]=s("div",{class:"font-bold"},"Side",-1)),s("div",{class:N([((i=l(f))==null?void 0:i.side)==="buy"?"text-green-500":"text-red-500"])},w((E=(x=l(f))==null?void 0:x.side)==null?void 0:E.toUpperCase()),3)]),s("div",Yt,[t[23]||(t[23]=s("div",{class:"font-bold"},"Type",-1)),s("div",null,w((U=l(f))==null?void 0:U.type),1)]),s("div",Jt,[t[24]||(t[24]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,w((F=l(f))==null?void 0:F.qty),1)]),(te=l(f))!=null&&te.created_at?(a(),m("div",Qt,[t[25]||(t[25]=s("div",{class:"font-bold"},"Created At",-1)),s("div",null,w(new Date((q=l(f))==null?void 0:q.created_at).toLocaleString()),1)])):h("",!0),(A=l(f))!=null&&A.executed_at?(a(),m("div",Gt,[t[26]||(t[26]=s("div",{class:"font-bold"},"Executed At",-1)),s("div",null,w(new Date((H=l(f))==null?void 0:H.executed_at).toLocaleString()),1)])):h("",!0),(Y=l(f))!=null&&Y.canceled_at?(a(),m("div",Zt,[t[27]||(t[27]=s("div",{class:"font-bold"},"Canceled At",-1)),s("div",null,w(new Date((se=l(f))==null?void 0:se.canceled_at).toLocaleString()),1)])):h("",!0)])]),s("div",Xt,[r(k,{color:"gray",block:"",onClick:t[2]||(t[2]=de=>n.value=!1)},{default:S(()=>t[30]||(t[30]=[ye(" Close ")])),_:1})])])])]}),_:1},8,["modelValue"])],64)}}}),es={class:"w-0 sidebar whitespace-nowrap relative transition-all duration-300"},ts={key:1,class:"h-full flex justify-center items-center text-xs text-gray-500"},ss=ee({__name:"ChartSidebar",props:he({items:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:he(["zoom"],["update:modelValue"]),setup(O,{emit:d}){const p=xe(O,"modelValue"),f=d;return(n,b)=>{const u=Kt;return a(),m("div",es,[s("div",{class:N([p.value?"w-96 p-2":"w-0 p-0","absolute h-full overflow-y-auto border-r-2 dark:border-gray-800 transition-all duration-300 z-0"])},[n.items.length>0?(a(),m(W,{key:0},[b[1]||(b[1]=Oe('<div class="flex justify-between items-center border-b-2 p-2 text-xs dark:border-gray-800"><div class="w-2"></div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">ENTRY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PNL</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(a(!0),m(W,null,pe(n.items,(t,v)=>(a(),m("div",{key:v,class:"w-full"},[r(u,{trade:t,onZoom:b[0]||(b[0]=k=>f("zoom",k))},null,8,["trade"])]))),128))],64)):(a(),m("div",ts," No trades were executed "))],2)])}}}),os={class:"w-full h-full flex justify-between border-2 border-gray-200 dark:border-gray-800 rounded-lg"},ls={class:"w-full flex flex-col h-full border dark:border-gray-800"},rs={key:0},as=ee({__name:"BacktestCandlesChart",props:he({form:{},results:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(O){const d=Ee(),p=R(2),f=xe(O,"modelValue"),n=O,b=R(),u=R([]);let t=null,v=null;const k=[],g=[],i=j(()=>Me().params.id),x=j(()=>X.extraChartLines[i.value].find(y=>y.symbol===n.results.selectedRoute.symbol)),E=j(()=>d.value),U=j(()=>de());K(E,y=>{Y(y)}),K(()=>n.results.selectedRoute.symbol,()=>{H(),setTimeout(async()=>{await F()},100)}),ke(async()=>{setTimeout(async()=>{await F()},200)}),K(f,()=>{setTimeout(()=>{te()},300)});async function F(){var oe,G,le,M;me.width=b.value.clientWidth,me.height=b.value.clientHeight-Object.keys(x.value.charts).length*150,t=we(b.value,me),t.applyOptions({rightPriceScale:{borderColor:E.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${n.results.selectedRoute.symbol} • ${n.results.selectedRoute.timeframe}`}}),v=t.addCandlestickSeries();const y=X.candles[i.value].find(e=>e.symbol===n.results.selectedRoute.symbol).candles;v.setData(y),v.setMarkers(X.orders[i.value].find(e=>e.symbol===n.results.selectedRoute.symbol).orders);const _=String(y[0].open).indexOf("."),C=_===-1?0:String(y[y.length-1].open).length-_-1;p.value!==C&&(p.value=C,(p.value<0||p.value>100)&&(p.value=0),v.applyOptions({priceFormat:{type:"price",precision:p.value,minMove:Math.pow(10,-p.value).toFixed(p.value)}}));const V=(G=(oe=X.lines[i.value])==null?void 0:oe.find(e=>e.symbol===n.results.selectedRoute.symbol))==null?void 0:G.lines;if(V)for(const e of Object.keys(V)){const o=V[e];t.addLineSeries({lineWidth:1,title:e}).setData(o.data)}const J=(M=(le=X.horizontalLines[i.value])==null?void 0:le.find(e=>e.symbol===n.results.selectedRoute.symbol))==null?void 0:M.lines;if(J)for(const e of Object.keys(J)){const T=J[e];v.createPriceLine(T)}t.timeScale().fitContent();const Q=new Set;Object.keys(x.value.charts).forEach((e,o)=>{const T={...me};T.width=u.value[o].clientWidth,T.height=150;const L=we(u.value[o],T);k.push(L),Object.keys(x.value.charts[e]).forEach(I=>{var ue,ae;const P=L.addLineSeries({lineWidth:1,title:I}),$=(ae=(ue=X.horizontalExtraLines[i.value])==null?void 0:ue.find(D=>D.symbol===n.results.selectedRoute.symbol))==null?void 0:ae.lines[e];if($&&!Q.has(e)){for(const D of Object.keys($)){const ge=$[D];P.createPriceLine(ge)}Q.add(e)}P.setData(x.value.charts[e][I].data),g.push(P)}),L.applyOptions({rightPriceScale:{borderColor:E.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:e}}),L.timeScale().subscribeVisibleLogicalRangeChange(I=>{t.timeScale().setVisibleLogicalRange(I)}),o!==Object.keys(x.value.charts).length-1&&L.timeScale().applyOptions({visible:!1})}),t.subscribeCrosshairMove(e=>{const o=q(v,e);Object.keys(x.value.charts).forEach((T,L)=>{A(k[L],g[L],o)})}),Object.keys(x.value.charts).forEach((e,o)=>{k[o].subscribeCrosshairMove(T=>{const L=q(g[o],T);A(t,v,L),k.forEach((I,P)=>{P!==o&&A(I,g[P],L)})})}),t.timeScale().subscribeVisibleLogicalRangeChange(e=>{k.forEach(o=>{o.timeScale().setVisibleLogicalRange(e)})}),Y(E.value),k.length>0&&t.timeScale().applyOptions({visible:!1})}function te(){var y;t!==null&&(t.applyOptions({width:(y=b.value)==null?void 0:y.clientWidth}),k.forEach(_=>{var C;_.applyOptions({width:(C=b.value)==null?void 0:C.clientWidth})}))}ze(()=>{H()});function q(y,_){return _.time&&_.seriesData.get(y)||null}function A(y,_,C){if(C){y.setCrosshairPosition(C.value,C.time,_);return}y.clearCrosshairPosition()}function H(){t!==null&&(t.remove(),t=null),v!==null&&(v=null),k.length>0&&(k.forEach(y=>{y.remove()}),k.length=0),g.length>0&&(g.length=0)}function Y(y){t!==null&&(t.applyOptions(y==="light"?Te.chart:Le.chart),k.forEach(_=>{_.applyOptions(y==="light"?Te.chart:Le.chart)}))}function se(y){const _=X.orders[i.value].find(V=>V.symbol===n.results.selectedRoute.symbol).orders,C=_.find(V=>V.order_id===y);if(C&&t){const V=(typeof C.time=="number",C.time),J=t.timeScale(),Q=_[1].time-_[0].time,oe=V-Q*5,G=V+Q*5,le=C.color;v==null||v.setMarkers(_.map(M=>M.order_id===y?{...M,color:"#FFA500"}:M)),J.setVisibleRange({from:oe,to:G}),setTimeout(()=>{v==null||v.setMarkers(_.map(M=>M.order_id===y?{...M,color:le}:M))},2e3)}}function de(){return n.results.trades.filter(y=>y.symbol===n.results.selectedRoute.symbol)}return(y,_)=>(a(),m("div",os,[r(ss,{modelValue:f.value,"onUpdate:modelValue":_[0]||(_[0]=C=>f.value=C),items:l(U),onZoom:_[1]||(_[1]=C=>se(C))},null,8,["modelValue","items"]),s("div",{class:N([[f.value?"w-[calc(100%-384px)]":"w-full"],"h-full transition-all duration-300"])},[s("div",ls,[s("div",{ref_key:"chartContainer",ref:b,class:"rounded overflow-hidden flex-grow"},null,512),l(x)&&Object.keys(l(x).charts).length?(a(),m("div",rs,[(a(!0),m(W,null,pe(Object.keys(l(x).charts),C=>(a(),m("div",{key:C,ref_for:!0,ref_key:"extraChartsRef",ref:u,class:"relative border-t-[1.5px] dark:border-gray-800"}))),128))])):h("",!0)])],2)]))}}),ns={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},is=["textContent"],ds={class:"mt-8"},us={class:"mt-8"},cs={key:0,class:"mt-4"},fs={key:1,class:"mx-auto container mt-8"},ms={key:0},ps={class:"mb-4 mt-4"},vs={class:"flex items-center select-none flex-1 my-4"},gs={class:"grid grid-cols-1 gap-6 mt-8"},bs={key:1,class:"w-full mx-auto"},ys={key:4,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},hs={class:"flex justify-start"},ws={key:0},ks={key:0},xs=["href"],_s=["href"],Cs=["href"],$s={key:5,class:"my-4"},Vs={key:1},Ss=ee({__name:"BacktestTab",props:{form:{},results:{}},setup(O){const d=O,p=R(!0),f=R(!1),n=R([]),b=R(!1),u=R(!1),t=ce().authToken,v=R(je().public.apiBaseUrl),k=R(!1),g=j(()=>Me().params.id),i=Pe(),x=ce(),E=et(),U=R([]),F=j(()=>x.jesseSupportedTimeframes.map(e=>({label:e,value:e}))),te=j(()=>d.form.routes.map(e=>({label:`${e.strategy} • ${e.symbol}`,value:e})));d.results.selectedRoute=d.form.routes[0],ke(async()=>{await x.initiate(),!d.form.exchange&&x.backtestingExchangeNames.length&&(d.form.exchange=x.backtestingExchangeNames[0]),(!d.results.showResults&&d.form.exchange||!U.value.length)&&await q()});async function q(){if(d.form.exchange)try{U.value=await x.getExchangeSupportedSymbols(d.form.exchange);for(let e=0;e<d.form.routes.length;e++)U.value.includes(d.form.routes[e].symbol)||(d.form.routes[e].symbol=U.value[0]);if(d.form.data_routes.length>0)for(let e=0;e<d.form.data_routes.length;e++)U.value.includes(d.form.data_routes[e].symbol)||(d.form.data_routes[e].symbol=U.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}K(()=>d.form.exchange,async(e,o)=>{e!==o&&(U.value=[],await q())});const{cancel:A,rerun:H,newBacktest:Y}=i;function se(e){if(n.value.length){for(let o=0;o<n.value.length;o++)fe("error",n.value[o]);return}i.start(e)}const de=e=>{if(n.value.length){for(let o=0;o<n.value.length;o++)fe("error",n.value[o]);return}i.startInNewTab(e)},y=j(()=>{let e=`/download/backtest/tradingview/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e});j(()=>{let e=`/download/backtest/full-reports/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e});const _=j(()=>{let e=`/download/backtest/csv/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e}),C=j(()=>{let e=`/download/backtest/json/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e}),V=j(()=>i.formattedMetrics(g.value).length>0),J=j(()=>B.remainingTimeText(d.results.progressbar.estimated_remaining_seconds));function Q(){navigator.clipboard.writeText(i.getInfoLogs(g.value)),fe("success","Logs copied successfully"),u.value=!0,setTimeout(()=>{u.value=!1},3e3)}K(()=>d.form.start_date,e=>{d.form.finish_date<e&&(d.form.finish_date=e)});async function oe(){const e=i.missingCandlesErrors[g.value];e&&(E.forms.push({id:B.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}}),await dt("/candles/"),await E.start(E.forms[E.forms.length-1].id))}async function G(){i.getInfoLogs(g.value).length>0||await le(),f.value=!0}async function le(){const{data:e,error:o}=await ut(`/logs/backtest/${g.value}?token=${t}`,!1);if(o.value){fe("error",o.value.message);return}const T=e.value,I=B.decompressData(T.content).split(`
`).map(P=>{const $=P.match(/\[INFO \| (.*?)\] (.*)/);return $?`[${$[1]}] ${$[2]}`:P}).join(`
`);i.setInfoLogs(g.value,I)}async function M(){const e=je().public.apiBaseUrl,o=ce().authToken,T=`${e}/download/backtest/log/${g.value}?token=${o}`;window.open(T,"_blank")}return(e,o)=>{const T=Fe,L=tt,I=lt,P=He,$=_e,ue=Ye,ae=mt,D=at,ve=pt,ge=Qe,Ce=nt,Z=it,Ie=xt,$e=rt,De=Ct,be=gt,Ne=vt,Be=Je,We=Ge;return a(),m(W,null,[r(I,{modelValue:l(f),"onUpdate:modelValue":o[0]||(o[0]=c=>ie(f)?f.value=c:null),title:"Logs"},{default:S(()=>[r(T,{logs:l(i).getInfoLogs(l(g))},null,8,["logs"])]),buttons:S(()=>[r(L,{text:"Copy",class:"inline-block",popper:{arrow:!0}},{default:S(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:Q},[l(u)?(a(),z(l(st),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0),!l(u)&&l(i).getInfoLogs(l(g)).length!=0?(a(),z(l(Ae),{key:1,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1}),r(L,{text:"Download",class:"inline-block ml-2",popper:{arrow:!0}},{default:S(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:M},[l(i).getInfoLogs(l(g)).length!=0?(a(),z(l(ot),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1})]),_:1},8,["modelValue"]),e.results.executing&&!e.results.showResults?(a(),m("div",ns,[s("div",null,[r(P,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?h("",!0):(a(),m("h3",{key:0,class:"mt-8 animate-pulse",textContent:w(l(J))},null,8,is)),s("div",ds,[s("div",us,[r($,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:o[1]||(o[1]=c=>l(A)((e._.provides[ne]||e.$route).params.id))})]),e.form.debug_mode&&e.results.exception.error?(a(),m("div",cs,[r($,{icon:"i-heroicons-clipboard-document-list",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,class:"w-64 flex justify-center",onClick:G})])):h("",!0)]),e.results.exception.error&&e.results.executing?(a(),m("div",fs,[r(ue,{modelValue:l(b),"onUpdate:modelValue":o[2]||(o[2]=c=>ie(b)?b.value=c:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):h("",!0)])):h("",!0),r(We,null,{left:S(()=>[!e.results.executing&&!e.results.showResults?(a(),m("div",ms,[l(i).missingCandlesErrors[l(g)]?(a(),z(ae,{key:0,icon:"i-heroicons-exclamation-triangle",color:"rose",variant:"soft",class:"mb-4"},{title:S(()=>o[24]||(o[24]=[s("h3",{class:"text-lg font-semibold"},"Missing Required Warmup Candles",-1)])),description:S(()=>[s("p",ps,[o[25]||(o[25]=ye(" Your strategy requires ")),o[26]||(o[26]=s("strong",{class:"font-bold"},"warmup candles",-1)),ye(' for "'+w(l(i).missingCandlesErrors[l(g)].symbol)+'" on "'+w(l(i).missingCandlesErrors[l(g)].exchange)+'" starting from "'+w(l(i).missingCandlesErrors[l(g)].start_date)+'". These candles are needed for proper strategy initialization. ',1)]),r($,{label:"Import Required Candles",icon:"i-heroicons-arrow-down-tray",onClick:oe})]),_:1})):h("",!0),r(D,{class:"mb-4",title:"Exchange"}),r(ve,{modelValue:e.form.exchange,"onUpdate:modelValue":o[3]||(o[3]=c=>e.form.exchange=c),placeholder:"Select an exchange...",searchable:"",options:l(ce)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16"},null,8,["modelValue","options"]),r(ge,{"total-routes-error":l(n),timeframes:l(F),form:e.form,results:e.results,symbols:l(U),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),r(D,{class:"mt-16",title:"Duration"}),s("div",vs,[r(Ce,{modelValue:e.form.start_date,"onUpdate:modelValue":o[4]||(o[4]=c=>e.form.start_date=c),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),r(Ce,{modelValue:e.form.finish_date,"onUpdate:modelValue":o[5]||(o[5]=c=>e.form.finish_date=c),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),r(D,{class:"mt-16",title:"Options"}),s("div",gs,[r(Z,{modelValue:e.form.debug_mode,"onUpdate:modelValue":o[6]||(o[6]=c=>e.form.debug_mode=c),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_chart,"onUpdate:modelValue":o[7]||(o[7]=c=>e.form.export_chart=c),title:"Generate Interactive Charts",description:"Generate interactive charts for backtest results with details."},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":o[8]||(o[8]=c=>e.form.export_tradingview=c),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_csv,"onUpdate:modelValue":o[9]||(o[9]=c=>e.form.export_csv=c),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_json,"onUpdate:modelValue":o[10]||(o[10]=c=>e.form.export_json=c),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),r(Z,{modelValue:e.form.fast_mode,"onUpdate:modelValue":o[11]||(o[11]=c=>e.form.fast_mode=c),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),r(Z,{modelValue:e.form.benchmark,"onUpdate:modelValue":o[12]||(o[12]=c=>e.form.benchmark=c),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):h("",!0),e.results.showResults?(a(),m("div",bs,[s("div",null,[l(V)?(a(),z(D,{key:0,class:"mb-4",title:"Equity Curve"})):h("",!0),l(V)?(a(),z(Ie,{key:1,data:e.results.charts.equity_curve},null,8,["data"])):h("",!0),l(V)?(a(),z(D,{key:2,class:"mt-16 mb-4",title:"Performance"})):h("",!0),l(V)?(a(),z($e,{key:3,data:l(i).formattedMetrics(l(g))},null,8,["data"])):h("",!0),l(V)?h("",!0):(a(),m("div",ys," No trades were executed via this strategy! "))]),r(De,{modelValue:l(k),"onUpdate:modelValue":o[16]||(o[16]=c=>ie(k)?k.value=c:null)},{title:S(()=>[s("div",hs,[r(ve,{modelValue:e.results.selectedRoute,"onUpdate:modelValue":o[13]||(o[13]=c=>e.results.selectedRoute=c),"value-attribute":"value",options:l(te)},null,8,["modelValue","options"]),r($,{class:"ml-2",color:"gray",label:l(p)?"Hide Trades":"Show Trades",onClick:o[14]||(o[14]=c=>p.value=!l(p))},null,8,["label"])])]),default:S(()=>[r(as,{modelValue:l(p),"onUpdate:modelValue":o[15]||(o[15]=c=>ie(p)?p.value=c:null),results:e.results,form:e.form},null,8,["modelValue","results","form"])]),_:1},8,["modelValue"])])):h("",!0)]),right:S(()=>[e.results.executing?h("",!0):(a(),m("div",ws,[e.results.showResults?(a(),m("div",ks,[r($,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:o[17]||(o[17]=c=>l(H)((e._.provides[ne]||e.$route).params.id))}),r($,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:o[18]||(o[18]=c=>l(Y)((e._.provides[ne]||e.$route).params.id))}),e.form.debug_mode?(a(),z($,{key:0,class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-clipboard-document-list",size:"xl",variant:"solid",label:"Debugging Logs",trailing:!1,onClick:o[19]||(o[19]=c=>G())})):h("",!0),e.form.export_chart?(a(),z($,{key:1,class:"mt-4 flex justify-center items-center btn-secondary text-center",color:"gray",icon:"i-heroicons-chart-bar",size:"xl",block:"",variant:"solid",label:"View charts",trailing:!1,onClick:o[20]||(o[20]=c=>k.value=!0)})):h("",!0),e.form.export_csv&&l(V)?(a(),m("a",{key:2,href:l(_),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[r($,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CSV",trailing:!1})],8,xs)):h("",!0),e.form.export_json&&l(V)?(a(),m("a",{key:3,href:l(C),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[r($,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,_s)):h("",!0),e.form.export_tradingview&&l(V)?(a(),m("a",{key:4,href:l(y),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[r($,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,Cs)):h("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(a(),m("div",$s,[r(ae,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:o[21]||(o[21]=c=>e.results.alert.message="")},null,8,["title"])])):h("",!0),r(be,{class:"mt-8 mb-4",size:"lg",label:"General Info"}),r(Ne,{data:e.results.info},null,8,["data"]),r(be,{class:"mt-8 mb-4",size:"lg",label:"Routes"}),r(Be,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(a(),z(be,{key:6,class:"mt-8 mb-4",size:"lg",label:"Hyperparameters"})):h("",!0),e.results.hyperparameters.length?(a(),z($e,{key:7,data:e.results.hyperparameters},null,8,["data"])):h("",!0)])):(a(),m("div",Vs,[r($,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:o[22]||(o[22]=c=>se((e._.provides[ne]||e.$route).params.id))}),r($,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:o[23]||(o[23]=c=>de((e._.provides[ne]||e.$route).params.id))})]))]))]),_:1})],64)}}}),js={class:"w-full"},Ds=ee({__name:"[id]",setup(O){bt({title:"Backtest - Jesse"});const d=Pe(),p=j(()=>d.tabs),f=j(()=>ct().params.id),n=j(()=>{if(!p.value[f.value]){const b=Object.keys(p.value);if(b.length>0){const u=p.value[b[0]];return ft().push(`/backtest/${u.id}`),u}}return p.value[f.value]});return Object.keys(p.value).length===0&&d.addTab(),(b,u)=>{const t=qe,v=Ss;return a(),m(W,null,[s("div",js,[r(t,{"current-tab":n.value?n.value.id:null,tabs:p.value,mode:"backtest",onClose:l(d).closeTab,onCancel:l(d).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),n.value?(a(),z(v,{key:0,form:n.value.form,results:n.value.results},null,8,["form","results"])):h("",!0)],64)}}});export{Ds as default};
