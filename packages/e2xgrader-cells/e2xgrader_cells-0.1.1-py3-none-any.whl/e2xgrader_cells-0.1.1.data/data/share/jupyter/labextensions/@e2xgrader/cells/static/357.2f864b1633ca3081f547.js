"use strict";(self.webpackChunk_e2xgrader_cells=self.webpackChunk_e2xgrader_cells||[]).push([[357],{357:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var i=n(123),o=n(816),s=n(593),a=n(614);const c="extended_cell";var r,d;!function(e){e.E2X_METADATA_DEFAULTS={type:void 0,options:{}}}(r||(r={})),function(e){e.mergeWithCleanMetadata=function(e,t){const n={...t};for(const i in t)i in e&&typeof e[i]==typeof t[i]&&(n[i]=e[i]);return n}}(d||(d={}));class l extends a.MarkdownCell{constructor(e){super(e),this.__lastContent="",this._settings=e.settings,this._settings&&this._settings.changed.connect(this.onSettingsUpdated,this),this.showEditorForReadOnly=!1,this.model.setMetadata(c,this.cleanMetadata())}get editMode(){return!!this._settings&&this._settings.get("edit_mode").composite}onSettingsUpdated(e){this._graderSection&&(this._graderSection.hidden=!e.get("edit_mode").composite)}get source(){var e;return(null===(e=this.model)||void 0===e?void 0:e.sharedModel.getSource())||"Type Markdown and LaTeX: $ a^2 $"}get contentChanged(){return this.__lastContent!==this.source}get metadataDefaults(){return r.E2X_METADATA_DEFAULTS}cleanMetadata(){return d.mergeWithCleanMetadata(this.e2xMetadata,this.metadataDefaults)}get e2xMetadata(){var e;return(null===(e=this.model)||void 0===e?void 0:e.getMetadata(c))||{}}get e2xCellType(){return this.e2xMetadata.type}set e2xCellType(e){var t,n;if(e!==this.e2xCellType){this.setE2xMetadataField("type",e);const i=this.model.toJSON(),o=this.cellIndex;null===(t=this.notebook.model)||void 0===t||t.sharedModel.insertCell(o+1,i),null===(n=this.notebook.model)||void 0===n||n.sharedModel.deleteCell(o)}}getE2xMetadataField(e,t={}){var n,i;return null!==(i=null===(n=this.e2xMetadata)||void 0===n?void 0:n[e])&&void 0!==i?i:t}setE2xMetadataField(e,t){var n;const i=this.e2xMetadata;i[e]=t,null===(n=this.model)||void 0===n||n.setMetadata(c,i)}_waitForRender(e,t){return new Promise((n=>{!function i(){e.node.querySelector(".jp-RenderedMarkdown *")?n(e):setTimeout(i,t)}()}))}renderInput(e){this.readOnly=!0,super.renderInput(e),this.contentChanged&&(this._waitForRender(e,2).then((e=>{this.postRender(e),this.renderGraderSection(e)})),this.__lastContent=this.source)}postRender(e){}renderGraderSection(e){if(!this.e2xCellType)return;const t=e.node,n=document.createElement("div");n.appendChild(document.createElement("hr")),n.className="e2x_grader_options";const i=document.createElement("button");i.classList.add("e2x_unrender","e2x_btn"),i.textContent="Edit Cell",i.onclick=()=>{this.readOnly=!1,this.rendered=!1},n.appendChild(i),this._graderSection=n,this.editMode||(n.hidden=!0),t.appendChild(n)}get notebook(){return this.parent}get cellIndex(){return this.notebook.widgets.findIndex((e=>e===this))}}const h="multiplechoice",u="singlechoice";var g;!function(e){e.MULTIPLECHOICE_METADATA_DEFAULTS={...r.E2X_METADATA_DEFAULTS,type:h,choice:[],num_of_choices:0},e.SINGLECHOICE_METADATA_DEFAULTS={...r.E2X_METADATA_DEFAULTS,type:u,choice:""}}(g||(g={}));class p extends l{get choices(){return this.getE2xMetadataField("choice",[])}set choices(e){this.setE2xMetadataField("choice",e)}}class m extends p{get choiceCount(){return this.getE2xMetadataField("num_of_choices",0)}set choiceCount(e){this.setE2xMetadataField("num_of_choices",e)}get metadataDefaults(){return g.MULTIPLECHOICE_METADATA_DEFAULTS}addChoice(e){const t=this.choices;t.includes(e)||(t.push(e),this.choices=t)}removeChoice(e){const t=this.choices,n=t.indexOf(e);n>=0&&(t.splice(n,1),this.choices=t)}createChoiceElement(e,t){const n=document.createElement("input");return n.type="checkbox",n.name=this.model.id,n.value=e,n.checked=t,n.onchange=t=>{t.target.checked?this.addChoice(e):this.removeChoice(e)},n}postRender(e){const t=e.node.querySelectorAll("ul");if(0===t.length)return;const n=t[0],i=n.querySelectorAll("li"),o=document.createElement("form");o.classList.add("e2x-multiplechoice-form"),this.choiceCount!==i.length&&(this.choiceCount=i.length,this.choices=[]),i.forEach(((e,t)=>{const n=this.createChoiceElement(t.toString(),this.choices.includes(t.toString())),i=document.createElement("label");i.innerHTML=e.innerHTML,o.appendChild(n),o.appendChild(i),o.appendChild(document.createElement("br"))})),n.replaceWith(o)}}class E extends p{get choice(){return this.getE2xMetadataField("choice","")}set choice(e){this.setE2xMetadataField("choice",e)}get metadataDefaults(){return g.SINGLECHOICE_METADATA_DEFAULTS}createChoiceElement(e,t){const n=document.createElement("input");return n.type="radio",n.name=this.model.id,n.value=e,n.checked=t,n.onchange=t=>{t.target.checked&&(this.choice=e)},n}postRender(e){const t=e.node.querySelectorAll("ul");if(0===t.length)return;const n=t[0],i=n.querySelectorAll("li"),o=document.createElement("form");o.classList.add("e2x-singlechoice-form"),""!==this.choice&&parseInt(this.choice)>=i.length&&(this.choice=""),i.forEach(((e,t)=>{const n=this.createChoiceElement(t.toString(),this.choice===t.toString()),i=document.createElement("label");i.innerHTML=e.innerHTML,o.appendChild(n),o.appendChild(i),o.appendChild(document.createElement("br"))})),n.replaceWith(o)}}class _ extends i.NotebookPanel.ContentFactory{constructor(e,t){super(e),this._settings=t}createMarkdownCell(e){var t;e.contentFactory||(e.contentFactory=this),e.settings=this._settings;const n=null===(t=e.model.getMetadata("extended_cell"))||void 0===t?void 0:t.type;return n===h?new m(e):n===u?new E(e):new l(e)}}const C={id:"@e2xgrader/cells:factory",description:"A JupyterLab extension.",autoStart:!0,requires:[o.IEditorServices],optional:[s.ISettingRegistry],provides:i.NotebookPanel.IContentFactory,activate:async(e,t,n)=>{console.log("JupyterLab extension @e2xgrader/cells is activated!");const i=t.factoryService.newInlineEditor;let o;if(n)try{const e=await n.load(C.id);o=new _({editorFactory:i},e)}catch(e){console.error("Failed to load settings for @e2xgrader/cells",e),o=new _({editorFactory:i})}else o=new _({editorFactory:i});return o}},M=C}}]);