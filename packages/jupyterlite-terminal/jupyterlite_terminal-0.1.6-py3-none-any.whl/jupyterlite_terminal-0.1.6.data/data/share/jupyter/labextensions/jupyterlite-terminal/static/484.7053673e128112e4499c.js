"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[484],{7450:(t,e,s)=>{s.d(e,{D:()=>i});class i extends Map{constructor(){super()}getRecursive(t){let e=this.get(t);for(;void 0!==e;){const s=e.split(" ")[0];if(s===t)break;const i=this.get(s);if(void 0===i)return e;e=i+e.slice(s.length),t=s}return e}match(t){return[...this.keys()].filter((e=>e.startsWith(t)))}}},9399:(t,e,s)=>{s.d(e,{Q:()=>n});const i="[",n={cursorUp:(t=1)=>t>0?i+t+"A":"",cursorDown:(t=1)=>t>0?i+t+"B":"",cursorRight:(t=1)=>t>0?i+t+"C":"",cursorLeft:(t=1)=>t>0?i+t+"D":"",cursorHome:"[H",eraseScreen:"[2J",eraseSavedLines:"[3J",eraseEndLine:"[K",eraseStartLine:"[1K",styleReset:"[1;0m",styleBoldRed:"[1;31m",styleBoldGreen:"[1;32m",styleBrightRed:"[0;91m",styleBrightGreen:"[0;92m",styleBrightYellow:"[0;93m",styleBrightBlue:"[0;94m",styleBrightPurple:"[0;95m",styleBrightCyan:"[0;96m",styleRed:"[0;31m",styleGreen:"[0;32m",styleYellow:"[0;33m",styleBlue:"[0;34m",stylePurple:"[0;35m",styleCyan:"[0;36m",showCursor:"[?25h",hideCursor:"[?25l"}},1056:(t,e,s)=>{s.d(e,{g:()=>C});var i=s(898),n=s(7450),r=s(9399),o=s(1063),a=s(2101);class l extends Map{constructor(t){super(),t?(this.set("PS1",r.Q.styleBoldGreen+"js-shell:"+r.Q.styleReset+" "),this.set("TERM","xterm-256color")):this.set("PS1","js-shell: ")}copyFromCommand(t){for(const e of t){const t=e.split("="),s=t.shift();s&&!this._ignore.has(s)&&this.set(s,t.join("="))}}copyIntoCommand(t,e){for(const[s,i]of this.entries())(e||"TERM"!==s)&&(t[s]=i)}getNumber(t){const e=this.get(t);if(null===e)return null;const s=Number(e);return isNaN(s)?null:s}getPrompt(){return this.get("PS1")??"$ "}_ignore=new Set(["USER","LOGNAME","HOME","LANG","_"])}var h=s(7095),c=s(3482);class u{add(t){this._current=null,!t.trim()||this._ignoreInitialWhitespace&&t.startsWith(" ")||this._ignoreDuplicates&&t===this.at(-1)||(this._history.length>=this._maxSize&&this._history.shift(),this._history.push(t))}at(t){return this._history.at(t)??null}clear(){this._current=null,this._history=[]}scrollCurrent(t){return this._current=t?null===this._current?null:this._current+1:null===this._current?this._history.length-1:this._current-1,null!==this._current&&(this._current<0?this._current=0:this._current>=this._history.length&&(this._current=null)),null===this._current?null:this.at(this._current)}setMaxSize(t){this._maxSize=Math.max(t,0),this._history.length>this._maxSize&&(this._current=null,this._history=this._history.slice(this._maxSize))}write(t){for(let e=0;e<this._history.length;e++){const s=String(e).padStart(5," ");t.write(`${s}  ${this._history[e]}\n`)}}_history=[];_current=null;_ignoreInitialWhitespace=!0;_ignoreDuplicates=!0;_maxSize=1e3}var d=s(5107),m=s(7497),f=s(3291);class _{get(t,e){const s=this.key(t,e);return this._cache.get(s)??void 0}has(t,e){const s=this.key(t,e);return this._cache.has(s)}key(t,e){return[t,e].join("/")}set(t,e,s){const i=this.key(t,e);this._cache.set(i,s)}_cache=new Map}class g{wasmBaseUrl;downloadWasmModuleCallback;constructor(t,e){this.wasmBaseUrl=t,this.downloadWasmModuleCallback=e}getModule(t,e){let s=this.cache.get(t,e);if(void 0===s){const i=this.cache.key(t,e)+".js",n=this.wasmBaseUrl+i;console.log("Cockle Importing JS/WASM from "+n),this.downloadWasmModuleCallback(t,e,!0),importScripts(n),s=self.Module,this.cache.set(t,e,s),this.downloadWasmModuleCallback(t,e,!1)}return s}cache=new _}class p{wasmModuleLoader;constructor(t){this.wasmModuleLoader=t}async run(t,e){const{args:s,bufferedIO:i,fileSystem:n,mountpoint:r,stdin:o,stdout:a,stderr:l}=e,{wasmBaseUrl:h}=this.wasmModuleLoader,u=Date.now(),d=this.wasmModuleLoader.getModule(this.packageName,this.moduleName);let m,f=[];function _(t){if(f.length>0)return f.shift();const e=o.readChar(),s=e[0];return e.length>1&&(f=e.slice(1)),4===s?null:s}function g(t){const{termios:e}=i;return e.log("Termios get"),e.clone()}function p(t,e,s){return i.termios.set(s),0}function y(t){return[e.environment.getNumber("LINES")??24,e.environment.getNumber("COLUMNS")??80]}function w(t,e){return i.poll(e)}function S(e,n,r,o,h){if(0===o)return 0;const c=n.slice(r,r+o),u=i.utf8ArrayToString(c),d="/dev/tty1"===e.path;return d&&"touch"===t&&s.length>1||(d?l:a).write(u),o}function C(t){void 0===m&&(m=t)}const x=await d({thisProgram:t,arguments:s,locateFile:t=>h+this.packageName+"/"+t,onExit:t=>C(t),quit:(t,e)=>C(t),preRun:[t=>{if(Object.prototype.hasOwnProperty.call(t,"FS")){const e=t.FS;e.mkdir(r,511),e.mount(n.PROXYFS,{root:r,fs:n.FS},r),e.chdir(n.FS.cwd())}if(Object.prototype.hasOwnProperty.call(t,"ENV")&&e.environment.copyIntoCommand(t.ENV,a.supportsAnsiEscapes()),Object.prototype.hasOwnProperty.call(t,"TTY")){t.TTY.default_tty_ops.ioctl_tcgets=g,t.TTY.default_tty_ops.ioctl_tcsets=p,t.TTY.default_tty_ops.ioctl_tiocgwinsz=y,t.TTY.stream_ops.write=S,t.TTY.stream_ops.poll=w;const e=t.FS.makedev(5,0);t.TTY.ttys[e].ops.get_char=_}}]});if(void 0===m)m=c.y.CANNOT_RUN_COMMAND;else{if(Object.prototype.hasOwnProperty.call(x,"FS")){const t=x.FS;for(const e of[t.streams[1],t.streams[2]])null===e||t.isClosed(e)||t.close(e)}Object.prototype.hasOwnProperty.call(x,"getEnvStrings")&&e.environment.copyFromCommand(x.getEnvStrings())}const b=Date.now();return console.log(`Cockle ${t} load and run time ${b-u} ms`),m}}class y extends p{name;commands;packageName;constructor(t,e,s,i){super(t),this.name=e,this.commands=s,this.packageName=i}get moduleName(){return this.name}names(){return this.commands}}class w{name;version;build_string;channel;platform;modules;constructor(t,e,s,i,n,r){this.name=t,this.version=e,this.build_string=s,this.channel=i,this.platform=n,this.modules=r}}class S{options;constructor(t){this.options=t,this._environment=new l(t.color),this._wasmModuleLoader=new g(t.wasmBaseUrl,t.downloadWasmModuleCallback),this._commandRegistry=new o.J}get aliases(){return this._aliases}get environment(){return this._environment}get history(){return this._history}async initialize(){await this._initWasmPackages(),await this._initFilesystem()}async input(t){if(this._isRunning)switch(t.charCodeAt(0)){case 13:{this.output("\n");const t=this._currentLine;this._currentLine="",this._cursorIndex=0,await this._runCommands(t),this._outputPrompt();break}case 127:if(this._cursorIndex>0){const t=this._currentLine.slice(this._cursorIndex);this._currentLine=this._currentLine.slice(0,this._cursorIndex-1)+t,this._cursorIndex--,this.output(r.Q.cursorLeft(1)+t+r.Q.eraseEndLine+r.Q.cursorLeft(t.length))}break;case 9:await this._tabComplete();break;case 27:this._escapedInput(t);break;case 4:break;default:if(this._cursorIndex===this._currentLine.length)this._currentLine+=t,this.output(t);else{const e=this._currentLine.slice(this._cursorIndex);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t+e,this.output(r.Q.eraseEndLine+t+e+r.Q.cursorLeft(e.length))}this._cursorIndex++}}get mountpoint(){return this.options.mountpoint??"/drive"}output(t){this._isRunning&&this.options.bufferedIO.write(t)}async setSize(t,e){const{environment:s}=this;t>=1?s.set("LINES",t.toString()):s.delete("LINES"),e>=1?s.set("COLUMNS",e.toString()):s.delete("COLUMNS")}async start(){this._isRunning=!0,await this._outputPrompt()}terminate(){console.log("Cockle ShellImpl.terminate"),this._isRunning=!1,this.options.terminateCallback()}async _escapedInput(t){const e=t.slice(1);switch(e){case"[A":case"[1A":case"[B":case"[1B":{const t=this._history.scrollCurrent(e.endsWith("B"));this._currentLine=null!==t?t:"",this._cursorIndex=this._currentLine.length,this.output(r.Q.eraseStartLine+`\r${this._environment.getPrompt()}${this._currentLine}`);break}case"[D":case"[1D":this._cursorIndex>0&&(this._cursorIndex--,this.output(r.Q.cursorLeft()));break;case"[C":case"[1C":this._cursorIndex<this._currentLine.length&&(this._cursorIndex++,this.output(r.Q.cursorRight()));break;case"[3~":if(this._cursorIndex<this._currentLine.length){const t=this._currentLine.slice(this._cursorIndex+1);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t,this.output(r.Q.eraseEndLine+t+r.Q.cursorLeft(t.length))}break;case"[H":case"[1;2H":this._cursorIndex>0&&(this.output(r.Q.cursorLeft(this._cursorIndex)),this._cursorIndex=0);break;case"[F":case"[1;2F":{const{length:t}=this._currentLine;this._cursorIndex<t&&(this.output(r.Q.cursorRight(t-this._cursorIndex)),this._cursorIndex=t);break}case"[1;2D":case"[1;5D":if(this._cursorIndex>0){const t=this._currentLine.slice(0,this._cursorIndex).trimEnd().lastIndexOf(" ")+1;this.output(r.Q.cursorLeft(this._cursorIndex-t)),this._cursorIndex=t}break;case"[1;2C":case"[1;5C":{const{length:t}=this._currentLine;if(this._cursorIndex<t-1){const e=this._currentLine.slice(this._cursorIndex),s=e.trimStart(),i=s.indexOf(" "),n=i<0?t:this._cursorIndex+e.length-s.length+i;this.output(r.Q.cursorRight(n-this._cursorIndex)),this._cursorIndex=n}break}}}_filenameExpansion(t){let e=[],s=0;for(const i of t){if(i.startsWith("-")){s++,e.push(i);continue}if(!i.includes("*")&&!i.includes("?")){e.push(i);continue}const{FS:t}=this._fileSystem,n=t.analyzePath(i,!1);if(!n.parentExists){e.push(i);continue}const r=n.parentPath;let o=r;const a=t.cwd();o.startsWith(a)&&(o=o.slice(a.length),o.startsWith("/")&&(o=o.slice(1)));let l=t.readdir(r),h=n.name.replace(/[.+^${}()|[\]\\]/g,"\\$&");h=h.replaceAll("*",".*"),h=h.replaceAll("?",".");const c=new RegExp(`^${h}$`);l=l.filter((t=>t.match(c))),l=l.filter((t=>!t.startsWith("."))),o.length>0&&(l=l.map((t=>o+"/"+t))),e=e.concat(l)}return e.length===s&&(e=t),e}async _initFilesystem(){const{wasmBaseUrl:t}=this.options,e=this._wasmModuleLoader.getModule("cockle_fs","fs"),s=await e({locateFile:e=>t+"cockle_fs/"+e}),{FS:i,PATH:n,ERRNO_CODES:r,PROXYFS:o}=s,{mountpoint:a}=this;i.mkdirTree(a,511),this._fileSystem={FS:i,PATH:n,ERRNO_CODES:r,PROXYFS:o};const{driveFsBaseUrl:l,initialDirectories:h,initialFiles:c}=this.options;void 0!==l&&this.options.initDriveFSCallback(l,this.mountpoint,this._fileSystem),i.chdir(a),this._environment.set("PWD",i.cwd()),h&&h.forEach((t=>i.mkdir(t,509))),c&&Object.entries(c).forEach((([t,e])=>i.writeFile(t,e,{mode:436})))}async _initWasmPackages(){const t=this.options.wasmBaseUrl+"cockle-config.json",e=await fetch(t);e.ok||console.error(`Failed to fetch ${t}, terminal cannot function without it`);const s=await e.json(),i=Object.keys(s.packages),n="cockle_fs";i.includes(n)||console.error(`cockle-config.json does not include required package '${n}'`);for(const t of i){const e=s.packages[t],i=Object.entries(e.modules).map((([e,s])=>new y(this._wasmModuleLoader,e,s.commands?s.commands.split(","):[],t))),n=new w(t,e.version,e.build_string,e.channel,e.platform,i);this._commandRegistry.registerWasmCommandPackage(n)}if(Object.hasOwn(s,"aliases"))for(const[t,e]of Object.entries(s.aliases)){const s=e;s.length>0&&this._aliases.set(t,s)}}_outputPrompt(){this._isRunning&&this.options.bufferedIO.write(`\n${this.environment.getPrompt()}`)}async _runCommands(t){if(this.options.enableBufferedStdinCallback(!0),this.options.bufferedIO.allowAdjacentNewline(!0),t.startsWith("!")){const e=parseInt(t.slice(1)),s=this._history.at(e);if(null===s){let t="!"+e+": event not found";return this.options.color&&(t=r.Q.styleBoldRed+t+r.Q.styleReset),this.output(`${t}\n`),void this._outputPrompt()}t=s}let e;this._history.add(t);const s=new d.dl(this.options.stdinCallback),i=new d.mI(this.output.bind(this)),n=new d.mI(this.output.bind(this),this.options.color?r.Q.styleBoldRed:null,this.options.color?r.Q.styleReset:null);try{const r=(0,m.qg)(t,!0,this._aliases);for(const t of r)if(t instanceof m.Sv)e=await this._runCommand(t,s,i,n);else{if(!(t instanceof m.Ru))throw new h.$g(`Expected CommandNode or PipeNode not ${t}`);{const{commands:e}=t,r=e.length;let o;for(let t=0;t<r;t++){const a=0===t?s:o.input,l=t<r-1?o=new d.nT:i;await this._runCommand(e[t],a,l,n)}}}}catch(t){t instanceof h.Ge&&(e=t.exitCode),n.write(t+"\n"),n.flush()}finally{e=e??c.y.GENERAL_ERROR,this.environment.set("?",`${e}`),this.options.bufferedIO.allowAdjacentNewline(!1),this.options.enableBufferedStdinCallback(!1)}}async _runCommand(t,e,s,i){const n=t.name.value,r=this._commandRegistry.get(n);if(null===r)throw new h.xZ(n);if(t.redirects){if(t.redirects.length>1)throw new h.$g("Only implemented a single redirect per command");const i=t.redirects[0],n=i.token.value,r=i.target.value;if(">"===n||">>"===n)s=new d.MM(this._fileSystem,r,">>"===n);else{if("<"!==n)throw new h.$g("Unrecognised redirect "+n);e=new d.zp(this._fileSystem,r)}}let o=t.suffix.map((t=>t.value));o=this._filenameExpansion(o);const l=new a.o(o,this._fileSystem,this.mountpoint,this._aliases,this._commandRegistry,this._environment,this._history,this.terminate.bind(this),e,s,i,this.options.bufferedIO,this._wasmModuleLoader.cache),c=await r.run(n,l);return l.flush(),c}async _tabComplete(){const t=this._currentLine.slice(0,this._cursorIndex);if(t.endsWith(" ")&&t.trim().length>0)return;const e=this._currentLine.slice(this._cursorIndex),s=(0,m.qg)(t,!1),[i,n]=s.length>0?s[s.length-1].lastToken():[null,!0];let o=i?.value??"",a=[];if(n){const t=this._commandRegistry.match(o),e=this._aliases.match(o);a=[...new Set([...t,...e])].sort()}else{const{FS:t}=this._fileSystem,e=t.analyzePath(o,!1);if(!e.parentExists)return;const s=o;o=e.name;const{exists:i}=e;if(i&&!t.isDir(t.stat(e.path).mode))a=[o];else{const n=i?e.path:e.parentPath;a=t.readdir(n),i?"."===s||".."===s||s.endsWith("/.")||s.endsWith("/..")?a=a.filter((t=>t.startsWith("."))):(a=a.filter((t=>!t.startsWith("."))),s.endsWith("/")||(this._currentLine+="/")):a=a.filter((t=>t.startsWith(o))),a=a.map((e=>t.isDir(t.stat(n+"/"+e).mode)?e+"/":e))}}if(1===a.length){let t=a[0].slice(o.length);t.endsWith("/")||(t+=" "),this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t+e,this._cursorIndex+=t.length,this.output(t+e+r.Q.cursorLeft(e.length))}else if(a.length>1){const t=(0,f.Il)(a,o.length);if(t.length>o.length){const s=t.slice(o.length);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+s+e,this._cursorIndex+=s.length,this.output(s+e+r.Q.cursorLeft(e.length))}else{const t=`\n${(0,f.tp)(a,this._environment.getNumber("COLUMNS")??0).join("\n")}\n${this._environment.getPrompt()}${this._currentLine}`;this.output(t+r.Q.cursorLeft(e.length))}}}_currentLine="";_cursorIndex=0;_isRunning=!1;_aliases=new n.D;_commandRegistry;_environment;_history=new u;_wasmModuleLoader;_fileSystem}class C{async initialize(t,e,s,n){console.log("Cockle BaseShellWorker.initialize"),this._bufferedIO=new i.q(t.sharedArrayBuffer),this._downloadWasmModuleCallback=e,this._enableBufferedStdinCallback=s,this._terminateCallback=n;const{color:r,mountpoint:o,wasmBaseUrl:a,driveFsBaseUrl:l,initialDirectories:h,initialFiles:c}=t;this._shellImpl=new S({color:r,mountpoint:o,wasmBaseUrl:a,driveFsBaseUrl:l,initialDirectories:h,initialFiles:c,downloadWasmModuleCallback:this._downloadWasmModuleCallback.bind(this),enableBufferedStdinCallback:this.enableBufferedStdin.bind(this),initDriveFSCallback:this.initDriveFS.bind(this),terminateCallback:this._terminateCallback.bind(this),stdinCallback:this._bufferedIO.read.bind(this._bufferedIO),bufferedIO:this._bufferedIO}),await this._shellImpl.initialize()}async enableBufferedStdin(t){this._bufferedIO&&(t?await this._bufferedIO.enable():await this._bufferedIO.disable()),this._enableBufferedStdinCallback&&this._enableBufferedStdinCallback(t)}async input(t){this._shellImpl&&await this._shellImpl.input(t)}async setSize(t,e){this._shellImpl&&await this._shellImpl.setSize(t,e)}async start(){this._shellImpl&&await this._shellImpl.start()}_shellImpl;_bufferedIO;_downloadWasmModuleCallback;_enableBufferedStdinCallback;_terminateCallback}},1063:(t,e,s)=>{s.d(e,{J:()=>k});var i={};s.r(i),s.d(i,{AliasCommand:()=>d,BuiltinCommand:()=>r,CdCommand:()=>f,ClearCommand:()=>g,CockleConfigCommand:()=>y,ExitCommand:()=>w,ExportCommand:()=>C,HistoryCommand:()=>b});var n=s(7095);class r{names(){return[this.name]}run(t,e){if(t!==this.name)throw new n.xZ(t);return this._run(e)}}class o{shortName;longName;description;constructor(t,e,s){this.shortName=t,this.longName=e,this.description=s}get isSet(){return this._isSet}get name(){return this.shortName?this.shortName:this.longName}get prefixedName(){return this.shortName?`-${this.shortName}`:`--${this.longName}`}set(){this._isSet=!0}_isSet=!1}class a extends o{constructor(t,e,s){super(t,e,s)}}class l extends o{minCount;constructor(t=1){if(super("","",""),this.minCount=t,t<0)throw new n.$g("Negative minCount in TrailingStringsOption.constructor")}add(t){this._strings.push(t),this._isSet=!0}get length(){return this._strings.length}get strings(){return this._strings}_strings=[]}class h{static fromArgs(t,e){const s=new e,i=s._getStrings();let r=!1;for(const e of t)if(e.startsWith("-")&&e.length>1){if(r)throw new n.$g("Cannot have named option after parsing a trailing path");if(e.startsWith("--")){const t=e.slice(2);s._findByLongName(t).set()}else{const t=e.slice(1);s._findByShortName(t).set()}}else{if(null===i)throw new n.$g(`Unrecognised option: ${e}`);i.add(e),r=!0}if(i&&i.length<i.minCount)throw new n.$g("Insufficient trailing strings options specified");return s}writeHelp(t){for(const e of this._help())t.write(`${e}\n`)}_findByLongName(t){let e;for(e of Object.values(this))if(e.longName===t)return e;throw new n.$g(`No such longName option '${t}'`)}_findByShortName(t){let e;for(e of Object.values(this))if(e.shortName===t)return e;throw new n.$g(`No such shortName option '${t}'`)}_getStrings(){return"trailingStrings"in this?this.trailingStrings:null}_help(){return[...Object.values(this)].sort(((t,e)=>t.name>e.name?1:-1)).map((t=>{const e=t.prefixedName,s=Math.max(1,12-e.length);return`    ${e}${" ".repeat(s)}${t.description}`}))}}var c=s(3482);class u extends h{trailingStrings=new l(0)}class d extends r{get name(){return"alias"}async _run(t){const{aliases:e,args:s,stdout:i}=t,n=h.fromArgs(s,u);if(n.trailingStrings.isSet)for(const t of n.trailingStrings.strings){const s=t.indexOf("=");-1===s?i.write(`${t}='${e.get(t)}'\n`):e.set(t.slice(0,s),t.slice(s+1))}else for(const[t,s]of e.entries())i.write(`${t}='${s}'\n`);return c.y.SUCCESS}}class m extends h{trailingStrings=new l(0)}class f extends r{get name(){return"cd"}async _run(t){const{args:e}=t,s=h.fromArgs(e,m).trailingStrings.strings;if(s.length<1)return c.y.SUCCESS;if(s.length>1)throw new n.$g("cd: too many arguments");let i=s[0];if("-"===i){const e=t.environment.get("OLDPWD");if(void 0===e)throw new n.$g("cd: OLDPWD not set");i=e,t.stdout.write(`${i}\n`)}const{FS:r}=t.fileSystem,o=r.cwd();return r.chdir(i),t.environment.set("OLDPWD",o),t.environment.set("PWD",r.cwd()),c.y.SUCCESS}}var _=s(9399);class g extends r{get name(){return"clear"}async _run(t){const{stdout:e}=t;return e.supportsAnsiEscapes()&&e.write(_.Q.eraseScreen+_.Q.eraseSavedLines+_.Q.cursorHome),c.y.SUCCESS}}var p=s(3291);class y extends r{get name(){return"cockle-config"}async _run(t){const{stdout:e}=t;return e.write("cockle 0.0.16\n"),this._writePackageConfig(t),this._writeModuleConfig(t),c.y.SUCCESS}_writeModuleConfig(t){const{commandRegistry:e,stdout:s,wasmModuleCache:i}=t,n=e.allModules(),r=[["module","package","cached"]];for(const t of n)r.push([t.name,t.packageName,i.has(t.packageName,t.name)?"yes":""]);let o=null;s.supportsAnsiEscapes()&&(o=new Map,o.set(1,_.Q.styleBrightBlue),o.set(2,_.Q.styleBrightPurple));for(const t of(0,p.MR)(r,1,!1,o))s.write(t+"\n")}_writePackageConfig(t){const{commandRegistry:e,stdout:s}=t,i=e.wasmPackageMap,n=[["package","version","build string","channel"]];for(const t of i.values())n.push([t.name,t.version,t.build_string,t.channel]);let r=null;s.supportsAnsiEscapes()&&(r=new Map,r.set(1,_.Q.styleBrightBlue),r.set(2,_.Q.styleBrightPurple),r.set(3,_.Q.styleGreen));for(const t of(0,p.MR)(n,1,!1,r))s.write(t+"\n")}}class w extends r{get name(){return"exit"}async _run(t){const{stdout:e,terminate:s}=t;return e.write("Terminating shell...\n"),e.flush(),s(),c.y.SUCCESS}}class S extends h{trailingStrings=new l(0)}class C extends r{get name(){return"export"}async _run(t){const{args:e,environment:s}=t,i=h.fromArgs(e,S);if(i.trailingStrings.isSet)for(const t of i.trailingStrings.strings){const e=t.indexOf("=");if(e>0){const i=t.slice(0,e),n=t.slice(e+1);s.set(i,n)}}return c.y.SUCCESS}}class x extends h{clear=new a("c","","clear the history by deleting all of the entries");help=new a("","help","display this help and exit")}class b extends r{get name(){return"history"}async _run(t){const{args:e,history:s,stdout:i}=t,n=h.fromArgs(e,x);return n.help.isSet?n.writeHelp(i):n.clear.isSet?s.clear():s.write(i),c.y.SUCCESS}}class k{constructor(){this.registerBuiltinCommands(i)}allModules(){const t=[];for(const e of this.wasmPackageMap.values())t.push(...e.modules);return t.sort(((t,e)=>t.name<e.name?-1:1)),t}get(t){return this._map.get(t)??null}match(t){return[...this._map.keys()].filter((e=>e.startsWith(t))).sort()}registerBuiltinCommands(t){for(const[e,s]of Object.entries(t))if(e.endsWith("Command")&&!e.startsWith("Builtin"))try{const t=new s;t instanceof r&&this._register(t)}catch{}}registerWasmCommandPackage(t){this.wasmPackageMap.set(t.name,t);for(const e of t.modules)this._register(e)}_register(t){for(const e of t.names())this._map.set(e,t)}_map=new Map;wasmPackageMap=new Map}},2101:(t,e,s)=>{s.d(e,{o:()=>i});class i{args;fileSystem;mountpoint;aliases;commandRegistry;environment;history;terminate;stdin;stdout;stderr;bufferedIO;wasmModuleCache;constructor(t,e,s,i,n,r,o,a,l,h,c,u,d){this.args=t,this.fileSystem=e,this.mountpoint=s,this.aliases=i,this.commandRegistry=n,this.environment=r,this.history=o,this.terminate=a,this.stdin=l,this.stdout=h,this.stderr=c,this.bufferedIO=u,this.wasmModuleCache=d}flush(){this.stderr.flush(),this.stdout.flush()}}},7095:(t,e,s)=>{s.d(e,{$g:()=>o,Ge:()=>n,xZ:()=>r});var i=s(3482);class n extends Error{exitCode;constructor(t,e){super(e),this.exitCode=t}}class r extends n{constructor(t){super(i.y.CANNOT_FIND_COMMAND,`'${t}': command not found`)}}class o extends n{constructor(t){super(i.y.GENERAL_ERROR,t)}}},3482:(t,e,s)=>{s.d(e,{y:()=>i});const i={SUCCESS:0,GENERAL_ERROR:1,IMPROPER_USE:2,CANNOT_RUN_COMMAND:126,CANNOT_FIND_COMMAND:127}},5670:(t,e,s)=>{s.d(e,{j:()=>i});class i{get allContent(){return this.data.join("")}clear(){this.data=[]}supportsAnsiEscapes(){return!1}write(t){this.data.push(t)}data=[]}},2958:(t,e,s)=>{s.d(e,{z:()=>n});var i=s(1315);class n extends i.S{fileSystem;path;constructor(t,e){super(),this.fileSystem=t,this.path=e}readAll(){const{FS:t}=this.fileSystem;return t.readFile(this.path,{encoding:"utf8"})}}},5981:(t,e,s)=>{s.d(e,{M:()=>n});var i=s(5670);class n extends i.j{fileSystem;path;append;constructor(t,e,s){super(),this.fileSystem=t,this.path=e,this.append=s}flush(){const{FS:t}=this.fileSystem;let e=this.allContent;if(this.append)try{e=t.readFile(this.path,{encoding:"utf8"})+e}catch(t){}t.writeFile(this.path,e,{mode:436}),this.clear()}}},1315:(t,e,s)=>{s.d(e,{S:()=>i});class i{isTerminal(){return!1}readChar(){if(void 0===this._buffer&&(this._buffer=this.readAll(),this._index=0),this._index<this._buffer.length){const t=this._buffer[this._index++],e=[];for(let s=0;s<t.length;s++)e.push(t.charCodeAt(s));return e}return[4]}_buffer;_index=0}},4207:(t,e,s)=>{s.d(e,{n:()=>r});var i=s(5670),n=s(952);class r extends i.j{flush(){}get input(){return new n.J(this)}}},8316:(t,e,s)=>{s.d(e,{d:()=>i});class i{stdinCallback;constructor(t){this.stdinCallback=t}isTerminal(){return!0}readChar(){if(this._finished||void 0===this.stdinCallback)return[4];{const t=this.stdinCallback();if(4===t[0])this._finished=!0;else if(13===t[0])return[10];return t}}_finished=!1}},7703:(t,e,s)=>{s.d(e,{m:()=>i});class i{outputCallback;prefix;suffix;constructor(t,e=null,s=null){this.outputCallback=t,this.prefix=e,this.suffix=s}flush(){}supportsAnsiEscapes(){return!0}write(t){t.length<1||(null!==this.prefix&&(t=this.prefix+t),null!==this.suffix&&(t+=this.suffix),this.outputCallback(t))}}},7497:(t,e,s)=>{s.d(e,{Ru:()=>l,Sv:()=>a,qg:()=>c});var i=s(7095),n=s(9685);const r=";&";class o{}class a extends o{name;suffix;redirects;constructor(t,e,s){super(),this.name=t,this.suffix=e,this.redirects=s}lastToken(){return this.redirects&&this.redirects.length>0?this.redirects[this.redirects.length-1].lastToken():this.suffix.length>0?[this.suffix[this.suffix.length-1],!1]:[this.name,!0]}}class l extends o{commands;constructor(t){super(),this.commands=t}lastToken(){return this.commands.length>0?this.commands[this.commands.length-1].lastToken():[null,!1]}}class h extends o{token;target;constructor(t,e){super(),this.token=t,this.target=e}lastToken(){return[this.target,!1]}}function c(t,e=!0,s){const i=(0,n.q)(t,e,s),o=[],a=[];let h=-1;const c=i.length;function d(){1===a.length?o.push(a[0]):a.length>1&&o.push(new l([...a])),a.length=0}for(let t=0;t<c;t++){const e=i[t];h>=0?r.includes(e.value)?(a.push(u(i.slice(h,t))),d(),h=-1):"|"===e.value&&(a.push(u(i.slice(h,t))),h=-1):r.includes(e.value)||(h=t)}return h>=0&&a.push(u(i.slice(h,c))),d(),o}function u(t){let e=t.slice(1);const s=e.findIndex((t=>{return(e=t.value).startsWith(">")||e.startsWith("<");var e}));if(s>=0){if(e.length!==s+2)throw new i.$g("Redirect should be followed by file to redirect to");const n=new h(e[s],e[s+1]);return e=e.slice(0,s),new a(t[0],e,[n])}return new a(t[0],e)}},9685:(t,e,s)=>{s.d(e,{q:()=>r});var i,n=s(7095);function r(t,e=!0,s){const i=new o(t,e,s);return i.run(),i.tokens}!function(t){t[t.None=0]="None",t[t.Delimiter=1]="Delimiter",t[t.DoubleQuote=2]="DoubleQuote",t[t.SingleQuote=3]="SingleQuote",t[t.Whitespace=4]="Whitespace",t[t.Other=5]="Other"}(i||(i={}));class o{throwErrors;aliases;constructor(t,e,s){this.throwErrors=e,this.aliases=s,this._source=t,this._tokens=[]}run(){for(;this._index<=this._source.length;)this._next();if(this.throwErrors&&""!==this._endQuote)throw new n.$g("Tokenize error, expected end quote "+this._endQuote)}get tokens(){return this._tokens}_addToken(){const t=this._offset,e=this._value;if(void 0!==this.aliases&&t!==this._aliasOffset&&(0===this._tokens.length||";&|".includes(this._tokens.at(-1).value.at(-1)))){const s=this.aliases.getRecursive(e);if(void 0!==s){const n=e.length;return this._offset=-1,this._index=t-1,this._aliasOffset=t,this._source=this._source.slice(0,t)+s+this._source.slice(t+n),this._prevChar="",this._prevCharType=i.None,this._value="",this._endQuote="",!1}}return this._tokens.push({offset:t,value:e}),this._endQuote="",!0}_getCharType(t){return" ".includes(t)?i.Whitespace:";&|><".includes(t)?i.Delimiter:"'"===t?i.SingleQuote:'"'===t?i.DoubleQuote:i.Other}_endQuoteFromCharType(t){return t===i.DoubleQuote?'"':t===i.SingleQuote?"'":""}_next(){const t=++this._index,e=t<this._source.length?this._source[t]:" ";let s=this._getCharType(e);const n=this._endQuoteFromCharType(s);this._offset>=0?this._endQuote?e!==this._endQuote?this._value+=e:(this._endQuote="",s=i.Other):n?this._endQuote=n:s===i.Whitespace?this._addToken()&&(this._offset=-1):s!==this._prevCharType||s===i.Delimiter&&e!==this._prevChar?this._addToken()&&(this._offset=t,this._value=e):this._value+=e:s!==i.Whitespace&&(this._offset=t,this._endQuote=this._endQuoteFromCharType(s),this._value=""===this._endQuote?e:""),this._prevChar=e,this._prevCharType=s}_source;_tokens;_prevChar="";_prevCharType=i.None;_index=-1;_offset=-1;_aliasOffset=-1;_value="";_endQuote=""}},3291:(t,e,s)=>{s.d(e,{Il:()=>n,MR:()=>o,tp:()=>r});var i=s(9399);function n(t,e=0){if(t.length<1)return"";const s=Math.min(...t.map((t=>t.length))),i=t[0];let n=e;for(;n<s&&t.every((t=>t[n]===i[n]));)n++;return i.slice(0,n)}function r(t,e){if(t.length<1)return[];if(e<1)return[t.join("  ")];const s=t.length,i=Math.max(...t.map((t=>t.length))),n=Math.min(Math.floor(e/(i+2)),s),r=Math.ceil(s/n),o=[];for(let e=0;e<r;++e){let a="";for(let o=0;o<n;++o){const n=o*r+e;if(n>=s)continue;const l=t[n];a+=l,n+r<s&&(a+=" ".repeat(i+2-l.length))}o.push(a)}return o}function*o(t,e,s=!1,n=null){const r=t.length,o=t[0].length,a=t.map((t=>t.map((t=>t.length)))),l=Array(o).fill(0);for(let t=0;t<r;t++)for(let e=0;e<o;e++)l[e]=Math.max(l[e],a[t][e]);function h(t){let e="╭├╰"[t];for(let s=0;s<o;s++)e+="─".repeat(l[s]+2),e+=s<o-1?"┬┼┴"[t]:"╮┤╯"[t];return e}s||(yield h(0));for(let a=0;a<r;a++){const c=t[a];let u=s?"":"│ ";for(let t=0;t<o;t++){const e=n?.get(t)||null;u+=e?e+c[t]+i.Q.styleReset:c[t],u+=" ".repeat(l[t]-c[t].length),u+=s?"  ":" │ "}if(yield u,a===e-1)if(s){let t="";for(let e=0;e<o;e++)t+="─".repeat(l[e])+"  ";yield t}else a!==r-1&&(yield h(1))}s||(yield h(2))}}}]);