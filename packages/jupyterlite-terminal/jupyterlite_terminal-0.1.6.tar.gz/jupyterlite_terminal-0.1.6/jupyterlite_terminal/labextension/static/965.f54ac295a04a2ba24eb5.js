"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[965],{898:(t,s,e)=>{e.d(s,{q:()=>o,z:()=>a});var i=e(4133);class r{constructor(t){const s=Int32Array.BYTES_PER_ELEMENT,e=this._maxReadChars+3,i=this._maxWriteChars+2,r=e+i;this._sharedArrayBuffer=void 0===t?new SharedArrayBuffer(r*s):t,this._readArray=new Int32Array(this._sharedArrayBuffer,0,e),void 0===t&&(this._readArray[0]=0,this._readArray[1]=0),this._writeArray=new Int32Array(this._sharedArrayBuffer,e*s,i),void 0!==t&&(this._writeArray[0]=0,this._writeArray[1]=0)}async disable(){this._enabled=!1,this._clear()}async enable(){this._enabled=!0}get enabled(){return this._enabled}utf8ArrayToString(t){return void 0===this._utf8Decoder&&(this._utf8Decoder=new TextDecoder("utf8")),this._utf8Decoder.decode(t)}_clear(){this._readArray[0]=0,this._readArray[1]=0,this._readCount=0}_loadFromSharedArrayBuffer(){const t=Atomics.load(this._readArray,2),s=[];for(let e=0;e<t;e++)s.push(Atomics.load(this._readArray,3+e));return s}_enabled=!1;_sharedArrayBuffer;_maxReadChars=64;_readArray;_readCount=0;_maxWriteChars=256;_writeArray;_utf8Decoder}class a extends r{outputCallback;constructor(t){super(),this.outputCallback=t}async disable(){if(this._disabling=!0,this._readSentCount!==this._readCount){const t=this._loadFromSharedArrayBuffer();let s="";for(const e of t)s+=String.fromCharCode(e);await this._sendStdinNow(s)}for(;this._readBuffer.length>0;)await this._sendStdinNow(this._readBuffer.shift());this._disabling=!1,super.disable()}dispose(){this._isDisposed||(this._disposing=!0,Atomics.store(this._writeArray,0,999),Atomics.notify(this._writeArray,0),this._isDisposed=!0)}get sharedArrayBuffer(){return this._sharedArrayBuffer}async push(t){this._readBuffer.push(t),this._readBufferCount++,t.length>this._maxReadChars&&console.log(`String '${t}' is too long to buffer`),this._disabling||this._readCount!==this._readSentCount||this._storeInSharedArrayBuffer()}registerSendStdinNow(t){this._sendStdinNow=t}async start(){this._listenForWrite()}async _afterListenWrite(){if(this._disabling)return;let t="",s=!0;do{let e=Atomics.load(this._writeArray,1);s=0===e,s&&(e=this._maxWriteChars);const i=new Int16Array(e);for(let t=0;t<e;t++)i[t]=Atomics.load(this._writeArray,2+t);if(t+=String.fromCharCode(...i),Atomics.store(this._writeArray,0,0),Atomics.notify(this._writeArray,0,1),s&&!this._disposing){const{async:t,value:s}=Atomics.waitAsync(this._writeArray,0,0);t&&await s}}while(s);t.length>0&&!this._disposing&&this.outputCallback(t),this._disposing||this._listenForWrite()}_afterRead(){if(this._readCount=Atomics.load(this._readArray,1),this._readCount!==this._readSentCount)throw new Error("Should not happen");this._readBufferCount>this._readSentCount&&this._storeInSharedArrayBuffer()}_clear(){super._clear(),this._readBuffer=[],this._readBufferCount=0,this._readSentCount=0}_listenForWrite(){const{async:t,value:s}=Atomics.waitAsync(this._writeArray,0,0);t?s.then((()=>this._afterListenWrite())):this._afterListenWrite()}_storeInSharedArrayBuffer(){const t=this._readBuffer.shift();this._readSentCount++;const s=t.length;Atomics.store(this._readArray,2,s);for(let e=0;e<s;e++)Atomics.store(this._readArray,3+e,t.charCodeAt(e));Atomics.store(this._readArray,0,this._readSentCount),Atomics.notify(this._readArray,0,1);const{async:e,value:i}=Atomics.waitAsync(this._readArray,1,this._readCount);e?i.then((()=>this._afterRead())):this._afterRead()}_disposing=!1;_isDisposed=!1;_disabling=!1;_readBuffer=[];_readBufferCount=0;_readSentCount=0;_sendStdinNow}class o extends r{constructor(t){super(t)}allowAdjacentNewline(t){this._allowAdjacentNewline=t}poll(t){const s=t>0?t:0;return 4|("not-equal"===Atomics.wait(this._readArray,0,this._readCount,s)?1:0)}read(){if((this.termios.c_iflag&i.tc.IXON)>0&&Atomics.wait(this._readArray,0,this._readCount),Atomics.load(this._readArray,0)===this._readCount)return[];const t=this._loadFromSharedArrayBuffer();this._readCount++,Atomics.store(this._readArray,1,this._readCount),Atomics.notify(this._readArray,1,1);const s=this._processReadChars(t);return this._maybeEchoToOutput(s),s}get termios(){return this._termios}write(t){let s=[];s="string"==typeof t?this._processWriteChars(t.split("").map((t=>t.charCodeAt(0)))):this._processWriteChars(t);let e=s.length,i=0;for(;e>0;){const t=e>this._maxWriteChars;Atomics.store(this._writeArray,0,1),Atomics.store(this._writeArray,1,t?0:e);const r=t?this._maxWriteChars:e;for(let t=0;t<r;t++)Atomics.store(this._writeArray,2+t,s[i+t]);Atomics.notify(this._writeArray,0,1),Atomics.wait(this._writeArray,0,1),e-=this._maxWriteChars,i+=this._maxWriteChars}}_maybeEchoToOutput(t){const s=(this.termios.c_lflag&i.Uq.ECHO)>0,e=(this.termios.c_lflag&i.Uq.ECHONL)>0;if(!s&&!e)return;const r=[];for(const e of t)switch(e){case 10:r.push(10);break;case 4:break;default:s&&r.push(e)}r.length>0&&this.write(r)}_processReadChars(t){const s=[];for(const e of t)switch(e){case 13:this.termios.c_iflag&i.tc.IGNCR||((this.termios.c_iflag&i.tc.ICRNL)>0?s.push(10):s.push(13));break;case 10:(this.termios.c_iflag&i.tc.INLCR)>0?s.push(13):s.push(10);break;default:s.push(e)}return s}_processWriteChars(t){let s=!1,e=0;const r=[];for(let a=0;a<t.length;a++){const o=t[a];switch(s||27!==o||(s=!0,e=a),o){case 10:if(0===this._writeColumn&&!this._allowAdjacentNewline)break;this._writeColumn=0,(this.termios.c_oflag&i.OJ.ONLCR)>0?r.push(13,10):r.push(10);break;default:s||this._writeColumn++,r.push(o)}s&&a>e+2&&(o>=65&&o<=90||o>=97&&o<=122)&&(s=!1)}return r}_termios=i.Gc.newDefaultWasm();_allowAdjacentNewline=!1;_writeColumn=0}},7965:(t,s,e)=>{e.r(s),e.d(s,{Aliases:()=>i.D,BaseShell:()=>d,BaseShellWorker:()=>c.g,BufferedOutput:()=>p.ju,CommandRegistry:()=>_.J,ConsoleOutput:()=>p.pZ,Context:()=>u.o,ControlCharacter:()=>m.hE,ExitCode:()=>f.y,FileInput:()=>p.zp,FileOutput:()=>p.MM,InputAll:()=>p.S9,InputFlag:()=>m.tc,LocalFlag:()=>m.Uq,OutputFlag:()=>m.OJ,Pipe:()=>p.nT,PipeInput:()=>p.Jh,RedirectOutput:()=>p.K_,Shell:()=>A,TerminalInput:()=>p.dl,TerminalOutput:()=>p.mI,Termios:()=>m.Gc,parse:()=>C.qg,tokenize:()=>g.q});var i=e(7450),r=e(7262),a=e(4602),o=e(9017),h=e(898),n=e(9399);class l{packageName;moduleName;outputCallback;constructor(t,s,e){this.packageName=t,this.moduleName=s,this.outputCallback=e}dispose(){this._isDisposed||(this.stop(),this._isDisposed=!0)}get isDisposed(){return this._isDisposed}start(){void 0!==this._intervalId&&this.stop(),this._intervalId=setInterval(this._callback.bind(this),this._delayMs)}stop(){void 0!==this._intervalId&&(clearTimeout(this._intervalId),this._intervalId=void 0,this._callbackCount=0,this._displayed&&this.outputCallback(n.Q.eraseEndLine+n.Q.showCursor),this._displayed=!1)}_callback(){if(this._callbackCount<this._initialIgnore);else if(this._displayed){const t=this._dots[(this._callbackCount-this._initialIgnore)%this._dots.length];this.outputCallback(t+n.Q.cursorLeft(1))}else{const t=` downloading wasm module '${this.moduleName}'`,s=t.length;this.outputCallback(n.Q.hideCursor+this._dots[0]+t+n.Q.cursorLeft(s+1)),this._displayed=!0}this._callbackCount++}_callbackCount=0;_delayMs=100;_dots="⠇⠋⠙⠸⠴⠦";_initialIgnore=3;_intervalId;_isDisposed=!1;_displayed=!1}class d{options;constructor(t){this.options=t,this._bufferedIO=new h.z(t.outputCallback),this._worker=this.initWorker(t),this._initRemote(t).then(this._ready.resolve.bind(this._ready))}async _initRemote(t){this._remote=(0,o.LV)(this._worker);const{mountpoint:s,wasmBaseUrl:e,driveFsBaseUrl:i,initialDirectories:r,initialFiles:a}=t,{sharedArrayBuffer:h}=this._bufferedIO;await this._remote.initialize({color:t.color??!0,mountpoint:s,wasmBaseUrl:e,driveFsBaseUrl:i,sharedArrayBuffer:h,initialDirectories:r,initialFiles:a},(0,o.BX)(this.downloadWasmModuleCallback.bind(this)),(0,o.BX)(this.enableBufferedStdinCallback.bind(this)),(0,o.BX)(this.dispose.bind(this))),this._bufferedIO.registerSendStdinNow(this._remote.input)}dispose(){this._isDisposed||(console.log("Cockle Shell disposed"),this._isDisposed=!0,this._remote=void 0,this._worker.terminate(),void 0!==this._downloadTracker&&(this._downloadTracker.dispose(),this._downloadTracker=void 0),this._bufferedIO.dispose(),this._bufferedIO=void 0,this._disposed.emit())}get disposed(){return this._disposed}downloadWasmModuleCallback(t,s,e){e?(void 0!==this._downloadTracker&&this._downloadTracker.dispose(),this._downloadTracker=new l(t,s,this.options.outputCallback),this._downloadTracker.start()):void 0!==this._downloadTracker&&t===this._downloadTracker.packageName&&s===this._downloadTracker.moduleName&&this._downloadTracker.stop()}get isDisposed(){return this._isDisposed}async enableBufferedStdinCallback(t){this.isDisposed||(t?await this._bufferedIO.enable():await this._bufferedIO.disable())}async input(t){this.isDisposed||(this._bufferedIO.enabled?await this._bufferedIO.push(t):await this._remote.input(t))}get ready(){return this._ready.promise}async setSize(t,s){this.isDisposed||await this._remote.setSize(t,s)}async start(){this.isDisposed||(await this.ready,await this._bufferedIO.start(),await this._remote.start())}_worker;_remote;_bufferedIO;_disposed=new a.Signal(this);_isDisposed=!1;_ready=new r.PromiseDelegate;_downloadTracker}var c=e(1056),_=e(1063),u=e(2101),f=e(3482),p=e(5107),C=e(7497);class A extends d{options;constructor(t){super(t),this.options=t}initWorker(t){return console.log("Cockle Shell.initWorker"),new Worker(new URL(e.p+e.u(281),e.b),{type:void 0})}}var m=e(4133),g=e(9685)},5988:(t,s,e)=>{e.d(s,{p:()=>i});class i{flush(){}supportsAnsiEscapes(){return!1}write(t){console.log(t)}}},5107:(t,s,e)=>{e.d(s,{ju:()=>i.j,pZ:()=>r.p,zp:()=>a.z,MM:()=>o.M,S9:()=>h.S,nT:()=>n.n,Jh:()=>l.J,K_:()=>d,dl:()=>c.d,mI:()=>_.m});var i=e(5670),r=e(5988),a=e(2958),o=e(5981),h=e(1315),n=e(4207),l=e(952);class d extends i.j{constructor(t){super(),this.target=t}flush(){this.data.forEach((t=>this.target.write(t))),this.clear(),this.target.flush()}target}var c=e(8316),_=e(7703)},952:(t,s,e)=>{e.d(s,{J:()=>r});var i=e(1315);class r extends i.S{pipe;constructor(t){super(),this.pipe=t}readAll(){const t=this.pipe.allContent;return this.pipe.clear(),t}}},4133:(t,s,e)=>{var i,r,a,o;e.d(s,{Gc:()=>h,OJ:()=>r,Uq:()=>a,hE:()=>o,tc:()=>i}),function(t){t[t.ISTRIP=32]="ISTRIP",t[t.INLCR=64]="INLCR",t[t.IGNCR=128]="IGNCR",t[t.ICRNL=256]="ICRNL",t[t.IUCLC=512]="IUCLC",t[t.IXON=1024]="IXON",t[t.IXANY=2048]="IXANY",t[t.IMAXBEL=8192]="IMAXBEL",t[t.IUTF8=16384]="IUTF8"}(i||(i={})),function(t){t[t.OPOST=1]="OPOST",t[t.OLCUC=2]="OLCUC",t[t.ONLCR=4]="ONLCR",t[t.OCRNL=8]="OCRNL",t[t.ONOCR=16]="ONOCR",t[t.ONLRET=32]="ONLRET",t[t.TABDLY=6144]="TABDLY"}(r||(r={})),function(t){t[t.ISIG=1]="ISIG",t[t.ICANON=2]="ICANON",t[t.ECHO=8]="ECHO",t[t.ECHOE=16]="ECHOE",t[t.ECHOK=32]="ECHOK",t[t.ECHONL=64]="ECHONL",t[t.NOFLSH=128]="NOFLSH",t[t.ECHOCTL=512]="ECHOCTL",t[t.ECHOPRT=1024]="ECHOPRT",t[t.ECHOKE=2048]="ECHOKE",t[t.IEXTEN=32768]="IEXTEN"}(a||(a={})),function(t){t[t.VINTR=0]="VINTR",t[t.VQUIT=1]="VQUIT",t[t.VERASE=2]="VERASE",t[t.VKILL=3]="VKILL",t[t.VEOF=4]="VEOF",t[t.VTIME=5]="VTIME",t[t.VMIN=6]="VMIN",t[t.VSWTCH=7]="VSWTCH",t[t.VSTART=8]="VSTART",t[t.VSTOP=9]="VSTOP",t[t.VSUSP=10]="VSUSP",t[t.VEOL=11]="VEOL",t[t.VREPRINT=12]="VREPRINT",t[t.VDISCARD=13]="VDISCARD",t[t.VWERASE=14]="VWERASE",t[t.VLNEXT=15]="VLNEXT",t[t.VEOL2=16]="VEOL2"}(o||(o={}));class h{clone(){return{c_iflag:this.c_iflag,c_oflag:this.c_oflag,c_cflag:this.c_cflag,c_lflag:this.c_lflag,c_cc:[...this.c_cc]}}log(t){const s=(t,s,e)=>{const i=[];for(const[s,r]of Object.entries(t).filter((([t,s])=>t[0].match(/\D/))))(e&r)>0&&i.push(s);return`  ${s} = ${e} 0x${e.toString(16)} = ${i.join(" ")}`},e=["Cockle "+t+":"];e.push(s(i,"c_iflag",this.c_iflag)),e.push(s(r,"c_oflag",this.c_oflag)),e.push(`  c_cflag = ${this.c_cflag} 0x${this.c_cflag.toString(16)}`),e.push(s(a,"c_lflag",this.c_lflag)),e.push(`  c_cc = ${this.c_cc}`),console.log(e.join("\n"))}static newDefaultWasm(){const t=new h;return t.setDefaultWasm(),t}set(t){this.c_iflag=t.c_iflag,this.c_oflag=t.c_oflag,this.c_cflag=t.c_cflag,this.c_lflag=t.c_lflag,this.c_cc=[...t.c_cc],this.log("Termios set")}setDefaultWasm(){this.c_iflag=i.IUTF8|i.IMAXBEL|i.IXON|i.ICRNL,this.c_oflag=r.OPOST|r.ONLCR,this.c_cflag=191,this.c_lflag=a.IEXTEN|a.ECHOKE|a.ECHOCTL|a.ECHOK|a.ECHOE|a.ECHO|a.ICANON|a.ISIG,this.c_cc=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.log("Termios setDefaultWasm")}c_iflag=0;c_oflag=0;c_cflag=0;c_lflag=0;c_cc=[]}}}]);