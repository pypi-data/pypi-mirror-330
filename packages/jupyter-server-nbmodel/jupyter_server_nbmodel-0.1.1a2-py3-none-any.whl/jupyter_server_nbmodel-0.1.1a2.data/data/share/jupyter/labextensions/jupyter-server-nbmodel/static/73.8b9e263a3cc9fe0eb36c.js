"use strict";(self.webpackChunkjupyter_server_nbmodel=self.webpackChunkjupyter_server_nbmodel||[]).push([[73],{73:(e,t,o)=>{o.r(t),o.d(t,{default:()=>m});var n=o(209),r=o(310),s=o(123),a=o(59),i=o(421),l=o(625),d=o(262),c=o(256);class u{constructor(e){var t;this._serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:i.ServerConnection.makeSettings()}async runCell({cell:e,notebook:t,notebookConfig:o,onCellExecuted:s,onCellExecutionScheduled:a,sessionContext:i,sessionDialogs:d,translator:c}){var u,m,h;const g=(c=null!=c?c:l.nullTranslator).load("jupyterlab");switch(e.model.type){case"markdown":e.rendered=!0,e.inputHidden=!1,s({cell:e,success:!0});break;case"code":if(i){if(i.isTerminating){await(0,n.showDialog)({title:g.__("Kernel Terminating"),body:g.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(u=i.session)||void 0===u?void 0:u.path),buttons:[n.Dialog.okButton()]});break}if(i.pendingInput)return await(0,n.showDialog)({title:g.__("Cell not executed due to pending input"),body:g.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[n.Dialog.okButton()]}),!1;if(i.hasNoKernel&&await i.startKernel()&&d&&await d.selectKernel(i),i.hasNoKernel)return e.model.sharedModel.transact((()=>{e.model.clearExecution()})),!0;const l=null===(h=null===(m=null==i?void 0:i.session)||void 0===m?void 0:m.kernel)||void 0===h?void 0:h.id,v=r.URLExt.join(this._serverSettings.baseUrl,`api/kernels/${l}/execute`),b=e.model.sharedModel.getSource(),w=e.model.sharedModel.getId(),k=t.sharedModel.getState("document_id"),{recordTiming:y}=o,S={method:"POST",body:JSON.stringify({code:b,metadata:{cell_id:w,document_id:k,record_timing:y}})};a({cell:e});let f=!1;try{const t=await p(e,v,S,this._serverSettings,c);f="ok"===(await t.json()).status}catch(t){if(s({cell:e,success:!1}),e.isDisposed)return!1;throw t}return s({cell:e,success:f}),!0}e.model.sharedModel.transact((()=>{e.model.clearExecution()}),!1)}return Promise.resolve(!0)}}async function p(e,t,o,n,s,l=100){const u=new d.PromiseDelegate;return i.ServerConnection.makeRequest(t,o,n).then((async d=>{if(d.ok)if(202===d.status){let o=d.headers.get("Location")||t;o.startsWith(n.baseUrl)||(o=r.URLExt.join(n.baseUrl,o)),setTimeout((async(e,t,o,n,r,s)=>{try{const a=await p(e,t,o,n,r,s);u.resolve(a)}catch(e){u.reject(e)}}),l,e,o,{method:"GET"},n,s,Math.min(1e3,2*l))}else u.resolve(d);else if(300===d.status){let l=d.headers.get("Location")||"";l.startsWith(n.baseUrl)||(l=r.URLExt.join(n.baseUrl,l));const{parent_header:m,input_request:h}=await d.json(),g=new c.Panel;g.addClass("jp-OutputArea-child"),g.addClass("jp-OutputArea-stdin-item");const v=new a.OutputPrompt;v.addClass("jp-OutputArea-prompt"),g.addWidget(v);const b=new a.Stdin({future:Object.freeze({sendInputReply:(e,t)=>{i.ServerConnection.makeRequest(l,{method:"POST",body:JSON.stringify({input:e.value})},n).catch((t=>{console.error(`Failed to set input to ${JSON.stringify(e)}.`,t)}))}}),parent_header:m,password:h.password,prompt:h.prompt,translator:s});b.addClass("jp-OutputArea-output"),g.addWidget(b);const w=b.node.getElementsByTagName("input")[0];b.value.then((r=>{g.addClass("jp-OutputArea-stdin-hiding"),e.outputArea.model.add({output_type:"stream",name:"stdin",text:r+"\n"}),w.focus(),window.setTimeout((async()=>{const r=document.activeElement;g.dispose(),r&&r instanceof HTMLElement&&r.focus();try{const r=await p(e,t,o,n,s);u.resolve(r)}catch(e){u.reject(e)}}),500)})),e.outputArea.layout.addWidget(g)}else u.reject(await i.ServerConnection.ResponseError.create(d))})).catch((e=>{u.reject(new i.ServerConnection.NetworkError(e))})),u.promise}const m={id:"jupyter-server-nbmodel:notebook-cell-executor",description:"Add notebook cell executor that uses REST API instead of kernel protocol over WebSocket.",autoStart:!0,provides:s.INotebookCellExecutor,activate:e=>new u({serverSettings:e.serviceManager.serverSettings})}}}]);