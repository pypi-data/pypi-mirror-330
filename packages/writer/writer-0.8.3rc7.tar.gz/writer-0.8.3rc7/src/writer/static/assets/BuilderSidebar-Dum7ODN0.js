import{d as E,au as pe,av as fe,c as g,o as m,e as y,f as u,n as P,ag as ge,D as Y,_ as R,i as L,a as V,r as O,aH as ve,aI as Z,w as H,b as x,q as T,x as I,y as Q,t as K,aJ as he,aK as ye,am as ne,Q as U,M as D,L as S,O as oe,u as Ce,W as ee,s as te}from"./index-BHR-aJwi.js";import{T as _e}from"./BuilderApp-CV05m9g_.js";import"./marked.esm-273vDTCT.js";const be={class:"BuilderSidebarPanel"},we={class:"BuilderSidebarPanel__inputContainer"},ke={class:"BuilderSidebarPanel__main"},Be={class:"BuilderSidebarPanel__footer"},Ie=E({__name:"BuilderSidebarPanel",props:pe({placeholder:{type:String,required:!0},searchCount:{type:Number,required:!1,default:void 0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const s=fe(l,"modelValue"),n=l,r=g(()=>{if(n.searchCount!==void 0)return`${n.searchCount} result${n.searchCount===1?"":"s"}`});return(o,i)=>(m(),y("div",be,[u("div",we,[P(ge,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=d=>s.value=d),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:l.placeholder,"right-text":r.value,"enable-clear-button":""},null,8,["modelValue","placeholder","right-text"])]),u("div",ke,[Y(o.$slots,"default",{},void 0,!0)]),u("div",Be,[Y(o.$slots,"footer",{},void 0,!0)])]))}}),ae=R(Ie,[["__scopeId","data-v-99679ce7"]]),Te={class:"header"},Se={class:"tools"},$e=["data-writer-tooltip","data-component-type","onDragstart"],De={class:"name"},xe=E({__name:"BuilderSidebarToolkit",setup(l){const s=L(V.core),n=L(V.builderManager),{removeInsertionCandidacy:r}=ne(s),o=O(""),i=["Layout","Content","Input","Embed","Writer","Logic","Triggers","Other"],d=g(()=>n.getMode()=="workflows"?"workflows":"core"),$=g(()=>{const f=i.map(c=>[c,_(c)]).filter(([c,b])=>b.length>0);return Object.fromEntries(f)}),M=g(()=>{if(o.value)return Object.values($.value).reduce((f,c)=>f+c.length,0)}),C=g(()=>d.value=="core"?"Core toolkit":d.value=="workflows"?"Workflows toolkit":"Toolkit");function _(f){const b=ve().filter(h=>{const w=Z(h);return!(w.category!=f||!w.toolkit&&d.value!=="core"||w.toolkit&&w.toolkit!==d.value)}).map(h=>{const{name:w,description:j,category:F}=Z(h);return{type:h,name:w,description:j,category:F??"Other"}}),k=o.value.toLocaleLowerCase();return b.filter(h=>!k||h.name.toLocaleLowerCase().includes(k))}function q(f,c){n.setSelection(null),f.dataTransfer.setData(`application/json;writer=${c},`,"{}")}function A(f){r(f)}function W(f){return[`/components/${f.type}.svg`,`/components/category_${f.category}.svg`].map(c=>ye(c))}return H(d,()=>{o.value=""}),(f,c)=>(m(),x(ae,{modelValue:o.value,"onUpdate:modelValue":c[1]||(c[1]=b=>o.value=b),class:"BuilderSidebarToolkit",placeholder:C.value,"search-count":M.value},{default:T(()=>[(m(!0),y(I,null,Q($.value,(b,k)=>(m(),y("div",{key:k,class:"category"},[u("div",Te,K(k),1),u("div",Se,[(m(!0),y(I,null,Q(b,a=>(m(),y("div",{key:a.type,class:"tool","data-writer-tooltip":a.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":a.type,onDragend:c[0]||(c[0]=h=>A(h)),onDragstart:h=>q(h,a.type)},[P(he,{alt:`(Icon for ${a.name})`,draggable:"false",urls:W(a)},null,8,["alt","urls"]),u("div",De,K(a.name),1)],40,$e))),128))])]))),128))]),_:1},8,["modelValue","placeholder","search-count"]))}}),Le=R(xe,[["__scopeId","data-v-3af871a9"]]);function re(l,s){function n(r){if(!s.value)return!0;const o=l.getComponentDefinition(r.type);return!!(o!=null&&o.name.toLocaleLowerCase().includes(s.value)||Object.values(r.content).filter(d=>d.toLocaleLowerCase().includes(s.value)).length>0)}return{isComponentMatchingQuery:n}}function Ve(l,s,n){const{isComponentMatchingQuery:r}=re(l,s);return{searchResultCount:g(()=>{if(!s.value)return;let i=0;for(const d of l.getComponentsNested(n.value))r(d)&&i++;return i})}}function Me(l,s,n){const{isComponentMatchingQuery:r}=re(l,s),o=g(()=>!s.value||r(n.value));return{hasMatchingChildren:g(()=>{if(!s.value)return!0;for(const d of l.getComponentsNested(n.value.id))if(r(d))return!0;return!1}),matched:o}}const qe={class:"BuilderSidebarComponentTreeBranch__nameRight"},Pe={class:"previewText"},Ee=E({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(l,{emit:s}){const n=l,r=O(),o=L(V.core),i=L(V.builderManager),d=O(!1),$=g(()=>i.isComponentIdSelected(n.componentId)),{createAndInsertComponent:M,moveComponent:C,goToComponentParentPage:_,isDraggingAllowed:q}=oe(o,i),{getComponentInfoFromDrag:A,removeInsertionCandidacy:W,isParentSuitable:f}=ne(o),{isComponentVisible:c}=Ce(o),b=s,k=g(()=>{var t;return((t=n.query)==null?void 0:t.toLocaleLowerCase())??""}),a=g(()=>o.getComponentById(n.componentId)),{hasMatchingChildren:h,matched:w}=Me(o,k,a);H(h,t=>{var e;return(e=r.value)==null?void 0:e.toggleCollapse(!t)},{immediate:!0});const j=g(()=>o.getComponents(n.componentId,{sortedByPosition:!0})),F=g(()=>{var B,N;const t=(B=X.value)==null?void 0:B.previewField;if(!t)return;const e=(N=a.value.content)==null?void 0:N[t];let p;const v=70;return(e==null?void 0:e.length)>v?p=e.substring(0,v)+"...":p=e,p}),X=g(()=>o.getComponentDefinition(a.value.type)),le=g(()=>{var e,p,v,B;const t=a.value.type;return t=="html"&&((e=a.value.content)!=null&&e.element)?(p=a.value.content)==null?void 0:p.element:t=="workflows_workflow"?((v=a.value.content)==null?void 0:v.key)||"Workflow":((B=X.value)==null?void 0:B.name)??`Unknown (${a.value.type})`});async function ie(t){_(n.componentId),await U(),i.handleSelectionFromEvent(t,n.componentId,void 0,"tree"),z()}function z(){r.value&&(r.value.expand(),d.value=!1,b("expandBranch"),G({onlyHorizontal:!0}))}function G(t){var J;const e=(J=r.value)==null?void 0:J.$el;if(!e)return;const p=e.closest(".BuilderSidebarComponentTree"),v=p.getBoundingClientRect(),B=r.value.$el.offsetTop-v.height/2,N=r.value.$el.offsetLeft-v.left-16;p.scrollTo({top:t!=null&&t.onlyHorizontal?void 0:B,left:Math.max(0,N),behavior:"smooth"})}function ue(t){i.setSelection(null),t.dataTransfer.setData(`application/json;writer=${a.value.type},${a.value.id}`,"{}")}function de(t){W(t)}function ce(t){const e=A(t);if(!e)return;const{draggedType:p,draggedId:v}=e;f(n.componentId,v,p)&&t.preventDefault()}function me(t){const e=A(t);if(!e)return;const{draggedType:p,draggedId:v}=e;v?C(v,a.value.id):M(p,a.value.id),W(t)}return H(i.firstSelectedItem,async t=>{t&&t.componentId===n.componentId&&t.source!="tree"&&(z(),await U(),G())},{immediate:!0}),(t,e)=>(m(),x(_e,{ref_key:"treeBranch",ref:r,class:"BuilderSidebarComponentTreeBranch","component-id":l.componentId,name:le.value,query:l.query,"has-children":j.value.length>0,"data-automation-key":a.value.type,draggable:S(q)(l.componentId),matched:S(w),selected:$.value,onSelect:ie,onDragover:ce,onDragstart:ue,onDragend:de,onDrop:me},{nameRight:T(()=>[u("span",qe,[Object.keys(a.value.handlers??{}).length>0?(m(),y(I,{key:0},[e[0]||(e[0]=u("span",{class:"middot"},null,-1)),e[1]||(e[1]=u("i",{class:"material-symbols-outlined"},"bolt",-1))],64)):D("",!0),S(c)(a.value.id)?D("",!0):(m(),y(I,{key:1},[e[2]||(e[2]=u("span",{class:"middot"},null,-1)),e[3]||(e[3]=u("i",{class:"material-symbols-outlined"},"visibility_off",-1))],64)),a.value.isCodeManaged?(m(),y(I,{key:2},[e[4]||(e[4]=u("span",{class:"middot"},null,-1)),e[5]||(e[5]=u("i",{class:"material-symbols-outlined"},"terminal",-1))],64)):D("",!0),F.value?(m(),y(I,{key:3},[e[6]||(e[6]=u("span",{class:"middot"},null,-1)),u("span",Pe,K(F.value),1)],64)):D("",!0)])]),children:T(()=>[(m(!0),y(I,null,Q(j.value,p=>(m(),x(se,{key:p.id,"component-id":p.id,query:l.query,onExpandBranch:z},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected"]))}}),se=R(Ee,[["__scopeId","data-v-18781cad"]]),Re={class:"add"},Ae=E({__name:"BuilderSidebarComponentTree",setup(l){const s=L(V.core),n=L(V.builderManager),r=O(""),{createAndInsertComponent:o}=oe(s,n),i=n.activeRootId,{searchResultCount:d}=Ve(s,r,i);async function $(){const C=o("page","root");s.setActivePageId(C),await U(),n.setSelection(C)}async function M(){const C=o("workflows_workflow","workflows_root");s.setActivePageId(C),await U(),n.setSelection(C)}return(C,_)=>(m(),x(ae,{modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=q=>r.value=q),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":S(d)},{footer:T(()=>[u("div",Re,[S(i)=="root"?(m(),x(ee,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:$},{default:T(()=>_[1]||(_[1]=[u("i",{class:"material-symbols-outlined"}," add ",-1),te(" Add page")])),_:1})):D("",!0),S(i)=="workflows_root"?(m(),x(ee,{key:1,variant:"special",size:"small","data-automation-action":"add-workflow",onClick:M},{default:T(()=>_[2]||(_[2]=[u("i",{class:"material-symbols-outlined"}," add ",-1),te(" Add workflow")])),_:1})):D("",!0)])]),default:T(()=>[u("div",null,[P(se,{class:"rootBranch","component-id":S(i),query:r.value},null,8,["component-id","query"])])]),_:1},8,["modelValue","search-count"]))}}),We=R(Ae,[["__scopeId","data-v-e3959e2b"]]),je={class:"BuilderSidebar"},Fe=E({__name:"BuilderSidebar",setup(l){return(s,n)=>(m(),y("div",je,[P(Le),P(We)]))}}),ze=R(Fe,[["__scopeId","data-v-c1777f55"]]);export{ze as default};
