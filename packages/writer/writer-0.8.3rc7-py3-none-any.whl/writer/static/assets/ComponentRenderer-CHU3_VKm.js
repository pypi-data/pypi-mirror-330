import{d as O,i as B,a as _,c as v,o as k,b as Z,B as pe,e as V,f as d,t as A,g as me,r as x,p as I,w as G,F as ve,h as D,u as N,_ as U,j as fe,k as ge,l as ee,m as Y,v as J,n as te,q as _e,s as he,W as ye,x as Ce,y as be,z as oe,A as Se,C as we,D as Ee,E as Pe,G as Ie,H as Te,I as Me,J as Q}from"./index-BHR-aJwi.js";import{f as $e}from"./instancePath-BsbOTTI8.js";const ke=10,De=O({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(S){const n=B(_.core),p=S,u=(y,l)=>{const w=y.map(c=>n.getComponentDefinition(c)).map(c=>c==null?void 0:c.name);return`${w.slice(0,-1).join(", ")} ${w.length>1?l:""} ${w.at(-1)}`},a=v(()=>{const y=n.getContainableTypes(p.componentId);let l;return y.length<=ke&&(l=`You can add ${u(y,"and")} components`),l});return(y,l)=>(k(),Z(pe,{class:"ChildlessPlaceholder","component-id":S.componentId,message:a.value},null,8,["component-id","message"]))}}),Ae={class:"RenderError"},Be={class:"title"},Re={class:"message"},Ve=O({__name:"RenderError",props:{componentType:{},message:{}},setup(S){const n=S;return(p,u)=>(k(),V("div",Ae,[d("div",Be,[d("h2",null,"Error rendering "+A(n.componentType),1)]),d("div",Re,A(n.message),1)]))}}),xe={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(S){const n=B(_.core),p=B(_.builderManager),u=S.componentId,a=v(()=>n.getComponentById(u)),y=me(a.value.type),l=S.instancePath,T=S.instanceData,{getEvaluatedFields:w,isComponentVisible:f}=N(n),c=w(l),P=v(()=>n.getComponents(u,{sortedByPosition:!0})),E=v(()=>!!p&&p.getMode()!="preview"),j=v(()=>{var e;return E.value&&!a.value.isCodeManaged&&a.value.type!=="root"&&a.value.type!=="workflows_root"&&((e=q.value)==null?void 0:e.toolkit)!=="workflows"}),L=(e,s)=>(e?n.getContainableTypes(e):["root","workflows_root"]).includes(s),R=x(!1),t=()=>{if(!(P.value.length>0))return D(De,{componentId:a.value.id})},o=(e,s=0,i)=>D(ne,{componentId:e,key:`${e}:${s}`,instancePath:[...l,{componentId:e,instanceNumber:s}],instanceData:[...T,x(null)],...i??{}}),r=e=>s=>{if(!L(u,s.type)&&e==="default")return!0;const g=n.getComponentDefinition(s.type).slot??"default";return g==="*"||g===e},m=(e=0,s="default",i=()=>!0,g=!1)=>{const C=h=>!E.value||g?[]:[D("div",{"data-writer-slot-of-id":u,"data-writer-position":h})],b=P.value.filter(r(s)).filter(i),$=b.filter(h=>!h.isCodeManaged).map(h=>o(h.id,e,{contextSlot:s})),W=b.filter(h=>h.isCodeManaged).map(h=>o(h.id,e,{contextSlot:s}));return[...C(0),...$.map((h,H)=>[h,C(H+1)]).flat(),...W]},M=$e(l);I(_.evaluatedFields,c),I(_.componentId,u),I(_.isBeingEdited,E),I(_.isDisabled,R),I(_.instancePath,l),I(_.instanceData,T),I(_.renderProxiedComponent,o),I(_.getChildrenVNodes,m),I(_.flattenedInstancePath,M);const F={"data-writer-id":u,"data-writer-instance-path":M},q=v(()=>n.getComponentDefinition(a.value.type)),z=v(()=>{var e;return(e=q.value)==null?void 0:e.fields}),K=x(!1);G(()=>p==null?void 0:p.isComponentIdSelected(u),e=>{K.value=e});const se=v(()=>Object.entries(z.value).filter(([,e])=>e.category===ve.Style).reduce((e,[s])=>(e[s]=c[s].value,e),{}));G(se,()=>K.value=!1);const X=v(()=>P.value.length==0),ae=v(()=>f(u,l)),re=(e,s)=>{if((!e||!(e!=null&&e.startsWith("$goToPage_")))&&!s)return g=>{n.forwardEvent(g,l,!0)};if(e!=null&&e.startsWith("$goToPage_")){const g=e.substring(10);return C=>n.setActivePageFromKey(g)}return null},le=v(()=>{const e={};return Object.keys(q.value.events??{}).forEach(i=>{var b;const g=`on${i.charAt(0).toUpperCase()}${i.slice(1)}`,C=i===((b=a.value.binding)==null?void 0:b.eventType);e[g]=$=>{var h,H;C&&n.forwardEvent($,l,!0);const W=((h=a.value.handlers)==null?void 0:h[i])??null;(H=re(W,C))==null||H($)}}),e}),ie=v(()=>{const e=z.value;if(!e)return;const s={};return Object.keys(e).forEach(i=>{e[i].applyStyleVariable&&c[i]&&(s[`--${i}`]=c[i].value)}),s}),ce=v(()=>{const e="cssClasses",s=z.value;if(!s||!s[e]||!c[e])return;const i=String(c[e].value),g=i==null?void 0:i.split(" ").map(b=>b.trim()),C={};return g.forEach(b=>{C[b]=!0}),C}),de=function(){return{class:{[`wf-type-${a.value.type}`]:!0,component:!0,childless:X.value,selected:K.value,disabled:R.value,beingEdited:E.value,...ce.value},style:{...ie.value,...ae.value?{}:{display:"none"}},...F,...R.value?[]:le.value,draggable:j.value}},ue=(e,s)=>E.value?D(Ve,{...e,componentType:a.value.type,message:s}):D("div");return()=>{const e=E.value?t():void 0,s=({instanceNumber:g=0,slotName:C="default",componentFilter:b=()=>!0,positionlessSlot:$=!1})=>X.value?$?void 0:e:m(g,C,b,$),i={...de()};return L(a.value.parentId,a.value.type)?D(y,i,{default:s}):ue(i,"Parent is not suitable for this component")}}},ne=U(xe,[["__scopeId","data-v-e606b8cb"]]),Le={class:"counter"},Fe={class:"main"},We={class:"clearContainer"},He={class:"content"},Oe={class:"title"},je={class:"time"},qe={class:"message"},ze=100,Ke=O({__name:"RendererNotifications",setup(S){const n=B(_.core),p=x(!1),u=fe("balloon"),a=ge([]),y=w=>{const{type:f,title:c,message:P,code:E}=w;a.unshift({type:f,title:c,message:P,code:E,timestampReceived:new Date}),a.splice(ze),u.value.classList.remove("alert"),u.value.offsetWidth,u.value.classList.add("alert")};ee(()=>{n.addMailSubscription("notification",y)});const l=()=>{a.length!=0&&(p.value=!p.value)},T=()=>{a.splice(0),p.value=!1};return(w,f)=>Y((k(),V("div",{class:"RendererNotifications colorTransformer",onClick:l},[d("div",{ref_key:"balloon",ref:u,class:"balloon",title:"Toggle notifications"},[f[0]||(f[0]=d("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),d("div",Le,A(a.length),1)],512),f[3]||(f[3]=d("div",{class:"balloonFlash"},null,-1)),Y(d("div",Fe,[d("div",We,[te(ye,{onClick:T},{default:_e(()=>f[1]||(f[1]=[d("i",{class:"material-symbols-outlined"}," clear_all ",-1),he(" Clear all ")])),_:1})]),(k(!0),V(Ce,null,be(a,(c,P)=>(k(),V("div",{key:P,class:"notification"},[d("div",{class:oe(["icon",c.type])},f[2]||(f[2]=[d("i",{class:"material-symbols-outlined"}," exclamation ",-1)]),2),d("div",He,[d("header",null,[d("strong",Oe,A(c.title),1),d("span",je,A(c.timestampReceived.toLocaleTimeString()),1)]),d("div",qe,A(c.message),1)])]))),128))],512),[[J,p.value]])],512)),[[J,a.length>0]])}}),Ge=U(Ke,[["__scopeId","data-v-0ffb1f63"]]),Ue={class:"rootComponentArea"},Xe=O({__name:"ComponentRenderer",setup(S){const n=B(_.core),p=B(_.builderManager),u=N(n),a={},y=v(()=>(p==null?void 0:p.activeRootId.value)??"root"),l=u.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),T=v(()=>{var t,o,r,m,M,F;return{...Se,"--accentColor":(t=l.accentColor)==null?void 0:t.value,"--emptinessColor":(o=l.emptinessColor)==null?void 0:o.value,"--containerBackgroundColor":(r=l.parentIdBackgroundColor)==null?void 0:r.value,"--primaryTextColor":(m=l.primaryTextColor)==null?void 0:m.value,"--secondaryTextColor":(M=l.secondaryTextColor)==null?void 0:M.value,"--separatorColor":(F=l.separatorColor)==null?void 0:F.value}}),w=v(()=>n.frontendMessageMap.value.size>0);G(()=>{var t;return(t=l.appName)==null?void 0:t.value},t=>{t!=""&&f(t)},{immediate:!0});function f(t){const o=n.mode.value;let r;t&&o=="edit"?r=`${t} | Writer Framework | Builder`:!t&&o=="edit"?r="Writer Framework | Builder":t&&o=="run"?r=`${t}`:!t&&o=="run"&&(r="Writer Framework App"),document.title=r}async function c(t,o){const r=document.querySelector(`[data-writer-stylesheet-key="${t}"]`);r==null||r.remove();const m=document.createElement("link");m.dataset.writerStylesheetKey=t,m.setAttribute("href",o),m.setAttribute("rel","stylesheet"),document.head.appendChild(m)}async function P(t,o){const r=document.querySelector(`[data-writer-script-key="${t}"]`);r==null||r.remove();const m=document.createElement("script");m.dataset.writerScriptKey=t,m.src=o,m.setAttribute("rel","modulepreload"),document.head.appendChild(m)}async function E(t,o){a[t]=o,await Q(()=>import(o),[],import.meta.url)}async function j(t,o,r){const m=a[t],M=await Q(()=>import(m),[],import.meta.url);if(!M){console.warn(`The module with key "${t}" cannot be found. Please check that it has been imported.`);return}M[o](...r)}function L(){n.addMailSubscription("fileDownload",t=>{const o=document.createElement("a");o.href=t.data,o.download=t.fileName,o.click()}),n.addMailSubscription("openUrl",t=>{const o=document.createElement("a");o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.click()}),n.addMailSubscription("pageChange",t=>{Ie(t)}),n.addMailSubscription("routeVarsChange",t=>{Te(t)}),n.addMailSubscription("importStylesheet",({stylesheetKey:t,path:o})=>{c(t,o)}),n.addMailSubscription("importScript",({scriptKey:t,path:o})=>{P(t,o)}),n.addMailSubscription("importModule",({moduleKey:t,specifier:o})=>{E(t,o)}),n.addMailSubscription("functionCall",({moduleKey:t,functionName:o,args:r})=>{j(t,o,r)})}function R(){const t=Me(),o=new CustomEvent("wf-app-open",{detail:{payload:t}}),r={componentId:"root",instanceNumber:0};n.forwardEvent(o,[r],!0)}return we(()=>{L()}),ee(()=>{R()}),(t,o)=>(k(),V("main",{class:oe(["ComponentRenderer",{loadingActive:w.value}]),tabindex:"-1",style:Pe(T.value)},[te(Ge,{class:"notifications"}),o[0]||(o[0]=d("div",{class:"loadingBar"},null,-1)),d("div",Ue,[(k(),Z(ne,{key:y.value,"component-id":y.value,"instance-path":[{componentId:y.value,instanceNumber:0}],"instance-data":[x(null)]},null,8,["component-id","instance-path","instance-data"])),Ee(t.$slots,"default",{},void 0,!0)])],6))}}),Qe=U(Xe,[["__scopeId","data-v-ca7ac208"]]);export{Qe as default};
