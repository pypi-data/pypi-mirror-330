"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[3933],{76314:(e,t,r)=>{r.r(t),r.d(t,{canOpenDrillthroughOnSelection:()=>p,getDrillthroughWidgetFilters:()=>C,pluginMenuItemOpenDrillthrough:()=>D});var n=r(74389),i=r(93345),l=r(95889),a=r(73387),o=r(20192),s=r(52092),u=r(86453),h=r(55613),m=r(55626),c=r(68195),d=r(667),g=r(70312);function p(e){return void 0!==e&&!(e.axes&&e.axes.length>0)&&void 0!==e.cells&&1===e.cells.length&&void 0!==e.cells[0].value}var f=r(65057),b=r(83519),y=r(16673);function x(e,t){const{dimensionName:r,hierarchyName:n}=e;return t.some((e=>(0,y.q)(e,{dimensionName:r,hierarchyName:n})))}function C({sourceWidgetFilters:e,tuple:t}){return[...(e||[]).filter((e=>!x(e,t))),...t.map((({dimensionName:e,hierarchyName:t,namePath:r})=>({type:"members",dimensionName:e,hierarchyName:t,members:[r]})))]}const D={key:"open-drillthrough",useMenuItem:e=>{const{selection:t,widgetState:r}=e,{cube:y}=(0,g.useCube)(r),{formatMessage:D}=(0,l.useIntl)(),v=(0,s.g)(),N=(0,i.useMemo)((()=>{if(p(t))return t.cells[0].tuple.filter((e=>(0,m.t)(e)||!(0,o.isTotal)((0,c.q)(e,y),e)))}),[y,t]),k=(0,i.useMemo)((()=>{if(N){const e=N.filter((e=>!(0,m.t)(e)));return D({id:"aui.plugins.menu-item.open-drillthrough.openDrillthrough"},{member:e.length>0?(0,o.getTupleCaption)(e,{captionForTotals:D({id:"aui.total"}),cube:y,separator:", ",hasOnlyCaptionForLeafLevels:!0}):void 0})}}),[D,N,y]),q=(0,i.useCallback)((async()=>{if(v&&k&&N&&(0,a.M)(e)){const t=(0,u.z)(e.dashboardState.pagesOrder),n=e.dashboardState.pagesOrder.indexOf(v),i=e.dashboardState.pages[v];if(void 0===r.query.mdx)return;const l=function({name:e,sourceWidget:t,sourceWidgetPage:r,tuple:n,cube:i}){const l=C({sourceWidgetFilters:t.filters,tuple:n}),a={mdx:(0,f.getDefaultMdxDrillthrough)(i.name)};t.query.mdx&&t.query.mdx.withClause&&(a.mdx.select.withClause=t.query.mdx.withClause);const o=(r.filters||[]).filter((e=>!x(e,n)));return{name:e,content:{0:{...b._.initialState,shouldUseDefaultColumns:!0,query:a,serverKey:t.serverKey,initialCubeName:i.name,filters:l}},layout:{direction:"column",children:[{leafKey:"0",size:1}]},filters:o}}({name:k,sourceWidget:r,sourceWidgetPage:i,tuple:N,cube:y}),a=(0,h.H)(e.dashboardState,{page:l,key:t,index:n+1});e.onDashboardChange(a),e.onActivePageChange(t)}}),[v,y,k,e,N,r]);if((0,a.M)(e)&&N&&r.query.mdx)return{icon:(0,n.Y)(d.IconDrillthrough,{}),label:k,onClick:q}},translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"},"fr-FR":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {sur {member}}\n          }"}}}}}]);