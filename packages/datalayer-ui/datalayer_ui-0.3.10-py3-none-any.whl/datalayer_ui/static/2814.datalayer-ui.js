"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[2814,8269,650,2426],{59651:(e,t,n)=>{n.d(t,{m:()=>l});var s=n(9387),r=n(98754),i=n(154),a=n(28570),o=n(18683);function l(e){const{serviceManager:t,kernelId:n,onClick:l,onUpdate:c}=e,[d,h]=(0,s.useState)();return(0,s.useEffect)((()=>{t.kernels.findById(n).then((e=>{h(e)}))}),[n,t]),d?(0,o.jsxs)(r.A,{display:"flex",style:{alignItems:"center"},children:[(0,o.jsx)(r.A,{style:{padding:"0 4px",userSelect:"none"},children:(0,o.jsx)(i.Cx,{type:"credits"})}),(0,o.jsx)(a.Z,{startedAt:parseFloat(d.started_at),expiredAt:d.expired_at?parseFloat(d.expired_at):void 0,burningRate:d.burning_rate,onClick:l,onUpdate:c,style:{cursor:"pointer"}})]}):(0,o.jsx)(o.Fragment,{})}},76417:(e,t,n)=>{n.d(t,{w2:()=>c});var s=n(9387),r=n(22462),i=n(18683);const a=r.Ay.div`
  position: fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.3);
  height: 100vh;
  width: 100vw;
  right: 0;
  top: 0;
  z-index: 1000000000;
`;function o({open:e,element:t}){return e?(0,i.jsx)(a,{children:t}):(0,i.jsx)(i.Fragment,{})}const l=(0,s.createContext)({openBackdrop:e=>{},closeBackdrop:()=>{}}),c=({children:e})=>{const[t,n]=(0,s.useState)(!1),[r,a]=(0,s.useState)();return(0,i.jsxs)(l.Provider,{value:{openBackdrop:e=>{a(e),n(!0)},closeBackdrop:()=>{a(void 0),n(!1)}},children:[(0,i.jsx)(o,{open:t,element:r}),e]})}},42537:(e,t,n)=>{n.r(t),n.d(t,{JupyterLabHeadless:()=>g,default:()=>y});var s=n(9387),r=n(94843),i=n(97283),a=n(7282);const o=(0,i.y)(((e,t)=>({jupyterLabAdapter:void 0,setJupyterLabAdapter:t=>e((e=>({jupyterLabAdapter:t}))),plugin:e=>t().jupyterLabAdapter?.plugin(e)})));var l=n(71987),c=n(78772),d=n(29491),h=n(74235),u=n(43600),p=n(68732),m=n(18683);const g=()=>{const[e,t]=(0,s.useState)(),{setJupyterLabAdapter:n}=(0,a.Pj)(o,i);var i;return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(r.C,{serverless:!1,headless:!0,nosplash:!0,plugins:[l,c,d,h,u,p],disabledPlugins:["@jupyterlab/apputils-extension:sessionDialogs","@jupyterlab/docmanager-extension:manager","@jupyterlab/running-extension:plugin","@jupyterlab/running-extension:sidebar","@jupyterlab/apputils-extension:announcements"],onJupyterLab:async e=>{t(e),n(e)}})})},y=g},29885:(e,t,n)=>{n.d(t,{z:()=>w});var s=n(98754),r=n(14466),i=n(63711),a=n(22462),o=n(23530),l=n(320),c=n(44536),d=n(9175),h=n(6681),u=n(47785),p=n(38621),m=n(25365),g=n(29197),y=n(14137),f=n(18683);const _=e=>{const{baseURL:t=""}=e,{configuration:n}=(0,l._O)(),s=(0,o.Z)();return(0,f.jsxs)(d.W,{children:[(0,f.jsx)(d.W.Anchor,{children:(0,f.jsx)(h.K,{icon:p.tno,variant:"invisible","aria-label":"jupyter-runtimes-more"})}),(0,f.jsx)(d.W.Overlay,{width:"medium",children:(0,f.jsxs)(u.l,{children:[(0,f.jsxs)(u.l.Group,{children:[(0,f.jsx)(u.l.GroupHeading,{children:"Moreâ€¦"}),!n?.whiteLabel&&(0,f.jsxs)(u.l.Item,{onSelect:()=>s(`/${t}/settings`),children:[(0,f.jsx)(u.l.LeadingVisual,{children:(0,f.jsx)(m.A,{})}),"Settings",(0,f.jsx)(u.l.Description,{variant:"block",children:"Configure your personal settings."})]}),(0,f.jsxs)(u.l.Item,{onSelect:()=>s(`/${t}/about`),children:[(0,f.jsx)(u.l.LeadingVisual,{children:(0,f.jsx)(g.A,{})}),"About",(0,f.jsx)(u.l.Description,{variant:"block",children:"About Runtimes."})]})]}),!n?.whiteLabel&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(u.l.Divider,{}),(0,f.jsxs)(u.l.Item,{variant:"danger",onSelect:e=>s(`/${t}/logout`),children:[(0,f.jsx)(u.l.LeadingVisual,{children:(0,f.jsx)(y.A,{})}),"Logout"]})]})]})})]})};var v=n(7652);const x=a.Ay.div`
  box-sizing: border-box !important;
  color: var(--fgColor-default);
  &:focus { color: var(--fgColor-muted); }
  &:hover { color: var(--fgColor-muted); }
`;function b(e){const{baseURL:t="",onlyLogin:n=!1}=e,{configuration:s}=(0,l._O)(),{user:a}=(0,c.Y)(),d=(0,o.Z)();return(0,f.jsx)(r.A,{sx:{backgroundColor:"canvas.subtle",color:"fg.default",paddingTop:0,height:45,paddingBottom:0},children:a?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(r.A.Item,{full:!!a,children:(0,f.jsx)(r.A.Link,{onClick:e=>d(i.URLExt.join("/",t),e),children:(0,f.jsx)(x,{children:"Home"})})}),(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>d(i.URLExt.join("/",t,"runtimes"),e),children:(0,f.jsx)(x,{children:"Runtimes"})})}),(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>d(i.URLExt.join("/",t,"environments"),e),children:(0,f.jsx)(x,{children:"Environments"})})}),(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>d(i.URLExt.join("/",t,v.lx),e),children:(0,f.jsx)(x,{children:"Usage"})})}),(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>d(i.URLExt.join("/",t,"docs"),e),children:(0,f.jsx)(x,{children:"Documentation"})})}),(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>d(i.URLExt.join("/",t,v.uP),e),children:(0,f.jsx)(x,{children:"Support"})})}),!n&&!s?.whiteLabel&&(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>d(`/${t}/profile`,e),children:(0,f.jsx)(x,{children:"Profile"})})}),!n&&(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(_,{baseURL:t})})]}):(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(r.A.Item,{children:(0,f.jsx)(r.A.Link,{onClick:e=>{d(`/${t}/login`,e)},children:(0,f.jsx)(x,{children:"Login"})})})})})}function w(e){const{children:t,baseURL:n,onlyLogin:r}=e;return(0,f.jsxs)(s.A,{sx:{fontFamily:"normal",color:"fg.default"},children:[(0,f.jsx)(b,{baseURL:n,onlyLogin:r}),t]})}},74235:(e,t,n)=>{n.r(t),n.d(t,{datalayerCorePlugin:()=>Re,default:()=>Me});var s=n(16255),r=n(59179),i=n(41665),a=n(62863),o=n(69584),l=n(97371),c=n(98238),d=n(40358),h=n(63711),u=n(97789);async function p(e="",t={}){const n=u.ServerConnection.makeSettings(),s=h.URLExt.join(n.baseUrl,"datalayer",e);let r;try{r=await u.ServerConnection.makeRequest(s,t,n)}catch(e){throw new u.ServerConnection.NetworkError(e)}let i=await r.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new u.ServerConnection.ResponseError(r,i.message||i);return i}var m=n(88037),g=n(9387),y=n(26573),f=n(84261),_=n(98754),v=n(91079),x=n(42108),b=n(69541),w=n(90764),j=n(75147),k=n(18683);const C=e=>{const{version:t}=e;return(0,k.jsx)(j.a,{version:t,title:"Datalayer Core",icon:(0,k.jsx)(w.A,{colored:!0,size:32}),description:"Îž Datalayer Core contains base application classes and configuration used by other package."})};var S=n(21854),A=n(77578),R=n(33436),M=n(91719),E=n(86101),P=n(43),N=n(94489),D=n(25365),T=n(61458),F=n(97582),L=n(97096),I=n(44742),O=n(59612),K=n(96566),U=n(54191),$=n(4899),V=n(11757),z=n(88962),q=n(14282),W=n(9171);function J(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class H{constructor(e){J(this,"_plugins",void 0),J(this,"_nodes",new Map),J(this,"_edges",new Array),J(this,"_categories",new Map),J(this,"_filter",""),J(this,"_requires",!0),J(this,"_optional",!0),this._plugins=e.plugins,this.update()}_asCategory(e){const t=e.split(":");return t.length>1?t[0]:e}_addNode(e){const t=this._asCategory(e);this._nodes.set(e,{id:e,name:e,category:t}),this._addCategory(t)}_addEdge(e,t){this._edges.push({source:e,target:t})}_addCategory(e){this._categories.set(e,{name:e})}update(){const{plugins:e,filter:t,requires:n,optional:s}=this;e.forEach(((e,r)=>{const i=e=>""===t||!!e.toLowerCase().match(t.toLowerCase());let a=r;e.provides&&(a=e.provides.name),i(a)&&this._addNode(a),n&&(e.requires??[]).forEach((e=>{(i(e.name)||i(a))&&(this._addNode(e.name),this._addNode(a),this._addEdge(a,e.name))})),s&&(e.optional??[]).forEach((e=>{(i(e.name)||i(a))&&(this._addNode(e.name),this._addNode(a),this._addEdge(a,e.name))}))}))}get plugins(){return this._plugins}get filter(){return this._filter}set filter(e){this._filter=e}get requires(){return this._requires}set requires(e){this._requires=e}get optional(){return this._optional}set optional(e){this._optional=e}get nodes(){return Array.from(this._nodes.values()).sort(((e,t)=>e.id.localeCompare(t.id)))}get edges(){return this._edges}get categories(){return Array.from(this._categories.values()).sort(((e,t)=>e.name.localeCompare(t.name)))}}I.Y([q.a,K.a,U.a,$.a,V.a,z.a]);const B=e=>{const{jupyterFrontend:t}=e,[n,s]=(0,g.useState)(void 0);return(0,g.useEffect)((()=>{const e=t._plugins,n=new H({plugins:e}),r={showLoading:!0,tooltip:{},legend:[{orient:"vertical",x:"left",right:10,data:n.categories.map((function(e){return e.name}))}],animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",series:[{name:"JupyterLab Plugins",type:"graph",layout:"circular",center:["30%","45%"],circular:{rotateLabel:!0},data:n.nodes,links:n.edges,categories:n.categories,roam:!0,label:{position:"right",formatter:"{b}"},lineStyle:{color:"source",curveness:.3}}]};s(r)}),[t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Plugins"})})}),n&&(0,k.jsx)(W.A,{echarts:O,option:n,style:{height:"calc(100vh - 200px)"},notMerge:!0,lazyUpdate:!0})]})};var G=n(76818),Y=n(58078),Q=n(83278),X=n(12266),Z=n(4902);class ee{constructor(e){var t,n,s;t=this,s=void 0,(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_fileType"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this._fileType=e}get id(){return this._fileType.name}get name(){return this._fileType.name}get displayName(){return this._fileType.displayName}get fileFormat(){return this._fileType.fileFormat}get icon(){return this._fileType.icon}get extensions(){return this._fileType.extensions}get contentType(){return this._fileType.contentType()}get mimeTypes(){return this._fileType.mimeTypes()}get pattern(){return this._fileType.pattern()}get iconClass(){return this._fileType.iconClass()}get iconLabel(){return this._fileType.iconLabel()}}const te=e=>{const{jupyterFrontend:t}=e,[n,s]=(0,g.useState)();return(0,g.useEffect)((()=>{if(t){const e=Array.from(t.docRegistry.fileTypes()).map((e=>new ee(e)));s(e)}}),[t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"File Types"})})}),n&&(0,k.jsxs)(X.X.Container,{children:[(0,k.jsx)(X.X.Title,{as:"h2",id:"file-types",children:"File types"}),(0,k.jsx)(X.X.Subtitle,{as:"p",id:"file-types-subtitle",children:"List of registered file types."}),(0,k.jsx)(Z.b,{"aria-labelledby":"file-types","aria-describedby":"file-types-subtitle",data:n,columns:[{header:"Icon",field:"icon",renderCell:e=>e.icon?(0,k.jsx)(_.A,{sx:{width:16,height:16},children:(0,k.jsx)(e.icon.react,{})}):(0,k.jsx)(k.Fragment,{})},{header:"Name",field:"name",renderCell:e=>e.name},{header:"Display Name",field:"displayName",renderCell:e=>(0,k.jsx)(G.A,{children:String(e.displayName)})},{header:"Extensions",field:"extensions",renderCell:e=>(0,k.jsx)(Y.A,{children:e.extensions.map((e=>(0,k.jsx)(Q.A,{children:e})))})},{header:"File Format",field:"fileFormat",renderCell:e=>(0,k.jsx)(Q.A,{variant:"primary",children:String(e.fileFormat)})}]})]})]})},ne=e=>{const{jupyterFrontend:t}=e,[n,s]=(0,g.useState)(),[r,i]=(0,g.useState)();return(0,g.useEffect)((()=>{if(t){const e=t.serviceManager.contents._defaultDrive;s({id:-1,...e});const n=t.serviceManager.contents._additionalDrives;n&&i(Array.from(n.values()).map(((e,t)=>({id:t,...e,name:e.name}))))}}),[t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Drives"})})}),(0,k.jsxs)(_.A,{children:[(0,k.jsx)("h3",{children:"Default Drive"}),(0,k.jsx)(G.A,{children:n?.name}),(0,k.jsx)(Q.A,{style:{marginLeft:3},children:n?.sharedModelFactory?.collaborative?"collaborative":"non collaborative"})]}),r&&(0,k.jsxs)(X.X.Container,{children:[(0,k.jsx)(X.X.Title,{as:"h2",id:"repositories",children:"Additional Drives"}),(0,k.jsx)(X.X.Subtitle,{as:"p",id:"repositories-subtitle",children:"List of registered drives"}),(0,k.jsx)(Z.b,{"aria-labelledby":"file-types","aria-describedby":"file-types-subtitle",data:r,columns:[{header:"Name",field:"name",renderCell:e=>(0,k.jsx)(G.A,{children:e.name})},{header:"Shared Model Factory",field:"sharedModelFactory",renderCell:e=>(0,k.jsx)(Q.A,{children:e.sharedModelFactory?.collaborative?"collaborative":"non collaborative"})}]})]})]})};class se{constructor(e){var t,n,s;t=this,s=void 0,(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_modelFactory"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this._modelFactory=e}get id(){return this._modelFactory.name}get name(){return this._modelFactory.name}get contentType(){return this._modelFactory.contentType}get collaborative(){return this._modelFactory.collaborative}get isDisposed(){return this._modelFactory.isDisposed}get fileFormat(){return this._modelFactory.fileFormat}}const re=e=>{const{jupyterFrontend:t}=e,[n,s]=(0,g.useState)();return(0,g.useEffect)((()=>{if(t){const e=Array.from(t.docRegistry.modelFactories()).map((e=>new se(e)));s(e)}}),[t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Models"})})}),n&&(0,k.jsxs)(X.X.Container,{children:[(0,k.jsx)(X.X.Title,{as:"h2",id:"model-factories",children:"Model Factories"}),(0,k.jsx)(X.X.Subtitle,{as:"p",id:"model-factories-subtitle",children:"List of registered model factories."}),(0,k.jsx)(Z.b,{"aria-labelledby":"model-factories","aria-describedby":"model-factories-subtitle",data:n,columns:[{header:"Name",field:"name",renderCell:e=>(0,k.jsx)(G.A,{children:e.name})},{header:"Content Type",field:"contentType",renderCell:e=>(0,k.jsx)(Q.A,{children:e.contentType})},{header:"Collaborative",field:"collaborative",renderCell:e=>(0,k.jsx)(G.A,{children:String(e.collaborative)})},{header:"File Format",field:"fileFormat",renderCell:e=>(0,k.jsx)(Q.A,{variant:"primary",children:String(e.fileFormat)})}]})]})]})};class ie{constructor(e){var t,n,s;t=this,s=void 0,(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_widgetFactory"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this._widgetFactory=e}get id(){return this._widgetFactory.name}get name(){return this._widgetFactory.name}get modelName(){return this._widgetFactory.modelName}get label(){return this._widgetFactory.label}get fileTypes(){return this._widgetFactory.fileTypes}get isDisposed(){return this._widgetFactory.isDisposed}get widgetCreated(){return this._widgetFactory.widgetCreated}}const ae=e=>{const{jupyterFrontend:t}=e,[n,s]=(0,g.useState)();return(0,g.useEffect)((()=>{if(t){const e=Array.from(t.docRegistry.widgetFactories()).map((e=>new ie(e)));s(e)}}),[t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Widgets"})})}),n&&(0,k.jsxs)(X.X.Container,{children:[(0,k.jsx)(X.X.Title,{as:"h2",id:"widget-factories",children:"Widget Factories"}),(0,k.jsx)(X.X.Subtitle,{as:"p",id:"widget-factories-subtitle",children:"List of registered widgets factories."}),(0,k.jsx)(Z.b,{"aria-labelledby":"file-types","aria-describedby":"file-types-subtitle",data:n,columns:[{header:"Name",field:"name",renderCell:e=>(0,k.jsx)(G.A,{children:e.name})},{header:"Label",field:"label",renderCell:e=>(0,k.jsx)(G.A,{children:e.label})},{header:"Model Name",field:"modelName",renderCell:e=>(0,k.jsx)(Q.A,{children:e.modelName})},{header:"File Types",field:"fileTypes",renderCell:e=>(0,k.jsx)(Y.A,{children:e.fileTypes.map((e=>(0,k.jsx)(Q.A,{variant:"primary",children:e})))})}]})]})]})};var oe=n(8586);function le(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ce{constructor(e,t){le(this,"_widgetName",void 0),le(this,"_extension",void 0),this._widgetName=e,this._extension=t}get id(){return this.widgetName}get widgetName(){return this._widgetName}get extension(){return this._extension}}const de=e=>{const{widgetName:t,extensions:n}=e;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(_.A,{children:(0,k.jsx)(oe.A,{sx:{fontSize:2,mb:2},children:t})}),n.map((e=>(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(_.A,{children:(0,k.jsx)(Q.A,{children:e.extension.constructor.name})})})))]})},he=e=>{const{jupyterFrontend:t}=e,[n,s]=(0,g.useState)();return(0,g.useEffect)((()=>{if(t){const e=t.docRegistry._extenders,n=new Map;Object.keys(e).forEach((t=>{const s=e[t].map((e=>new ce(t,e)));n.set(t,s)})),s(n)}}),[t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Widget Extensions"})})}),n&&Array.from(n.entries()).map((e=>{const[t,n]=e;return(0,k.jsx)(de,{widgetName:t,extensions:n})}))]})},ue=e=>(0,k.jsx)(_.A,{children:(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Settings"})})})}),pe=e=>(0,k.jsx)(_.A,{children:(0,k.jsx)(L.z,{children:(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"IPyWidgets"})})})}),me=e=>(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(L.z,{children:[(0,k.jsx)(L.z.TitleArea,{children:(0,k.jsx)(L.z.Title,{children:"Server"})}),(0,k.jsx)(L.z.Navigation,{children:(0,k.jsxs)(v.O,{"aria-label":"Server",children:[(0,k.jsx)(v.O.Item,{icon:P.A,counter:"12","aria-current":"page",children:"Extensions"}),(0,k.jsx)(v.O.Item,{counter:3,icon:D.A,children:"Settings"})]})})]})});var ge=n(320);const ye=e=>{const{jupyterFrontend:t}=e,{tab:n,setTab:s}=(0,ge._O)();return(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(_.A,{sx:{display:"flex"},children:[(0,k.jsx)(_.A,{children:(0,k.jsxs)(F.c,{sx:{"> *":{paddingTop:"0px"}},children:[(0,k.jsxs)(F.c.Item,{"aria-current":0===n?"page":void 0,onClick:e=>s(0),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(S.A,{})}),"Plugins"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.1===n?"page":void 0,onClick:e=>s(.1),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(A.A,{})}),"File Types"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.2===n?"page":void 0,onClick:e=>s(.2),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(R.A,{})}),"Models"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.3===n?"page":void 0,onClick:e=>s(.3),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(M.A,{colored:!0})}),"Drives"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.4===n?"page":void 0,onClick:e=>s(.4),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(E.A,{})}),"Widgets"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.5===n?"page":void 0,onClick:e=>s(.5),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(P.A,{})}),"Widget Extensions"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.6===n?"page":void 0,onClick:e=>s(.6),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(N.A,{})}),"IPyWidgets"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.7===n?"page":void 0,onClick:e=>s(.7),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(D.A,{})}),"Settings"]}),(0,k.jsxs)(F.c.Item,{"aria-current":.8===n?"page":void 0,onClick:e=>s(.8),children:[(0,k.jsx)(F.c.LeadingVisual,{children:(0,k.jsx)(T.A,{})}),"Server"]})]})}),(0,k.jsxs)(_.A,{ml:3,sx:{width:"100%"},children:[0===n&&(0,k.jsx)(B,{jupyterFrontend:t}),.1===n&&(0,k.jsx)(te,{jupyterFrontend:t}),.2===n&&(0,k.jsx)(re,{jupyterFrontend:t}),.3===n&&(0,k.jsx)(ne,{jupyterFrontend:t}),.4===n&&(0,k.jsx)(ae,{jupyterFrontend:t}),.5===n&&(0,k.jsx)(he,{jupyterFrontend:t}),.6===n&&(0,k.jsx)(pe,{jupyterFrontend:t}),.7===n&&(0,k.jsx)(ue,{jupyterFrontend:t}),.8===n&&(0,k.jsx)(me,{jupyterFrontend:t})]})]})})},fe=e=>{const{jupyterFrontend:t}=e,{tab:n,setTab:s}=(0,ge._O)(),r=Math.floor(n),[i,a]=(0,g.useState)("");return(0,g.useEffect)((()=>{p("config").then((e=>{a(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server datalayer extension.\n${e}`)}))})),(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(y.NP,{children:(0,k.jsx)(f.A,{children:(0,k.jsxs)(_.A,{children:[(0,k.jsx)(_.A,{children:(0,k.jsxs)(v.O,{"aria-label":"datalayer",children:[(0,k.jsx)(v.O.Item,{"aria-label":"jupyterlab","aria-current":0===r?"page":void 0,icon:()=>(0,k.jsx)(x.A,{colored:!0}),onSelect:e=>{e.preventDefault(),s(0)},children:"JupyterLab"}),(0,k.jsx)(v.O.Item,{"aria-label":"about","aria-current":1===r?"page":void 0,icon:()=>(0,k.jsx)(b.A,{colored:!0}),onSelect:e=>{e.preventDefault(),s(1)},children:"About"})]})}),(0,k.jsxs)(_.A,{m:3,children:[0===r&&t&&(0,k.jsx)(ye,{jupyterFrontend:t}),1===r&&(0,k.jsx)(C,{version:i})]})]})})})})};class _e extends m._Q{constructor(e){var t,n,s;super(),t=this,s=void 0,(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_app"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this._app=e,this.addClass("dla-Container")}render(){return(0,k.jsx)(fe,{jupyterFrontend:this._app})}}var ve=n(71932),xe=n(72490);function be(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class we{constructor(){be(this,"_configuration",ge.$K.getState().configuration),be(this,"_configurationChanged",void 0),this._configurationChanged=new xe.Signal(this)}set configuration(e){this._configuration=e,this._configurationChanged.emit(e)}get configuration(){return this._configuration}get configurationChanged(){return this._configurationChanged}}const je={"@datalayer/jupyter-iam:plugin":!0,"@datalayer/jupyter-kernels:plugin":!0,"@datalayer/jupyter-kernels:browser-localforage":!1,"@datalayer/jupyter-kernels:browser-localforage-memory-storage":!1,"@datalayer/jupyter-kernels:browser-contents":!1,"@datalayer/jupyter-kernels:browser-contents-routes":!1,"@datalayer/jupyter-kernels:browser-service-worker":!1,"@datalayer/jupyter-kernels:emscripten-filesystem":!1,"@datalayer/jupyter-kernels:browser-kernels":!1,"@datalayer/jupyter-kernels:browser-kernels-routes":!1,"@datalayer/jupyter-kernels:browser-kernelspec":!1,"@datalayer/jupyter-kernels:browser-kernelspec-routes":!1,"@datalayer/jupyter-kernels:browser-sessions":!1,"@datalayer/jupyter-kernels:browser-sessions-routes":!1,"@datalayer/jupyter-kernels:browser-manager":!1,"@datalayer/jupyter-kernels:cell-action":!0,"@datalayer/jupyter-kernels:cell-executor":!0,"@datalayer/jupyter-kernels:cell-footer":!0,"@datalayer/jupyter-kernels:credits-indicator":!0,"@datalayer/jupyter-kernels:lifecycle":!0},ke="@datalayer/jupyter-kernels:remote:activate",Ce={id:"@datalayer/ui:activator",description:"Activate Datalayer needed plugins when needed.",requires:[ve.R],autoStart:!0,activate:(e,t)=>{let n=!1;e.commands.addCommand(ke,{execute:async()=>{if(!n){n=!0;try{await t.ready}catch(e){}await Promise.allSettled(Object.entries(je).reduce(((n,[s,r])=>(!e.hasPlugin(s)||!r&&t.configuration.configuration.whiteLabel||n.push(s),n)),[]).map((t=>e.activatePlugin(t).catch((e=>{console.error(`Failed to activate plugin ${t}.`)})))))}}}),t.ready.finally((()=>{t.configuration.configuration.whiteLabel||e.commands.execute(ke)}))}};let Se,Ae;(Se||(Se={})).create="datalayer:create-datalayer-widget";const Re={id:"@datalayer/ui:plugin",autoStart:!0,optional:[r.kn,o.X,l.k,s.E],provides:ve.R,deactivate:(e,t,n,s,r)=>{Ae.forEach((e=>e.dispose())),console.log(`${Re.id} is deactivated.`)},activate:(e,t,n,s,r)=>{const o=new c.PromiseDelegate,l=Object.freeze({configuration:new we,ready:o.promise});function h(e){const{setConfiguration:t}=ge.$K.getState();t(e)}return h(l.configuration.configuration),l.configuration.configurationChanged.connect(((e,t)=>{h(t)})),p("config").then((c=>{console.log("Received Datalayer configuration",c),ge.$K.getState().setVersion(c.version);const h=ge.$K.getState().configuration,u=c.settings.run_url,p=ge.$K.getState().loadConfigurationFromServer?{...h,iamRunUrl:u||h.iamRunUrl,jupyterRunUrl:u||h.jupyterRunUrl,libraryRunUrl:u||h.libraryRunUrl,spacerRunUrl:u||h.spacerRunUrl,aiagentsRunUrl:u||h.aiagentsRunUrl,successRunUrl:u||h.successRunUrl,launcher:c.settings.launcher,whiteLabel:c.settings.white_label}:h;if(l.configuration.configuration=p,ge.$K.getState().setConfiguration(p),o.resolve(),p.whiteLabel)return;const{commands:m}=e,g=Se.create;Ae||(Ae=new i.H({namespace:"datalayer"})),r&&r.restore(Ae,{command:g,name:()=>"datalayer"}),m.addCommand(g,{caption:"Show Datalayer UI",label:"Datalayer UI",icon:d.A,execute:()=>{const t=new _e(e),n=new a.p({content:t});n.title.label="Datalayer UI",n.title.icon=d.A,e.shell.add(n,"main"),Ae.add(n)}});const y=p.launcher?.category??"Datalayer";t?.addItem({command:g,category:y});const f=e=>{const t=e.get("showInLauncher").composite;s&&t&&s.add({command:g,category:y,rank:1.1})};n&&n.load(Re.id).then((e=>{console.log(`${Re.id} settings loaded:`,e.composite),f(e),e.changed.connect(f)})).catch((e=>{console.error(`Failed to load settings for ${Re.id}`,e)}))})).catch((e=>{o.reject(e),console.error(`Error while accessing the jupyter server extension.\n${e}`)})),console.log(`JupyterLab plugin ${Re.id} is activated.`),l}},Me=[Re,Ce]},71932:(e,t,n)=>{n.d(t,{R:()=>s});const s=new(n(98238).Token)("@datalayer/ui:plugin")},43600:(e,t,n)=>{n.r(t),n.d(t,{IJupyterIAM:()=>Y,default:()=>Z,jupyterIAMPlugin:()=>X});var s=n(7254),r=n(16255),i=n(59179),a=n(41665),o=n(62863),l=n(97371),c=n(69584),d=n(98238),h=n(71932),u=n(44536),p=n(63711),m=n(97789);async function g(e="",t={}){const n=m.ServerConnection.makeSettings(),s=p.URLExt.join(n.baseUrl,"jupyter_iam",e);let r;try{r=await m.ServerConnection.makeRequest(s,t,n)}catch(e){throw new m.ServerConnection.NetworkError(e)}let i=await r.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new m.ServerConnection.ResponseError(r,i.message||i);return i}var y=n(88037),f=n(64761),_=n(20568),v=n(26939),x=n(99571),b=n(76417),w=n(83076),j=n(49865),k=n(9387),C=n(26573),S=n(84261),A=n(98754),R=n(91079),M=n(56770),E=n(46895),P=n(75147),N=n(18683);const D=e=>{const{version:t}=e;return(0,N.jsx)(P.a,{version:t,title:"Jupyter IAM",icon:(0,N.jsx)(M.A,{colored:!0,size:32}),description:"ðŸª ðŸ›‚ Identity and Access Management for Jupyter."})};var T=n(90151),F=n(97582),L=n(72883),I=n(29187),O=n(97096),K=n(47414),U=n(43673);const $=e=>{const{jupyterLabAdapter:t}=e,[n,s]=(0,k.useState)();return(0,k.useEffect)((()=>{if(t){const e=t.jupyterLab.serviceManager.user;s(e)}}),[t]),(0,N.jsxs)(I.M,{containerWidth:"full",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,N.jsx)(I.M.Header,{children:(0,N.jsx)(O.z,{children:(0,N.jsx)(O.z.TitleArea,{variant:"large",children:(0,N.jsx)(O.z.Title,{children:"Jupyter Profile"})})})}),(0,N.jsx)(I.M.Content,{children:n&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(U.A,{identity:n.identity}),(0,N.jsx)(K.b,{permissions:n.permissions})]})})]})},V=e=>{const{jupyterLabAdapter:t}=e,[n,s]=(0,k.useState)(1),[r,i]=(0,k.useState)();return(0,k.useEffect)((()=>{switch(n){case 1:i((0,N.jsx)(L.a,{}));break;case 2:i((0,N.jsx)($,{jupyterLabAdapter:t}))}}),[n]),(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(A.A,{sx:{display:"flex"},children:[(0,N.jsx)(A.A,{children:(0,N.jsxs)(F.c,{sx:{"> *":{paddingTop:"0px",minWidth:"150px"}},children:[(0,N.jsx)(F.c.Item,{"aria-current":1===n?"page":void 0,onClick:e=>s(1),children:"Datalayer"}),(0,N.jsx)(F.c.Item,{"aria-current":2===n?"page":void 0,onClick:e=>s(2),children:"JupyterLab"})]})}),(0,N.jsx)(A.A,{ml:3,sx:{width:"100%"},children:r})]})})},z=e=>{const{jupyterLabAdapter:t}=e,{user:n}=(0,u.Y)(),[s,r]=(0,k.useState)(0),[i,a]=(0,k.useState)("");return(0,k.useEffect)((()=>{g("config").then((e=>{a(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_iam extension.\n${e}`)}))})),(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(C.NP,{children:(0,N.jsx)(S.A,{children:(0,N.jsxs)(A.A,{children:[(0,N.jsx)(A.A,{children:(0,N.jsxs)(R.O,{"aria-label":"iam",children:[(0,N.jsx)(R.O.Item,{"aria-label":"iam-home","aria-current":0===s?"page":void 0,onSelect:e=>{e.preventDefault(),r(0)},children:"Providers"}),(n?.roles??[]).includes(E.n.Admin.handle)&&(0,N.jsx)(R.O.Item,{"aria-label":"iam-users","aria-current":1===s?"page":void 0,onSelect:e=>{e.preventDefault(),r(1)},children:"Manage users"}),(0,N.jsx)(R.O.Item,{"aria-label":"iam-about","aria-current":2===s?"page":void 0,icon:()=>(0,N.jsx)(M.A,{colored:!0}),onSelect:e=>{e.preventDefault(),r(2)},children:"About"})]})}),(0,N.jsxs)(A.A,{m:3,children:[0===s&&t&&(0,N.jsx)(V,{jupyterLabAdapter:t}),1===s&&(n?.roles??[]).includes(E.n.Admin.handle)&&(0,N.jsx)(T.k,{}),2===s&&(0,N.jsx)(D,{version:i})]})]})})})})};var q=n(29621);const W="jupyter/iam",J=e=>{const{baseRoute:t,memoryRouter:n,jupyterLabAdapter:s}=e,{user:r}=(0,u.Y)();return(0,N.jsx)(j.N,{inJupyterLab:n,children:(0,N.jsx)(_.BV,{children:r?(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(_.qh,{path:p.URLExt.join("/",t),element:(0,N.jsx)(z,{jupyterLabAdapter:s})})}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(_.qh,{path:p.URLExt.join("/",t),element:(0,N.jsx)(_.C5,{to:p.URLExt.join("/",t,W,"login")})}),(0,N.jsx)(_.qh,{path:p.URLExt.join("/",t,W,"login"),element:(0,N.jsx)(q.a,{homeRoute:p.URLExt.join("/",t),loginRoute:p.URLExt.join("/",t,W,"login")})})]})})})};J.defaultProps={baseRoute:"",memoryRouter:!1};const H=e=>{const{memoryRouter:t,baseRoute:n}=e;return(0,N.jsx)(N.Fragment,{children:t?(0,N.jsx)(b.w2,{children:(0,N.jsx)(_.fS,{initialEntries:[p.URLExt.join("/",n)],children:(0,N.jsx)(J,{...e})})}):(0,N.jsxs)(w.cG,{children:[(0,N.jsx)(v.Kd,{children:(0,N.jsx)(J,{...e})}),(0,N.jsx)(x.ToastContainer,{})]})})};class B extends y._Q{constructor(e){var t,n,s;super(),t=this,s=void 0,(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_app"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this._app=e,this.addClass("dla-Container")}render(){return(0,N.jsx)(H,{memoryRouter:!0,baseRoute:"",jupyterLabAdapter:f.H.create(this._app)})}}const G="@datalayer/jupyter-iam:plugin",Y=new d.Token(G);let Q;(Q||(Q={})).create="create-jupyter-iam-widget";const X={id:G,autoStart:!1,requires:[h.R],optional:[i.kn,c.X,l.k,r.E],provides:Y,activate:(e,t,n,r,i,l)=>{let c=!1;const d=t=>{if(!c&&!t.whiteLabel){const d=Q.create;c=!0;const h=t.launcher?.category??"Datalayer";n?.addItem({command:d,category:h});const u=e=>{const t=e.get("showInLauncher").composite;i&&t&&i.add({command:d,category:h,rank:4.1})};r&&r.load(X.id).then((e=>{console.log(`${X.id} settings loaded:`,e.composite),u(e),e.changed.connect(u)})).catch((e=>{console.error(`Failed to load settings for ${X.id}.`,e)}));const{commands:p}=e,m=new a.H({namespace:"jupyter-iam"});l&&l.restore(m,{command:d,name:()=>"jupyter-iam"}),p.addCommand(d,{caption:"Show Jupyter IAM",label:"Jupyter IAM",icon:s.A,execute:()=>{const t=new B(e),n=new o.p({content:t});n.title.label="Jupyter IAM",n.title.icon=s.A,e.shell.add(n,"main"),m.add(n)}})}};return t.ready.finally((()=>{d(t.configuration.configuration),t.configuration.configurationChanged.connect(((e,t)=>{d(t)}))})),g("config").then((e=>{u.J7.getState().setVersion(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_iam extension.\n${e}`)})),console.log(`JupyterLab plugin ${X.id} is activated.`),{}}},Z=X},68732:(e,t,n)=>{n.r(t),n.d(t,{default:()=>as,jupyterKernelsPlugin:()=>is});var s={};n.r(s),n.d(s,{changeCurrentWorkingDirectory:()=>G,getOutputCandidates:()=>Y,listVariables:()=>J,loadVariables:()=>B,saveVariables:()=>H});var r=n(19823),i=n(63711),a=n(97371),o=n(97789),l=n(85181),c=n(20492),d=n(43304),h=n(54904),u=n(80475),p=n(75229),m=n(26677),g=n(32556),y=n(83015),f=n(34412),_=n(58264),v=n(32738),x=n(9877),b=n(98238),w=n(79246),j=n(49267),k=n(72490),C=n(49087),S=n.n(C),A=n(18565),R=n(71932),M=n(36848),E=n(2335),P=n(8522),N=n(38921),D=n(9387),T=n(88037),F=n(14809),L=n(19560),I=n(27907),O=n(88996),K=n(99098),U=n(59528),$=n(49865),V=n(18683);function z(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q({checkbox:e,footerButtons:t,setChecked:n}){const[s,r]=(0,D.useState)(),{containerRef:i}=(0,I.G)({bindKeys:L.z0.ArrowHorizontal|L.z0.Tab,focusInStrategy:"closest"});return(0,V.jsxs)(U.l.Footer,{className:"dla-dialog-footer",ref:i,children:[e&&(0,V.jsxs)(O.A,{layout:"horizontal",children:[(0,V.jsx)(K.A,{className:e.className??"",checked:s,defaultChecked:e.checked,onChange:e=>{r(e.target.checked),n(e.target.checked)},title:e.caption??""}),(0,V.jsx)(O.A.Label,{children:e.label??""})]}),(0,V.jsx)("div",{className:"dla-dialog-footer-spacer"}),t&&(0,V.jsx)(U.l.Buttons,{buttons:t})]})}class W extends T._Q{constructor(e={}){super(),z(this,"body",void 0),z(this,"checkbox",void 0),z(this,"buttons",void 0),z(this,"host",void 0),z(this,"dialogTitle",void 0),z(this,"_closing",new b.PromiseDelegate),z(this,"_result",{button:null,isChecked:null,value:null}),z(this,"close",(()=>{F.x0.detach(this),this._closing.resolve()})),z(this,"handleButton",(e=>{this.setButton(this.buttons[e]),this.close()})),z(this,"setButton",(e=>{this._result.button=e})),z(this,"setChecked",(e=>{this._result.isChecked=e})),z(this,"setValue",(e=>{e instanceof Error?this._closing.reject(e):this._result.value=e})),z(this,"_renderBody",(e=>(0,V.jsx)(U.l.Body,{children:(0,D.createElement)(this.body,{...e,setValue:this.setValue})}))),z(this,"_renderFooter",(e=>(0,V.jsx)(q,{...e,checkbox:this.checkbox,setChecked:this.setChecked}))),this.host=e.host??document.body,this.body=e.body??(()=>null),this.checkbox=e.checkbox??null,this.buttons=e.buttons??[E.lG.cancelButton(),E.lG.okButton()],this.dialogTitle=e.title}async launch(){return F.x0.attach(this,this.host),await this._closing.promise,this._result}render(){return(0,V.jsx)($.N,{inJupyterLab:!0,children:(0,V.jsx)(U.l,{sx:{fontFamily:"var(--fontStack-system)",fontSize:"var(--text-body-size-medium)",lineHeight:"var(--text-body-lineHeight-medium)",color:"var(--fgColor-default)"},onClose:this.close,footerButtons:this.buttons.map(((e,t)=>({buttonType:"default"===e.displayType?e.accept?"primary":"default":"danger",onClick:()=>{this.handleButton(t)},content:e.label,"aria-label":e.ariaLabel,autoFocus:e.accept}))),renderBody:this._renderBody,renderFooter:this._renderFooter,title:this.dialogTitle})})}}function J(){return"\ndef _list_variables():\n    import json\n    from types import BuiltinFunctionType, BuiltinMethodType, FunctionType, MethodType, MethodWrapperType, ModuleType, TracebackType\n\n    _FORBIDDEN_TYPES = [type, BuiltinFunctionType, BuiltinMethodType, FunctionType, MethodType, MethodWrapperType, ModuleType, TracebackType]\n    try:\n        from IPython.core.autocall import ExitAutocall\n        _FORBIDDEN_TYPES.append(ExitAutocall)\n    except ImportError:\n        pass\n    _exclude = tuple(_FORBIDDEN_TYPES)\n\n    _all = frozenset(globals())\n    _vars = {}\n    for _n in _all:\n        _v = globals()[_n]\n        \n        if not (\n            _n.startswith('_') or\n            isinstance(_v, _exclude) or\n            # Special IPython variables\n            (_n == 'In' and isinstance(_v, list)) or\n            (_n == 'Out' and isinstance(_v, dict))\n        ):\n            _vars[_n] = type(_v).__qualname__\n\n    return json.dumps(_vars)\n\n_list_variables()"}function H(e){return`\ndef _pickle_variables():\n    from base64 import encodebytes\n    import json\n    import pickle\n    _names = {${e.map((e=>`"${e}"`)).join(",")}}\n    _data = {}\n    for _n in _names:\n        try:\n            _v = globals()[_n]\n            dump = pickle.dumps(_v)\n            _data[_n] = encodebytes(dump).decode("ascii")\n        except:\n            ...\n\n    return json.dumps(_data)\n\n_pickle_variables()\n`}function B(e){return`\ndef _load_variables():\n    from base64 import decodebytes\n    import json\n    import pickle\n    _data = json.loads(${e})\n    _loaded = []\n    for _n, _v in _data.items():\n        try:\n            dump = decodebytes(_v.encode("ascii"))\n            globals()[_n] = pickle.loads(dump)\n            _loaded.append(_n)\n        except:\n            ...\n    return json.dumps(_loaded)\n\n_load_variables()\n`}function G(e){return`\ndef _change_current_directory():\n    import os\n    from pathlib import Path\n    _local_content_mount_point = Path(Path.home() / ${e.split("/").map((e=>`"${e}"`)).join(" / ")})\n    _local_content_mount_point.mkdir(parents=True, exist_ok=True)\n    os.chdir(_local_content_mount_point)\n\n    assert Path.cwd() == _local_content_mount_point\n\n_change_current_directory()\n`}function Y(e){return Array.from(e.matchAll(/^((?<output>[A-z][\w]*)\s*=[^=]|\((?<walrus>[A-z][\w]*)\s*:=[^=)]+\))/gm)).map((e=>e.groups?.output??e.groups?.walrus??"")).filter((e=>!!e))}function Q(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class X{static register(e,t){this.$language.set(e,t)}static supports(e){return this.$language.has(e)}constructor(e){if(Q(this,"_language",void 0),!X.$language.has(e))throw new Error(`${e} is not supported.`);this._language=e}get language(){return this._language}changeCurrentWorkingDirectory(e){return X.$language.get(this.language).changeCurrentWorkingDirectory(e)}listVariables(){return X.$language.get(this.language).listVariables()}loadVariables(e){return X.$language.get(this.language).loadVariables(e)}saveVariables(e){return X.$language.get(this.language).saveVariables(e)}getOutputCandidates(e){return X.$language.get(this.language).getOutputCandidates(e)}}Q(X,"$language",new Map),X.register("python",s);const Z=["browser","local"];function ee(e){return!Z.includes(e)}var te=n(98754),ne=n(47785),se=n(34418),re=n(52032),ie=n(38621),ae=n(20568),oe=n(24750),le=n(44536),ce=n(24500),de=n(97734);const he=e=>{const{message:t}=e,{loginAndNavigate:n}=(0,ce.D)(),{logout:s,checkIAMToken:r,externalToken:i}=(0,le.Y)(),{enqueueToast:a}=(0,de.d)();return(0,D.useEffect)((()=>{i&&n(i,s,r).catch((e=>{console.error("Failed to login with the provided token.",e),a("Failed to login with the provided token.",{variant:"error"})})).finally((()=>{a("Runtimes are available.",{variant:"success"})}))}),[i]),(0,V.jsx)(oe.Y,{size:"small",message:t})},ue=e=>(0,V.jsx)(ae.fS,{initialEntries:["/"],children:(0,V.jsx)(ae.BV,{children:(0,V.jsx)(ae.qh,{path:"*",element:(0,V.jsx)(he,{...e})})})});var pe=n(320),me=n(94775),ge=n(6681),ye=n(12266),fe=n(4902),_e=n(40402);function ve(e){const{className:t,translator:n,selectedVariables:s,setSelectVariable:r,transferVariables:i,setTransferVariable:a,kernelVariables:o}=e,d=(0,D.useMemo)((()=>(n??l.wK).load("jupyterlab")),[n]),h=Object.keys(o??{}).length,u=[{header:d.__("Name"),field:"name",rowHeader:!0},{header:d.__("Type"),field:"type"},{id:"select",maxWidth:"70px",header:()=>(0,V.jsx)(ge.K,{"aria-label":s.length===h?d.__("Deselect all"):d.__("Select all"),title:s.length===h?d.__("Deselect all"):d.__("Select all"),icon:s.length===h?c.oE.react:()=>(0,V.jsx)("span",{}),variant:"default",size:"small",onClick:e=>{e.preventDefault(),s.length===h?r([]):r(Object.keys(o??{}))}}),renderCell:e=>{const t=s.includes(e.name);return(0,V.jsx)(ge.K,{"aria-label":t?d.__("Deselect: %1",e.name):d.__("Select: %1",e.name),title:t?d.__("Deselect: %1",e.name):d.__("Select: %1",e.name),icon:t?c.oE.react:()=>(0,V.jsx)("span",{}),variant:"default",size:"small",onClick:t=>{t.preventDefault();const n=s.findIndex((t=>t===e.name));if(n>=0){const e=[...s];e.splice(n,1),r(e)}else r([...s,e.name])}})}}];return(0,V.jsxs)(te.A,{className:t,sx:{paddingTop:"10px"},children:[(0,V.jsxs)(O.A,{layout:"horizontal",children:[(0,V.jsx)(O.A.Label,{children:d.__("Transfer variables")}),(0,V.jsx)(re.A,{checked:i,size:"small",onClick:e=>{e.preventDefault(),a(!i)},"aria-labelledby":"kernel-toggle-variables"})]}),i&&(0,V.jsxs)(ye.X.Container,{sx:{flex:"1 1 auto"},children:[(0,V.jsx)(ye.X.Title,{as:"h2",id:"dla-kernel-variables",children:d.__("Kernel variables")}),(0,V.jsx)(ye.X.Subtitle,{as:"p",id:"dla-kernel-variables-subtitle",children:d.__("The list of transferable kernel variables.")}),o?Object.keys(o??{}).length?(0,V.jsx)(fe.b,{"aria-labelledby":"dla-kernel-variables","aria-describedby":"dla-kernel-variables-subtitle",data:Object.entries(o??{}).map((([e,t],n)=>({id:n,name:e,type:t}))).sort(((e,t)=>e.name>t.name?1:-1)),columns:u,cellPadding:"condensed"}):(0,V.jsx)(te.A,{sx:{gridArea:"table"},children:(0,V.jsx)(_e.A,{border:!0,children:(0,V.jsx)(_e.A.Heading,{children:d.__("No eligible variables.")})})}):(0,V.jsx)(ye.X.Skeleton,{"aria-labelledby":"dla-kernel-variables","aria-describedby":"dla-kernel-variables-subtitle",columns:u,rows:5})]})]})}var xe=n(9175),be=n(76818),we=n(36008),je=n(72870),ke=n(63948);function Ce(e){const{preActions:t,postActions:n,disabled:s,filterKernel:r,preference:i,serviceManager:a,selection:o,setSelection:d,translator:h,variant:u}=e,[p,m]=(0,D.useState)(Se(a,i?.id,h,r,u)),g=(0,D.useMemo)((()=>(h??l.wK).load("jupyterlab")),[h]),y={maxHeight:"large",width:"cell"===u?"small":"auto"};return(0,D.useEffect)((()=>{const e=()=>{m(Se(a,i?.id,h,r,u))};return a.browser?.kernels.runningChanged.connect(e),a.browser?.kernelspecs.specsChanged.connect(e),a.browser?.sessions.runningChanged.connect(e),a.local.kernels.runningChanged.connect(e),a.local.kernelspecs.specsChanged.connect(e),a.local.sessions.runningChanged.connect(e),a.remote?.kernels.changed.connect(e),a.remote?.environments.changed.connect(e),()=>{a.browser?.kernels.runningChanged.disconnect(e),a.browser?.kernelspecs.specsChanged.disconnect(e),a.browser?.sessions.runningChanged.disconnect(e),a.local.kernels.runningChanged.disconnect(e),a.local.kernelspecs.specsChanged.disconnect(e),a.local.sessions.runningChanged.disconnect(e),a.remote?.kernels.changed.disconnect(e),a.remote?.environments.changed.disconnect(e)}}),[a,i,h,r,u]),(0,V.jsxs)(xe.W,{children:["cell"===u?(0,V.jsx)(xe.W.Anchor,{children:(0,V.jsx)(ge.K,{disabled:s||null===p,icon:()=>(0,V.jsx)(c.XF.react,{className:"dla-cell-kernel-icon",tag:"span"}),"aria-label":g.__("Assign a runtime to the cell."),title:g.__("Assign a runtime to the cell."),size:"small",variant:"invisible"})}):(0,V.jsxs)(xe.W.Button,{variant:"default",disabled:s||null===p,children:[(0,V.jsx)(be.A,{fontWeight:"bold",children:g.__("Runtime:")})," "+(o?.displayName??g.__("No Runtime"))]}),(0,V.jsx)(xe.W.Overlay,{...y,width:"medium",sx:{overflowY:"auto"},side:"cell"===u?"outside-left":"outside-right",children:(0,V.jsxs)(ne.l,{selectionVariant:"single",children:["cell"===u&&(0,V.jsxs)(ne.l.Item,{selected:null===o,onSelect:()=>{d(null)},children:[i?.location&&(0,V.jsx)(ne.l.LeadingVisual,{children:"local"===i.location?(0,V.jsx)(je.A,{}):"browser"===i.location?(0,V.jsx)(ke.A,{}):(0,V.jsx)(we.A,{})}),g.__("Assign the Notebook Kernel")]},"null"),!!t&&t,Object.entries(p??{}).map((([e,t])=>(0,V.jsx)(ne.l.Group,{title:e,children:t.map((e=>{const t=e.podName?` - ${e.podName.split("-",2).reverse()[0]}`:e.id?` - ${e.id}`:"",n=(e.displayName??"")+t,s=(e.displayName?.length??0)>25?e.displayName.slice(0,25)+"â€¦":e.displayName??"";return(0,V.jsxs)(ne.l.Item,{title:n,selected:(e.location===o?.location||ee(e.location)&&ee(o?.location??"local"))&&(e.id??e.name)===(o?.id??o?.name),onSelect:()=>{d(e)},children:[(0,V.jsx)(ne.l.LeadingVisual,{children:"local"===e.location?(0,V.jsx)(je.A,{}):"browser"===e.location?(0,V.jsx)(ke.A,{}):(0,V.jsx)(we.A,{})}),s+t.slice(0,10)]},e.name)}))},e))),!!n&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(ne.l.Divider,{}),n]})]})})]})}function Se(e,t,n,s=()=>!0,r){const a=(n=n??l.wK).load("jupyterlab"),o=e.local.kernelspecs.specs,c=e.local.sessions.running(),d={},h=Array.from(c).filter((e=>e.kernel&&e.kernel.id!==t&&o.kernelspecs[e.kernel.name])).map((e=>{const t=o.kernelspecs[e.kernel.name];return{id:e.kernel.id,name:t.name,language:t.language,displayName:e.name||i.PathExt.basename(e.path),location:"local"}})).concat(Array.from(e.browser?.sessions.running()??[]).filter((e=>e.kernel&&e.kernel.id!==t)).map((t=>{const n=e.browser.kernelspecs.specs.kernelspecs[t.kernel.name];return{id:t.kernel.id,name:n.name,language:n.language,displayName:t.name||i.PathExt.basename(t.path),location:"browser"}}))).filter(s),u=h.map((e=>e.id)),p=Array.from(e.local.kernels.running()).filter((e=>!u.includes(e.id))).map((e=>{const t=o.kernelspecs[e.name];return{id:e.id,name:t.name,language:t.language,displayName:t.display_name,location:"local"}})).concat((e.remote?.kernels.get()??[]).filter((e=>e.id&&!u.includes(e.id))).map((t=>{const n=e.remote.environments.get().find((e=>e.name===t.environment_name));return{id:t.id,name:n.name,language:n.language,displayName:t.kernel_given_name??n.title,location:"remote",podName:t.jupyter_pod_name}}))).concat(Array.from(e.browser?.kernels.running()??[]).filter((e=>!u.includes(e.id))).map((t=>{const n=e.browser.kernelspecs.specs.kernelspecs[t.name];return{id:t.id,name:n.name,language:n.language,displayName:n.display_name,location:"browser"}}))).filter(s);h.push(...p),h.length&&(d["cell"===r?"Assign a running Remote Runtime":"Assign a running Runtime"]=h);const m=Object.values(o.kernelspecs).filter((e=>!!e)).map((e=>({name:e.name,language:e.language,displayName:e.display_name,location:"local"}))).filter(s);return m.push(...e.remote?.environments.get().map((e=>({name:e.name,language:e.language,displayName:e.title,location:"remote",burningRate:e.burning_rate}))).filter(s)??[]),m.push(...Object.values(e.browser?.kernelspecs.specs?.kernelspecs??{}).filter((e=>!!e)).map((e=>({name:e.name,language:e.language,displayName:e.display_name,location:"browser"}))).filter(s)),m.length&&(d[a.__("Assign a new Kernel")]=m),d}function Ae(e){const{configuration:t}=(0,pe._O)(),{credits:n,refreshCredits:s,token:r}=(0,le.Y)(),[i,a]=(0,D.useState)(null),[o,l]=(0,D.useState)(Math.min(n?.available??0,10)),[c,d]=(0,D.useState)(!1),[h,u]=(0,D.useState)(!1),[p,m]=(0,D.useState)(!1),[g,y]=(0,D.useState)(!1),[f,_]=(0,D.useState)(!1),[v,x]=(0,D.useState)(),[w,j]=(0,D.useState)([]),{multiServiceManager:k,sessionContext:C,setValue:S,translator:A}=e;(0,D.useEffect)((()=>{s()}),[]),(0,D.useEffect)((()=>{const e=C.specsManager.specs?.kernelspecs;if(C.session?.kernel?.name&&e){const t=Object.values(e).find((e=>e?.name===C.session.kernel.name));t&&(a({name:t.name,id:C.session.kernel.id,location:C.location,language:t.language,displayName:C.kernelDisplayName}),u(X.supports(t.language)))}}),[C]);const R=(0,D.useCallback)((async()=>{if(f)return Promise.resolve();_(!0);const e=C.session.kernel,t=C.specsManager.specs.kernelspecs[e.model.name],n=new X(t.language),s=(await new M.D({connection:e}).execute(n.listVariables())).get(0).data["text/plain"];if(s)if(x(JSON.parse(s.slice(1,s.length-1))),w.length){const e=Object.keys(v??{});j(w.filter((t=>e.includes(t))))}else j(Object.keys(v??{}));else x({})}),[f,v,w]),E=(0,D.useCallback)((e=>{b.JSONExt.deepEqual(w,e)||j(e)}),[w]),P=(0,D.useCallback)((e=>{g!==e&&(e&&R().catch((e=>{console.error("Failed to list the kernel variable",e),_(!1)})),y(e))}),[g]),N=(0,D.useCallback)((e=>{null!==e?i?.displayName===e.displayName&&i?.id===e.id||(a({...e}),m(X.supports(e.language))):null!==i&&(a(null),m(!1))}),[i]),T=(0,D.useCallback)((e=>{e.preventDefault(),d(!c)}),[c]);(0,D.useEffect)((()=>{const e="remote"===i?.location&&i.burningRate?Math.min(o,me.z)*i.burningRate*60:void 0;S(0!==e?{kernel:i?{name:["browser","remote"].includes(i.location)?`${i.location}-${i.name}`:i.name,id:i.id,creditsLimit:e,capabilities:c?["persistent_storage"]:void 0}:null,selectedVariables:w}:new Error("Credits limit must be strictly positive."))}),[i,c,w,o]);const{kernelPreference:{canStart:F}}=C,L=Math.floor((n?.available??0)/(i?.burningRate??-1)/60),I=!n?.available||L<Number.EPSILON;return(0,V.jsxs)(te.A,{as:"form",className:"dla-kernel-picker",children:[(0,V.jsx)(te.A,{sx:{padding:"var(--stack-padding-condensed) 0"},children:(0,V.jsx)(Ce,{disabled:!1===F,preference:{id:C.session?.id,kernelDisplayName:C.kernelPreference.shouldStart?C.kernelDisplayName:void 0},serviceManager:k,translator:A,selection:i,setSelection:N,postActions:r||!e.logIn?void 0:(0,V.jsx)(ne.l.Item,{onSelect:e.logIn,title:"Connect to Runtime provider.",children:(0,V.jsx)(ue,{message:"Connect to the Runtime provider"})})})}),!i?.id&&"remote"===i?.location&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(me.N,{disabled:I||"remote"!==i?.location,label:"Time reservation",max:L<0?1:L,time:o,onTimeChange:l,error:I&&L>=0?"You must add credits to your account.":0===o?"You must set a time limit.":void 0,burningRate:i.burningRate}),!t.whiteLabel&&(0,V.jsxs)(O.A,{disabled:!!i?.id||"remote"!==i?.location,layout:"horizontal",children:[(0,V.jsxs)(O.A.Label,{children:["Persistent storage",(0,V.jsx)(se.A,{"aria-label":"The kernel will be slower to start.",direction:"e",style:{marginLeft:3},children:(0,V.jsx)(ie._0O,{})})]}),(0,V.jsx)(re.A,{disabled:!!i?.id||"remote"!==i?.location,checked:c,size:"small",onClick:T})]})]}),h&&p&&(0,V.jsx)(ve,{translator:A,selectedVariables:w,setSelectVariable:E,transferVariables:g,setTransferVariable:P,kernelVariables:v})]})}var Re=n(51857),Me=n(61859);function Ee(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Pe{constructor(e,t){Ee(this,"_path",""),Ee(this,"_name",""),Ee(this,"_type",""),Ee(this,"_prevKernelName",""),Ee(this,"_kernelPreference",void 0),Ee(this,"_isDisposed",!1),Ee(this,"_location","local"),Ee(this,"_disposed",new k.Signal(this)),Ee(this,"_session",null),Ee(this,"_ready",new b.PromiseDelegate),Ee(this,"_initializing",!1),Ee(this,"_initStarted",new b.PromiseDelegate),Ee(this,"_initPromise",new b.PromiseDelegate),Ee(this,"_isReady",!1),Ee(this,"_isTerminating",!1),Ee(this,"_isRestarting",!1),Ee(this,"_kernelChanged",new k.Signal(this)),Ee(this,"_preferenceChanged",new k.Signal(this)),Ee(this,"_sessionChanged",new k.Signal(this)),Ee(this,"_statusChanged",new k.Signal(this)),Ee(this,"_connectionStatusChanged",new k.Signal(this)),Ee(this,"translator",void 0),Ee(this,"_trans",void 0),Ee(this,"_pendingInput",!1),Ee(this,"_iopubMessage",new k.Signal(this)),Ee(this,"_unhandledMessage",new k.Signal(this)),Ee(this,"_propertyChanged",new k.Signal(this)),Ee(this,"_dialog",null),Ee(this,"_setBusy",void 0),Ee(this,"_busyDisposable",null),Ee(this,"_serviceManager",void 0),Ee(this,"_pendingKernelName",""),Ee(this,"_pendingSessionRequest",""),this.translator=e.translator||l.wK,this._trans=this.translator.load("jupyterlab"),this._path=e.path??b.UUID.uuid4(),this._type=e.type??"",this._name=e.name??"",this._setBusy=e.setBusy,this._kernelPreference=e.kernelPreference??{},this._serviceManager=t}get session(){return this._session??null}get path(){return this._path}get type(){return this._type}get name(){return this._name}get location(){return this._location}get kernelChanged(){return this._kernelChanged}get sessionChanged(){return this._sessionChanged}get statusChanged(){return this._statusChanged}get pendingInput(){return this._pendingInput}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get propertyChanged(){return this._propertyChanged}get kernelPreference(){return this._kernelPreference}set kernelPreference(e){if(!b.JSONExt.deepEqual(e,this._kernelPreference)){const t=this._kernelPreference;this._kernelPreference=e,this._preferenceChanged.emit({name:"kernelPreference",oldValue:t,newValue:b.JSONExt.deepCopy(e)})}}get kernelPreferenceChanged(){return this._preferenceChanged}get isReady(){return this._isReady}get ready(){return this._ready.promise}get isTerminating(){return this._isTerminating}get isRestarting(){return this._isRestarting}get kernelManager(){switch(this._location){case"browser":return this._serviceManager.browser.kernels;case"local":return this._serviceManager.local.kernels;default:const e=this._serviceManager.remote.kernels.getServices(this._location);return e?e.kernels:this._serviceManager.local.kernels}}get serviceManager(){return this._serviceManager}get sessionManager(){switch(this._location){case"browser":return this._serviceManager.browser.sessions;case"local":return this._serviceManager.local.sessions;default:const e=this._serviceManager.remote.kernels.getServices(this._location);return e?e.sessions:this._serviceManager.local.sessions}}get specsManager(){switch(this._location){case"browser":return this._serviceManager.browser.kernelspecs;case"local":return this._serviceManager.local.kernelspecs;default:const e=this._serviceManager.remote.kernels.getServices(this._location);return e?e.kernelspecs:this._serviceManager.local.kernelspecs}}get hasNoKernel(){return this.kernelDisplayName===this.noKernelName}get kernelDisplayName(){const e=this.session?.kernel;if(this._pendingKernelName===this.noKernelName)return this.noKernelName;let t="";if(t=ee(this.location)?"â˜ï¸Ž ":"browser"===this.location?"ðŸŒï¸Ž ":"ðŸ’»ï¸Ž ",e){if(ee(this.location)){const n=this.serviceManager.remote.kernels.get().find((t=>t.id===e.id));return t+n?.kernel_given_name??n?.environment_display_name??e.name}return t+(this.specsManager.specs?.kernelspecs[e.name]?.display_name??e.name)}return this._pendingKernelName?t+(this.specsManager.specs?.kernelspecs[this._pendingKernelName]?.display_name??this._pendingKernelName):this.noKernelName}get kernelDisplayStatus(){const e=this.session?.kernel;return this._isTerminating?"terminating":this._isRestarting?"restarting":this._pendingKernelName===this.noKernelName?"unknown":!e&&this._pendingKernelName?"initializing":e||this.isReady||!1===this.kernelPreference.canStart||!1===this.kernelPreference.shouldStart?("connected"===e?.connectionStatus?e?.status:e?.connectionStatus)??"unknown":"initializing"}get prevKernelName(){return this._prevKernelName}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}get noKernelName(){return this._trans.__("No Kernel")}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._session&&(this.kernelPreference.shutdownOnDispose&&this.sessionManager.shutdown(this._session.id).catch((e=>{console.error(`Kernel not shut down ${e}`)})),this._session.dispose(),this._session=null),this._dialog&&this._dialog.dispose(),this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null),k.Signal.clearData(this))}async startKernel(){const e=this.kernelPreference;if(!e.autoStartDefault&&!1===e.shouldStart)return!0;let t;if(e.id)t={id:e.id};else{const n=function(e){const{specs:t,preference:n}=e,{name:s,language:r,canStart:i,autoStartDefault:a}=n;if(!t||!1===i)return null;const o=a?t.default:null;if(!s&&!r)return o;for(const e in t.kernelspecs)if(e===s)return s;if(!r)return o;const l=[];for(const e in t.kernelspecs){const n=t.kernelspecs[e]?.language;r===n&&l.push(e)}if(1===l.length){const e=l[0];return console.warn("No exact match found for "+e+", using kernel "+e+" that matches language="+r),e}return o}({specs:this.specsManager.specs,sessions:this.sessionManager.running(),preference:e});n&&(t={name:n})}if(t)try{return await this._changeKernel(t),!1}catch(e){}return!0}async restartKernel(){const e=this.session?.kernel||null;if(!this._isRestarting){this._isRestarting=!0,this._isReady=!1,this._statusChanged.emit("restarting");try{await(this.session?.kernel?.restart()),this._isReady=!0}catch(e){console.error(e)}this._isRestarting=!1,this._statusChanged.emit(this.session?.kernel?.status||"unknown"),this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:this.session?.kernel||null})}}async changeKernel(e={}){if(this.isDisposed)throw new Error("Disposed");return await this._initStarted.promise,this._changeKernel(e)}async shutdown(){if(!this.isDisposed&&this._initializing)return await this._initStarted.promise,this._pendingSessionRequest="",this._pendingKernelName=this.noKernelName,this._shutdownSession()}async initialize(){if(this._initializing)return this._initPromise.promise;this._initializing=!0;const e=await this._initialize();return e||(this._isReady=!0,this._ready.resolve(void 0)),this._pendingSessionRequest||this._initStarted.resolve(void 0),this._initPromise.resolve(e),e}async _initialize(){const e=this.sessionManager;await e.ready,await e.refreshRunning();const t=(0,N.I6)(e.running(),(e=>e.path===this._path));if(t)try{const n=e.connectTo({model:t});this._handleNewSession(n)}catch(e){return this._handleSessionError(e),Promise.reject(e)}return await this._startIfNecessary()}async _shutdownSession(){const e=this._session,t=this._isTerminating,n=this._isReady;this._isTerminating=!0,this._isReady=!1,this._statusChanged.emit("terminating");try{await(e?.shutdown()),this._isTerminating=!1,e?.dispose(),this._session=null;const t=e?.kernel||null;this._statusChanged.emit("unknown"),this._kernelChanged.emit({name:"kernel",oldValue:t,newValue:null}),this._sessionChanged.emit({name:"session",oldValue:e,newValue:null})}catch(s){this._isTerminating=t,this._isReady=n;const r=e?.kernel?.status;throw void 0===r?this._statusChanged.emit("unknown"):this._statusChanged.emit(r),s}}async _startIfNecessary(){const e=this.kernelPreference;return!this.isDisposed&&!this.session?.kernel&&!1!==e.shouldStart&&!1!==e.canStart&&this.startKernel()}async _changeKernel(e={}){let t;if(e.id){if(await this.serviceManager.local.kernels.refreshRunning(),(0,N.I6)(this.serviceManager.local.kernels.running(),(t=>t.id===e.id))&&(t="local"),!t&&this.serviceManager.remote){await this.serviceManager.remote.kernels.refresh();const n=this.serviceManager.remote.kernels.get().find((t=>t.id===e.id));n&&(t=n.jupyter_pod_name)}!t&&this.serviceManager.browser&&(await this.serviceManager.browser.kernels.refreshRunning(),(0,N.I6)(this.serviceManager.browser.kernels.running(),(t=>t.id===e.id))&&(t="browser"))}if(!t)switch(e.name?.split("-",1)[0]){case"browser":t="browser";break;case"remote":t="remote";break;default:t="local"}const n=this._location===t;if(!n&&ee(this._location)&&(console.debug("Shutting down the current remote session as the kernel location is changing."),await this._shutdownSession()),this._location=t,e.name&&("local"!==this._location&&(e.name=e.name.replace(/^(remote-|browser-)/,"")),this._pendingKernelName=e.name),this._session||this._kernelChanged.emit({name:"kernel",oldValue:null,newValue:null}),this._pendingSessionRequest||this._initStarted.resolve(void 0),n&&this._session&&!this._isTerminating)try{return console.log("--- Reusing session and changing the kernel with a model",this._session,e),await this._session.changeKernel(e),this._session.kernel}catch(e){throw this._handleSessionError(e),e}const s=i.PathExt.dirname(this._path),r=this._pendingSessionRequest=i.PathExt.join(s,b.UUID.uuid4());try{if(this._statusChanged.emit("starting"),"remote"===this._location){let t=e.creditsLimit;if(!t){const{credits:e}=le.J7.getState(),{configuration:n,remoteKernels:s}=Re.iP.getState();if(t=(e?.available??0)/Math.max(n.maxNotebookKernels-s.filter((e=>"cell"!==e.kernel_type)).length,1),t<3)throw new Error("You do not have enough credits to start a remote kernel.")}const n=await(this.serviceManager.remote?.kernels.startNew({name:e.name,kernelType:"notebook",creditsLimit:t,givenName:e.givenName,capabilities:e.capabilities},{handleComms:!0}));if(n){e.id=n.model.id;const t=await(this.serviceManager.remote?.kernels.findById(n.model.id));t&&(this._location=t.jupyter_pod_name),n.dispose()}}const t=await this.sessionManager.startNew({path:r,type:this._type,name:this._name,kernel:e});return this._pendingSessionRequest!==t.path?(await t.shutdown(),t.dispose(),null):(await t.setPath(this._path),await t.setName(this._name),this._session&&!this._isTerminating&&await this._shutdownSession(),this._handleNewSession(t))}catch(e){throw 503===e.response?.status?(0,E.f1)("Unable to create a new remote kernel",Me.X):"MaxKernelsError"===e.name?(0,E.f1)("Unable to create a new remote kernel","You have reached your Notebook Remote Runtimes limit. Stop some Kernels to start new ones."):this._handleSessionError(e),e}}_handleNewSession(e){if(this.isDisposed)throw Error("Disposed");return this._isReady||(this._isReady=!0,this._ready.resolve(void 0)),this._session&&this._session.dispose(),this._session=e,this._pendingKernelName="",e&&(this._prevKernelName=e.kernel?.name??"",e.disposed.connect(this._onSessionDisposed,this),e.propertyChanged.connect(this._onPropertyChanged,this),e.kernelChanged.connect(this._onKernelChanged,this),e.statusChanged.connect(this._onStatusChanged,this),e.connectionStatusChanged.connect(this._onConnectionStatusChanged,this),e.pendingInput.connect(this._onPendingInput,this),e.iopubMessage.connect(this._onIopubMessage,this),e.unhandledMessage.connect(this._onUnhandledMessage,this),e.path!==this._path&&this._onPropertyChanged(e,"path"),e.name!==this._name&&this._onPropertyChanged(e,"name"),e.type!==this._type&&this._onPropertyChanged(e,"type")),this._sessionChanged.emit({name:"session",oldValue:null,newValue:e}),this._kernelChanged.emit({oldValue:null,newValue:e?.kernel||null,name:"kernel"}),this._statusChanged.emit(e?.kernel?.status||"unknown"),e?.kernel||null}async _handleSessionError(e){this._handleNewSession(null);let t="",n="";try{t=e.traceback,n=e.message}catch(e){}await this._displayKernelError(n,t)}async _displayKernelError(e,t){const n=(0,V.jsxs)("div",{children:[e&&(0,V.jsx)("pre",{children:e}),t&&(0,V.jsx)("details",{className:"jp-mod-wide",children:(0,V.jsx)("pre",{children:t})})]}),s=this._dialog=new E.lG({title:this._trans.__("Error Starting Kernel"),body:n,buttons:[E.lG.okButton()]});await s.launch(),this._dialog=null}_onSessionDisposed(){if(this._session){const e=this._session;this._session=null;const t=this._session;this._sessionChanged.emit({name:"session",oldValue:e,newValue:t})}}_onPropertyChanged(e,t){switch(t){case"path":this._path=e.path;break;case"name":this._name=e.name;break;case"type":this._type=e.type;break;default:throw new Error(`unrecognized property ${t}`)}this._propertyChanged.emit(t)}_onKernelChanged(e,t){this._kernelChanged.emit(t)}_onStatusChanged(e,t){if("dead"===t){const t=e.kernel?.model;if(t?.reason){const e=t.traceback||"";this._displayKernelError(t.reason,e)}}this._setBusy&&("busy"===t?this._busyDisposable||(this._busyDisposable=this._setBusy()):this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null)),this._statusChanged.emit(t)}_onConnectionStatusChanged(e,t){this._connectionStatusChanged.emit(t)}_onPendingInput(e,t){this._pendingInput=t}_onIopubMessage(e,t){"shutdown_reply"===t.header.msg_type&&this.session.kernel.removeInputGuard(),this._iopubMessage.emit(t)}_onUnhandledMessage(e,t){this._unhandledMessage.emit(t)}}(Pe||(Pe={})).getDefaultKernel=function e(t){const{preference:n}=t,{shouldStart:s}=n;return!1===s?null:e(t)};class Ne{constructor(e={},t,n){Ee(this,"_commandRegistry",void 0),Ee(this,"_multiServiceManager",void 0),Ee(this,"_translator",void 0),this._translator=e.translator??l.wK,this._commandRegistry=n,this._multiServiceManager=t}async selectKernel(e){if(e.isDisposed)return Promise.resolve();const t=this._translator.load("jupyterlab");let n=t.__("Cancel");e.hasNoKernel&&(n=e.kernelDisplayName);const s=e.kernelPreference.autoStartDefault,r="boolean"==typeof s,i=new W({title:t.__("Assign a Kernel for %1",e.name),body:t=>(0,V.jsx)(Ae,{sessionContext:e,multiServiceManager:this._multiServiceManager,logIn:this._commandRegistry.hasCommand("@datalayer/jupyter-kernels:create-widget")?()=>{this._commandRegistry.execute("@datalayer/jupyter-kernels:create-widget"),i.close()}:void 0,setValue:t.setValue,translator:this._translator}),buttons:[E.lG.cancelButton({label:n}),E.lG.okButton({label:t.__("Assign"),ariaLabel:t.__("Assign Kernel")})],checkbox:r?{label:t.__("Always start the preferred Kernel"),caption:t.__("Remember my choice and always start the preferred Kernel"),checked:s}:null}),a=await i.launch();if(e.isDisposed||!a.button.accept)return;r&&null!==a.isChecked&&(e.kernelPreference={...e.kernelPreference,autoStartDefault:a.isChecked});const{kernel:o,selectedVariables:l}=await(a.value??Promise.resolve({kernel:null,selectedVariables:[]}));if(null!==o||e.hasNoKernel||(await e.shutdown(),P.E.success("Kernel stopped.")),o){let n,s="";if(l.length){n=P.E.emit("Saving the variablesâ€¦","in-progress",{autoClose:!1});try{s=await async function(e,t){if(t.length){const n=e.session.kernel,s=e.specsManager.specs.kernelspecs[n.model.name],r=new X(s.language);return(await new M.D({connection:n}).execute(r.saveVariables(t))).get(0).data["text/plain"]}return""}(e,l)}catch(e){return n&&P.E.update({id:n,message:"Failed to save the variables",type:"error",autoClose:!1}),void console.error(e)}}n&&P.E.update({id:n,message:"Starting the new kernelâ€¦"});const r=await e.changeKernel(o);if(r){let i;try{const t=e.specsManager.specs.kernelspecs[r.model.name];i=new X(t.language)}catch(e){return console.warn("Kernel snippets not supported.",e),void(n&&P.E.update({id:n,message:"Kernel is ready",type:"success",autoClose:3e3}))}"remote"===e.location&&await new M.D({connection:r}).execute(i.changeCurrentWorkingDirectory("content/local"));try{const r=[];if(s){n&&P.E.update({id:n,message:"Importing the variablesâ€¦"});const t=(await new M.D({connection:e.session.kernel}).execute(i.loadVariables(s))).get(0).data["text/plain"]||"[]",a=JSON.parse(t.slice(1,t.length-1));r.push(...l.filter((e=>!a.includes(e))))}n&&P.E.update({id:n,message:"Kernel is ready",type:r.length?"warning":"success",autoClose:3e3,actions:r.length?[{label:t.__("Warnings"),callback:()=>{(0,E.ui)({title:t.__("Warning"),body:`The following variables were not transferred: ${r.join(", ")}`,buttons:[E.lG.warnButton({label:t.__("Dismiss")})]})},displayType:"warn"}]:void 0})}catch(e){console.error(e),n&&P.E.update({id:n,message:"Fail to import the variables",type:"error"})}}}}async restart(e){const t=this._translator.load("jupyterlab");if(await e.initialize(),e.isDisposed)throw new Error("session already disposed");const n=e.session?.kernel;if(!n&&e.prevKernelName)return await e.changeKernel({name:e.prevKernelName}),!0;if(!n)throw new Error("No kernel to restart");const s=E.lG.warnButton({label:t.__("Restart"),ariaLabel:t.__("Confirm Kernel Restart")}),r=await(0,E.ui)({title:t.__("Restart Kernel?"),body:t.__("Do you want to restart the kernel of %1? All variables will be lost.",e.name),buttons:[E.lG.cancelButton({ariaLabel:t.__("Cancel Kernel Restart")}),s]});return!n.isDisposed&&!!r.button.accept&&(await e.restartKernel(),!0)}}const De="@datalayer/jupyter-kernels:plugin",Te=new b.Token("@datalayer/jupyter-kernels:multi-service-manager"),Fe=new b.Token("@datalayer/jupyter-kernels:browser-router"),Le=new b.Token("@datalayer/jupyter-kernels:plugin");function Ie(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Oe;var Ke;(Ke=Oe||(Oe={})).createConsole="@datalayer/jupyter-kernels:new-browser-console",Ke.createNotebook="@datalayer/jupyter-kernels:new-browser-notebook";const Ue={id:"@datalayer/jupyter-kernels:browser-localforage",autoStart:!1,requires:[R.R],provides:y.n,activate:async(e,t)=>({localforage:S()})},$e={id:"@datalayer/jupyter-kernels:browser-localforage-memory-storage",autoStart:!1,requires:[y.n],activate:async(e,t)=>{JSON.parse(i.PageConfig.getOption("enableMemoryStorage")||"false")&&(console.warn("Memory storage fallback enabled: contents and settings may not be saved"),await(0,y.G)(t.localforage))}},Ve={id:"@datalayer/jupyter-kernels:browser-contents",requires:[y.n],autoStart:!1,provides:d.GJ,activate:(e,t)=>{const n=i.PageConfig.getOption("contentsStorageName"),s=JSON.parse(i.PageConfig.getOption("contentsStorageDrivers")||"null"),{localforage:r}=t,a=new h.v({storageName:n,storageDrivers:s,localforage:r});return e.started.then((()=>a.initialize().catch(console.warn))),a}},ze={id:"@datalayer/jupyter-kernels:browser-contents-routes",autoStart:!1,requires:[Fe,d.GJ],activate:(e,t,n)=>{t.get("/api/contents/(.+)/checkpoints",(async(e,t)=>{const s=await n.listCheckpoints(t);return new Response(JSON.stringify(s))})),t.post("/api/contents/(.+)/checkpoints/(.*)",(async(e,t,s)=>{const r=await n.restoreCheckpoint(t,s);return new Response(JSON.stringify(r),{status:204})})),t.post("/api/contents/(.+)/checkpoints",(async(e,t)=>{const s=await n.createCheckpoint(t);return new Response(JSON.stringify(s),{status:201})})),t.delete("/api/contents/(.+)/checkpoints/(.*)",(async(e,t,s)=>{const r=await n.deleteCheckpoint(t,s);return new Response(JSON.stringify(r),{status:204})})),t.get("/api/contents(.*)",(async(e,t)=>{const s={content:"1"===e.query?.content},r=await n.get(t,s);return r?new Response(JSON.stringify(r)):new Response(null,{status:404})})),t.post("/api/contents(.*)",(async(e,t)=>{const s=e.body,r=s?.copy_from;let i;return i=r?await n.copy(r,t):await n.newUntitled(s),i?new Response(JSON.stringify(i),{status:201}):new Response(null,{status:400})})),t.patch("/api/contents(.*)",(async(e,t)=>{const s=e.body?.path??"";t="/"===t[0]?t.slice(1):t;const r=await n.rename(t,s);return new Response(JSON.stringify(r))})),t.put("/api/contents/(.+)",(async(e,t)=>{const s=e.body,r=await n.save(t,s);return new Response(JSON.stringify(r))})),t.delete("/api/contents/(.+)",(async(e,t)=>(await n.delete(t),new Response(null,{status:204}))))}};class qe{constructor(e){Ie(this,"_registration",null),Ie(this,"_registrationChanged",new k.Signal(this)),Ie(this,"_ready",new b.PromiseDelegate);const t=e?.workerUrl??i.URLExt.join(i.PageConfig.getBaseUrl(),f.H);this.initialize(t).catch(console.warn)}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}get ready(){return this._ready.promise}async initialize(e){const{serviceWorker:t}=navigator;let n=null;if(t?t.controller&&(n=await t.getRegistration(t.controller.scriptURL)||null,console.info("JupyterLite ServiceWorker was already registered")):console.warn("ServiceWorkers not supported in this browser"),!n&&t)try{const s=await t.getRegistrations();await Promise.all(s.map((e=>e.unregister()))),console.info("Existing JupyterLite ServiceWorkers unregistered"),console.info("Registering new JupyterLite ServiceWorker",e),n=await t.register(e,{scope:i.PageConfig.getBaseUrl()}),console.info("JupyterLite ServiceWorker was successfully registered")}catch(e){console.warn(e),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${e}`)}this.setRegistration(n),n?this._ready.resolve(void 0):this._ready.reject(void 0)}setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}}const We={id:"@datalayer/jupyter-kernels:browser-service-worker",autoStart:!1,provides:f.u,requires:[R.R],activate:async(e,t)=>new qe({workerUrl:i.URLExt.join(i.PageConfig.getBaseUrl(),"datalayer/service-worker",f.H)})},Je={id:"@datalayer/jupyter-kernels:emscripten-filesystem",autoStart:!1,requires:[Te,Fe],optional:[f.u],provides:d.LX,activate:(e,t,n,s)=>{const{contents:r}=t.browser??{};if(!r)throw new Error("Unable to activate emscripten-filesystem plugin without the browser service manager.");const i=new u.Y({contents:r}),a="Kernel filesystem and JupyterLite contents";function o(e,t){t&&console.warn(t),e&&console.warn(e),t||e?console.warn(`${a} will NOT be synced`):console.info(`${a} will be synced`)}return s?s.ready.then((()=>{i.enable(),o()})).catch((e=>{o("JupyterLite ServiceWorker failed to become available",e)})):o("JupyterLite ServiceWorker not available"),i}},He={id:"@datalayer/jupyter-kernels:browser-kernels",autoStart:!1,provides:p.il,requires:[p.X],activate:(e,t)=>new m.j({kernelspecs:t})},Be={id:"@datalayer/jupyter-kernels:browser-kernels-routes",autoStart:!1,requires:[Fe,p.il],activate:(e,t,n)=>{t.get("/api/kernels/(.*)",(async(e,t)=>{const s=await n.get(t);return s?new Response(JSON.stringify(s)):new Response(void 0,{status:404})})),t.get("/api/kernels",(async e=>{const t=await n.list();return new Response(JSON.stringify(t))})),t.post("/api/kernels",(async e=>{const{name:t="python",path:s}=e.body,r=await n.startNew({id:b.UUID.uuid4(),name:t,location:s?i.PathExt.dirname(s):""});return new Response(JSON.stringify(r),{status:201})})),t.post("/api/kernels/(.*)/restart",(async(e,t)=>{const s=await n.restart(t);return new Response(JSON.stringify(s))})),t.delete("/api/kernels/(.*)",(async(e,t)=>{const s=await n.shutdown(t);return new Response(JSON.stringify(s),{status:204})}))}},Ge={id:"@datalayer/jupyter-kernels:browser-kernelspec",autoStart:!1,provides:p.X,requires:[R.R],optional:[l.sQ,a.k],activate:async(e,t,n,s)=>{const r=new g.K,i=(n??l.wK).load("datalayer");if(s){let e=null,t=new w.DisposableSet;new j.Poll({factory:async()=>{const n=r.specs;b.JSONExt.deepEqual(e,n)||(t.dispose(),e=n,t=new w.DisposableSet,Object.values(e?.kernelspecs??{}).map((e=>{if(e){const n=e.resources["logo-svg"]||e.resources["logo-64x64"];t.add(s.add({command:Oe.createConsole,args:{isLauncher:!0,kernelName:`browser-${e.name}`},category:i.__("Console"),kernelIconUrl:n,metadata:{kernel:b.JSONExt.deepCopy(e.metadata||{})}})),t.add(s.add({command:Oe.createNotebook,args:{isLauncher:!0,kernelName:`browser-${e.name}`},category:i.__("Notebook"),kernelIconUrl:n,metadata:{kernel:b.JSONExt.deepCopy(e.metadata||{})}}))}})))}})}return r}},Ye={id:"@datalayer/jupyter-kernels:browser-kernelspec-routes",autoStart:!1,requires:[Fe,p.X],activate:(e,t,n)=>{t.get("/api/kernelspecs",(async e=>{const{specs:t}=n;if(!t)return new Response(null);const s={},r=t.kernelspecs;Object.keys(r).forEach((e=>{const t=r[e],{resources:n}=t??{};s[e]={name:e,spec:t,resources:n}}));const i={default:t.default,kernelspecs:s};return new Response(JSON.stringify(i))}))}},Qe={id:"@datalayer/jupyter-kernels:browser-sessions",autoStart:!1,provides:v.L,requires:[p.il],activate:(e,t)=>new x.A({kernels:t})},Xe={id:"@datalayer/jupyter-kernels:browser-sessions-routes",autoStart:!1,requires:[Fe,v.L],activate:(e,t,n)=>{t.get("/api/sessions/(.+)",(async(e,t)=>{const s=await n.get(t);return new Response(JSON.stringify(s),{status:200})})),t.get("/api/sessions",(async e=>{const t=await n.list();return new Response(JSON.stringify(t),{status:200})})),t.patch("/api/sessions(.*)",(async(e,t)=>{const s=e.body,r=await n.patch(s);return new Response(JSON.stringify(r),{status:200})})),t.delete("/api/sessions/(.+)",(async(e,t)=>(await n.shutdown(t),new Response(null,{status:204})))),t.post("/api/sessions",(async e=>{const t=e.body,s=await(async e=>{const{path:t,name:s}=e,r=n._sessions.find((e=>e.path===t));if(r)return r;const a=e.id??b.UUID.uuid4(),o=e.kernel?.id??a,l=e.kernel?.name??"",c=e.name??e.path,d=i.PathExt.dirname(e.name)||i.PathExt.dirname(e.path),h=c.includes(":")?c.split(":")[0]:"",u=d.includes(h)?d:`${h}:${d}`,p=await n._kernels.startNew({id:o,name:l,location:u}),m={id:a,path:t,name:s??t,type:"notebook",kernel:{id:p.id,name:p.name}};return n._sessions.push(m),n._handleKernelShutdown({kernelId:a,sessionId:m.id}),m})(t);return new Response(JSON.stringify(s),{status:201})}))}};class Ze{constructor(e){Ie(this,"_stream",void 0),Ie(this,"_serverSettings",void 0),this._stream=new k.Stream(this),this._serverSettings=e.serverSettings}async emit(e){}dispose(){}get isDisposed(){return!0}get stream(){return this._stream}get serverSettings(){return this._serverSettings}}const et=[Ve,ze,{id:"@datalayer/jupyter-kernels:browser-manager",requires:[Te,R.R],optional:[l.sQ,r.n3],provides:Fe,autoStart:!1,activate:async(e,t,n,s,r)=>{const a=(s??l.wK).load("jupyterlab"),d=new _.I,h={...o.ServerConnection.makeSettings(),WebSocket:A.WebSocket,fetch:async(e,t)=>{if(!(e instanceof Request))throw Error("Request info is not a Request");try{return d.route(e)}catch(n){if(n.message.startsWith("Cannot route"))return console.log(`No browser route for ${e.method} ${e.url}`),fetch(e,t);throw n}}},u=t.browser=new o.ServiceManager({standby:"never",serverSettings:h,events:new Ze({serverSettings:h})});let p=0;return e.commands.addCommand(Oe.createConsole,{label:e=>{const t=e.kernelName||"";if(e.isLauncher&&t&&u.kernelspecs){const e=t.startsWith("browser-")?t.slice(8):t;return u.kernelspecs.specs?.kernelspecs[e]?.display_name??e}return e.isPalette||e.isContextMenu?a.__("New Console"):a.__("Console")},caption:a.__("Create a new console"),icon:e=>e.isPalette?void 0:c.zk,execute:n=>{const s=p++;let o=n.path;return o||(o=i.PathExt.join(n.basePath||"",`console-browser-${s}-${b.UUID.uuid4()}`)),n.sessionContext=new Pe({sessionManager:t.sessions,specsManager:t.kernelspecs,path:t.contents.localPath(o),name:n.name||a.__("Console %1",s),type:"console",kernelPreference:n.kernelPreference,setBusy:r?()=>r.setBusy():void 0},t),e.commands.execute("console:create",n)}}),e.commands.addCommand(Oe.createNotebook,{label:e=>{const t=e.kernelName||"";if(e.isLauncher&&t&&u.kernelspecs){const e=t.startsWith("browser-")?t.slice(8):t;return u.kernelspecs.specs?.kernelspecs[e]?.display_name??e}return e.isPalette||e.isContextMenu?a.__("New Notebook"):a.__("Notebook")},caption:a.__("Create a new notebook"),icon:e=>e.isPalette?void 0:c.JG,execute:t=>e.commands.execute("notebook:create-new",t)}),d}},Je,He,Be,Ge,Ye,$e,Ue,We,Qe,Xe];var tt=n(67903),nt=n(43022);function st(e){const{getInputOptions:t,inputs:n,setInputs:s,getOutputOptions:r,output:i,setOutput:a,translator:o}=e,c=(0,D.useMemo)((()=>(o??l.wK).load("jupyterlab")),[o]),d=(0,D.useRef)(null),[h,u]=(0,D.useState)(!1),[p,m]=(0,D.useState)(!!t),[g,y]=(0,D.useState)(null),[f,_]=(0,D.useState)(n.map((e=>({id:e,text:e,selected:!0})))),[v,x]=(0,D.useState)("");(0,D.useEffect)((()=>{const e=n.filter((e=>!f.find((t=>t.text===e))));e.length&&_([...f,...e.map((e=>({id:e,text:e,selected:!0})))])}),[n]),(0,D.useEffect)((()=>{const e=f.filter((e=>e.selected)).map((e=>e.text));b.JSONExt.deepEqual(n,e)||s(e)}),[f]),(0,D.useEffect)((()=>{p&&(t?t().then((e=>{const t=f.map((e=>e.text));_([...f,...e.sort().filter((e=>!t.includes(e))).map((e=>({id:e,text:e,selected:!1})))]),m(!1)})):m(!1))}),[f,t]),(0,D.useEffect)((()=>{r&&Promise.all([r(),t?.()]).then((([e,t])=>{y(e.sort().concat((t??[]).sort()).reduce(((e,t)=>(e.includes(t)||e.push(t),e)),[]).map((e=>({id:e,text:e,selected:!1}))))})).catch((e=>{console.error("Failed to get the cell output candidates",e),y([])}))}),[r,t]);const w=(0,D.useCallback)((e=>{const t=f.findIndex((t=>t.id===e));t>=0&&(f.splice(t,1),_([...f]))}),[f]),j=(0,D.useCallback)((e=>{Array.isArray(e)||(e=[e]);const t=e.map((e=>e.id));_([...f.map((e=>t.includes(e.id)?Object.assign(e,{selected:!0}):Object.assign(e,{selected:!1})))])}),[f]),k=(0,D.useCallback)((e=>{const t=f.find((t=>t.id===e.id));t?(t.selected=!0,_([...f])):_([...f,e])}),[f]),C=(0,D.useCallback)((e=>{e.currentTarget&&x(e.currentTarget.value)}),[]),S=(0,D.useCallback)((e=>{e.currentTarget&&a(e.currentTarget.value)}),[]),A=(0,D.useCallback)((e=>{h?d.current&&!e&&(a(d.current.value),u(!1)):e&&u(!0)}),[h]);return(0,V.jsxs)(te.A,{as:"form",sx:{p:3},children:[(0,V.jsxs)(O.A,{children:[(0,V.jsx)(O.A.Label,{id:"cell-input-variables",children:c.__("Inputs")}),(0,V.jsxs)(tt.A,{children:[(0,V.jsx)(tt.A.Input,{as:nt.A,tokens:f.filter((e=>e.selected)),onTokenRemove:w,onChange:C}),(0,V.jsx)(tt.A.Overlay,{children:(0,V.jsx)(tt.A.Menu,{addNewItem:v&&!f.find((e=>e.text===v))?{id:v,text:c.__("Add '%1'",v),handleAddItem:e=>{k({...e,text:v,selected:!0}),x("")}}:void 0,items:f,selectedItemIds:f.filter((e=>e.selected)).map((e=>e.id)),onSelectedChange:j,"aria-labelledby":"cell-input-variables",selectionVariant:"multiple",emptyStateText:c.__("No available variables."),loading:p})})]})]}),(0,V.jsxs)(O.A,{children:[(0,V.jsx)(O.A.Label,{id:"cell-output-variables",children:c.__("Output")}),(0,V.jsxs)(tt.A,{children:[(0,V.jsx)(tt.A.Input,{ref:d,value:i,onChange:S}),(0,V.jsx)(tt.A.Overlay,{children:(0,V.jsx)(tt.A.Menu,{items:g??[],selectedItemIds:i?[i]:[],"aria-labelledby":"cell-output-variables",loading:r&&!g,emptyStateText:c.__("Not among the available variables."),onOpenChange:A})})]})]})]})}function rt(e){const{onClose:t,model:n,preference:s,sessionContext:r,translator:i}=e,[a,o]=(0,D.useState)([]),[c,d]=(0,D.useState)(),h=(0,D.useMemo)((()=>(i??l.wK).load("jupyterlab")),[i]);(0,D.useEffect)((()=>{const e=e=>{const t=e.getMetadata("datalayer")??{};t.in&&!b.JSONExt.deepEqual(a,t.in)&&o(t.in),t.out&&t.out!==c&&d(t.out)};return e(n),n.metadataChanged.connect(e),()=>{n.metadataChanged.disconnect(e)}}),[n]);const u=(0,D.useCallback)((()=>{const e=n.getMetadata("datalayer")??{};a.length?e.in=a:delete e.in,c?e.out=c:delete e.out,n.setMetadata("datalayer",{...e}),t()}),[a,c]),p=(0,D.useCallback)((async()=>{if(!r)return[];const e=r.session.kernel,t=r.specsManager.specs.kernelspecs[e.model.name],n=new X(t.language),s=(await new M.D({connection:e}).execute(n.listVariables())).get(0).data["text/plain"];if(s){const e=JSON.parse(s.slice(1,s.length-1));return Object.keys(e??{})}return[]}),[s,r]),m=(0,D.useCallback)((async()=>new X("python").getOutputCandidates(n.sharedModel.source)),[n]);let g="Define cell variables to transfer";const y=(n.getMetadata("datalayer")??{}).kernel??{},f=(y.displayName||y.name)??"";return f&&(!1!==y.params?.notebook&&y.id?g+=` with running ${f} (${y.id.slice(0,7)})`:g+=` with ${f}`),(0,V.jsx)(U.l,{title:g,onClose:t,footerButtons:[{buttonType:"default",content:h.__("Cancel"),onClick:t},{buttonType:"primary",content:h.__("Set variables"),onClick:u,autoFocus:!0}],children:(0,V.jsx)(st,{inputs:a,getInputOptions:r?p:void 0,setInputs:o,output:c??void 0,getOutputOptions:m,setOutput:d,translator:i})})}function it(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function at(e){const{model:t}=e,[n,s]=(0,D.useState)(!1),[r,i]=(0,D.useState)(!1),a=(0,D.useCallback)((()=>{s(!1)}),[]);return(0,D.useEffect)((()=>{const e=e=>{const t=e.getMetadata("datalayer")??{};i(!!t.kernel)};return e(t),t.metadataChanged.connect(e),()=>{t.metadataChanged.disconnect(e)}}),[t]),r?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(ge.K,{style:{color:"var(--jp-brand-color1)"},icon:ie.HGl,"aria-label":"Set variables to transfer between runtimes",variant:"invisible",size:"small",title:"Set variables to transfer between runtimes",onClick:e=>{e.preventDefault(),s(!0)}}),n&&(0,V.jsx)($.N,{inJupyterLab:!0,children:(0,V.jsx)(rt,{...e,onClose:a})})]}):null}class ot{constructor(e,t){this.commands=t,it(this,"_isDisposed",!1),it(this,"_cellActions",new WeakMap),it(this,"_panel",void 0),this._panel=e,this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this),this._panel.content.modelChanged.connect((()=>{this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this)}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,k.Signal.clearData(this))}updateConnectedCell(e,t){t.oldValues.forEach((e=>{this._removeAction(e)})),Promise.all(t.newValues.map((e=>this._addAction(e))))}async _addAction(e){const t=this._panel.content.widgets.find((t=>t.model===e));if("code"===t?.model.type){await t.ready;const n=T._Q.create((0,V.jsx)(at,{model:t.model,preference:this._panel.sessionContext?{id:this._panel.sessionContext.session?.kernel?.id,language:this._panel.sessionContext.specsManager.specs?.kernelspecs[this._panel.sessionContext.session?.kernel?.name??""]?.language}:void 0,sessionContext:this._panel.sessionContext,translator:this._panel.translator}));n.addClass("dla-cell-action"),this._cellActions.has(e)&&this._cellActions.get(e)?.dispose(),this._cellActions.set(e,t),this._panel.disposed.connect((()=>{this._cellActions.delete(e),n.dispose()})),t.layout.addWidget(n)}}_removeAction(e){this._cellActions.get(e)?.dispose()}}class lt{constructor(e){this.commands=e,it(this,"_extensions",new WeakMap)}createNew(e,t){const n=new ot(e,this.commands);return this._extensions.set(e,n),e.disposed.connect((()=>{this._extensions.delete(e)})),n}}const ct={id:"@datalayer/jupyter-kernels:cell-action",description:"Cell action item",optional:[l.sQ],autoStart:!1,activate:(e,t)=>{e.docRegistry.addWidgetExtension("Notebook",new lt(e.commands))}};var dt=n(59179),ht=n(89460),ut=n(51671),pt=n(5279),mt=n(69584),gt=n(98045),yt=n(21438);function ft(e){const{model:t,onClose:n,language:s,snippets:r,markdownParser:i,sanitizer:a,translator:o}=e,[c,d]=(0,D.useState)(r[0]),h=(0,D.useMemo)((()=>(o??l.wK).load("jupyterlab")),[o]),u=(0,D.useCallback)((e=>{const t=e.target.value;d(r[parseInt(t,10)])}),[d,r]),p=(0,D.useCallback)((()=>{const e=t.sharedModel.getSource().length;t.sharedModel.updateSource(e,e,"\n".repeat(e?2:0)+c.code),n()}),[t,c,n]);return(0,V.jsx)(U.l,{title:"Pick a snippet to inject",onClose:n,footerButtons:[{buttonType:"default",content:h.__("Cancel"),onClick:n},{buttonType:"primary",content:h.__("Inject snippet"),onClick:p,autoFocus:!0}],children:(0,V.jsx)(te.A,{as:"form",children:(0,V.jsxs)(O.A,{children:[(0,V.jsx)(O.A.Label,{}),(0,V.jsx)(gt.A,{block:!0,onChange:u,children:r.map(((e,t)=>(0,V.jsx)(gt.A.Option,{value:`${t}`,children:e.title},t)))}),(0,V.jsxs)(O.A.Caption,{children:[c.description&&(0,V.jsx)(be.A,{as:"p",children:c.description}),i?(0,V.jsx)(yt.o,{markdownParser:i,sanitizer:a,text:`\`\`\`${s}\n${c.code}\`\`\``}):(0,V.jsx)("code",{children:c.code})]})]})})})}var _t=n(10194);function vt(e){const{logIn:t,markdownParser:n,model:s,preference:r,sanitizer:i,serviceManager:a,sessionContext:o,translator:c}=e,{token:d}=(0,le.Y)(),[h,u]=(0,D.useState)(!1),[p,m]=(0,D.useState)(!1),[g,y]=(0,D.useState)(!1),[f,_]=(0,D.useState)(!1),[v,x]=(0,D.useState)(""),[b,w]=(0,D.useState)([]),[j,k]=(0,D.useState)(!1),C=(0,D.useMemo)((()=>(c??l.wK).load("jupyterlab")),[c]);(0,D.useEffect)((()=>{const e=e=>{const t=(e.getMetadata("datalayer")??{}).kernel;u(!!t),m(!1===t?.params?.notebook);const n=new Array;if(t){const e=a.remote?.environments.get().find((e=>e.name===t.name));x(e?.language??""),e?.snippets&&n.push(...e.snippets)}w(n)};return e(s),s.metadataChanged.connect(e),()=>{s.metadataChanged.disconnect(e)}}),[s]);const S=(0,D.useCallback)((e=>!!e.id&&ee(e.location)&&(!r?.language||e.language===r?.language)),[r]),A=(0,D.useCallback)((e=>{const t=s.getMetadata("datalayer")??{kernel:null};null===e?(delete t.kernel,s.setMetadata("datalayer",t)):s.setMetadata("datalayer",Object.assign(t,{kernel:e}))}),[s]),R=(0,D.useCallback)((()=>{_(!1)}),[]),M=(0,D.useCallback)((()=>{_(!0)}),[]),E=(0,D.useCallback)((()=>{k(!1)}),[]),P=(0,D.useCallback)((()=>{k(!0)}),[]),N=(0,D.useCallback)((()=>{y(!0)}),[]),T=(0,D.useCallback)((e=>{e&&(e.params={...e.params,notebook:!1},A(e)),y(!1)}),[A]),F=s.getMetadata("datalayer")??{};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Ce,{filterKernel:S,preference:r,serviceManager:a,selection:F.kernel?F.kernel:null,setSelection:A,variant:"cell",preActions:(0,V.jsxs)(ne.l.Item,{disabled:!a.remote,onSelect:N,selected:p,title:a.remote?"Assign a new temporary kernel on each cell run.":"You are not connected with Datalayer.",children:[(0,V.jsx)(ne.l.LeadingVisual,{children:(0,V.jsx)(we.A,{})}),C.__("Assign a Cell Kernel")]}),postActions:d||!t?(0,V.jsxs)(V.Fragment,{children:[X.supports(r?.language??"")&&(0,V.jsx)(ne.l.Item,{onSelect:M,disabled:!h,title:C.__("Define variables to transfer between the document kernel and the cell kernel."),children:C.__("Define Cell Variables Transfer")}),(0,V.jsx)(ne.l.Item,{onSelect:P,disabled:0===b.length,title:C.__("Inject a code snippet at the end of the cell."),children:C.__("Inject Code Snippet")})]}):(0,V.jsx)(ne.l.Item,{onSelect:e.logIn,title:"Connect to the Runtime provider.",children:(0,V.jsx)(ue,{message:"Connect to the Runtime provider"})}),translator:c}),f&&(0,V.jsx)(rt,{model:s,onClose:R,preference:r,sessionContext:o,translator:c}),j&&(0,V.jsx)(ft,{language:v,model:s,snippets:b,onClose:E,markdownParser:n,sanitizer:i}),g&&(0,V.jsx)(_t.s,{manager:a.remote,onSubmit:T,startKernel:!1,markdownParser:n,sanitizer:i})]})}var xt=n(94064),bt=n(77544),wt=n(35264),jt=n(77059),kt=n(63806),Ct=n(80547),St=n(55881),At=n(94247);function Rt(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Mt=new WeakMap;class Et{static getRemoteCell(e){return Mt.get(e)}static run(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=Pt.getState(e),i=Pt.runSelected(e,t,n,s);return Pt.handleRunState(e,r,!1),i}static runCells(e,t,n,s,r){if(!e.model)return Promise.resolve(!1);const i=Pt.getState(e),a=Pt.runCells(e,t,n,s,r);return Pt.handleRunState(e,i,!1),a}static runAll(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=Pt.getState(e),i=e.widgets.length,a=Pt.runCells(e,e.widgets,t,n,s);return e.activeCellIndex=i,e.deselectAll(),Pt.handleRunState(e,r,!0),a}static runAllAbove(e,t,n,s){const{activeCell:r,activeCellIndex:i,model:a}=e;if(!a||!r||i<1)return Promise.resolve(!1);const o=Pt.getState(e),l=Pt.runCells(e,e.widgets.slice(0,e.activeCellIndex),t,n,s);return e.deselectAll(),Pt.handleRunState(e,o,!0),l}static runAllBelow(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=Pt.getState(e),i=e.widgets.length,a=Pt.runCells(e,e.widgets.slice(e.activeCellIndex),t,n,s);return e.activeCellIndex=i,e.deselectAll(),Pt.handleRunState(e,r,!0),a}static async runAndAdvance(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=Pt.getState(e),a=Pt.runSelected(e,t,n,s),o=e.model;return e.activeCellIndex===e.widgets.length-1?(o.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===e.activeCell?.inViewport&&await(0,i.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"):e.activeCellIndex++,Pt.handleRunState(e,r,!0),a}static async runAndInsert(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=Pt.getState(e),a=Pt.runSelected(e,t,n,s);return e.model.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===e.activeCell?.inViewport&&await(0,i.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",Pt.handleRunState(e,r,!0),a}}Rt(Et,"serviceManager",null);let Pt,Nt=function(e){return e[e.QUEUED=0]="QUEUED",e[e.STARTING_KERNEL=1]="STARTING_KERNEL",e[e.IMPORTING=2]="IMPORTING",e[e.EXECUTING=3]="EXECUTING",e[e.EXPORTING=4]="EXPORTING",e[e.UNKNOWN=5]="UNKNOWN",e[e.DONE=6]="DONE",e[e.ERROR=7]="ERROR",e}({});class Dt{constructor({cell:e,sessionContext:t,metadata:n}){Rt(this,"cell",void 0),Rt(this,"sessionContext",void 0),Rt(this,"metadata",void 0),this.cell=e,this.sessionContext=t,this.metadata=n}get connection(){return this.sessionContext?.session?.kernel??void 0}failedExecution(e){this.cell.setPrompt("")}cancelExecution(){this.cell.setPrompt("")}scheduleExecution(){this.cell.model.sharedModel.transact((()=>{this.cell.model.clearExecution()}),!1),this.cell.model.sharedModel.getSource().trim()&&this.cell.setPrompt("*")}processCell(){return Promise.resolve(!1)}}class Tt extends Dt{constructor(e){super(e),Rt(this,"_connection",void 0),Rt(this,"_reason",null),Rt(this,"_isDisposed",!1),Rt(this,"_kernelSpec",void 0),Rt(this,"_processed",null),Rt(this,"_state",Nt.QUEUED),Rt(this,"_stateChanged",new k.Signal(this)),Rt(this,"_variablesIn",void 0),Rt(this,"_variableOut",void 0);const t=this.cell.model.getMetadata("datalayer")??{};this._kernelSpec=t.kernel,this._variablesIn=Array.isArray(t.in)?t.in:[],this._variableOut="string"==typeof t.out?t.out:""}get connection(){return this._connection}get isDisposed(){return this._isDisposed}get reason(){return this._reason}get state(){return this._state}setState(e,t){this._state===e&&this._reason===t||(this._reason=t??null,this._state=e,this._stateChanged.emit(this._state))}get stateChanged(){return this._stateChanged}failedExecution(e){super.failedExecution(),this.setState(Nt.ERROR,e)}cancelExecution(){super.cancelExecution(),this.setState(Nt.ERROR)}scheduleExecution(){super.scheduleExecution(),this.setState(Nt.QUEUED)}dispose(){this._isDisposed||(this._isDisposed=!0,this._connection?.dispose(),k.Signal.clearData(this))}async processCell(){let e;await this.setupKernel();try{this._processed=new b.PromiseDelegate,this._processCell().then((e=>{this._processed?.resolve(e)})).catch((e=>{this._processed?.reject(e)})),e=await this._processed.promise}finally{await this.teardownKernel()}return e}async _processCell(){if(!this._connection){const e=`Failed to process a remote cell '${this.cell.model.id}'.`;throw this.setState(Nt.ERROR,e),new Error(e)}if(this._variablesIn.length){if(!this.sessionContext){const e="Unable to import variables; no document kernel available.";throw this.setState(Nt.ERROR,e),new Error(e)}this.setState(Nt.IMPORTING);const e=this.sessionContext.specsManager.specs.kernelspecs[this.sessionContext.session.kernel.model.name];if(!await Ft(e.language,this.sessionContext.session.kernel,this._variablesIn,this._connection)){const e=`Failed to transfer ${this._variablesIn.join(", ")} to ${this._connection.location} - ${this._connection.name} (${this._connection.id})`;throw this.setState(Nt.ERROR,e),new Error(e)}}this.setState(Nt.EXECUTING);const e=await St.Yr.execute(this.cell,{session:{kernel:this._connection}},this.metadata);if(console.debug(`@datalayer/jupyter-kernels: Capture cell ${this.cell.model.id} execution`,e),this.metadata.deletedCells&&(this.metadata.deletedCells.length=0),!e)return!1;if("ok"===e.content.status){if(this._variableOut){if(!this.sessionContext){const e="Unable to export variables; no document kernel available.";throw this.setState(Nt.ERROR,e),new Error(e)}this.setState(Nt.EXPORTING);const e=this.sessionContext.specsManager.specs.kernelspecs[this.sessionContext.session.kernel.model.name];if(!await Ft(e.language,this._connection,[this._variableOut],this.sessionContext.session.kernel)){const e=`Failed to transfer ${this._variableOut} from ${this._connection.location} - ${this._connection.name} (${this._connection.id})`;throw this.setState(Nt.ERROR,e),new Error(e)}}return this.setState(Nt.DONE),!0}throw this.setState(Nt.ERROR),new ut.i(e.content)}async setupKernel(){if(!Et.serviceManager){const e="No service manager available";throw this.setState(Nt.ERROR,e),new Error(e)}this.setState(Nt.STARTING_KERNEL),this._connection&&(this._connection.id===this._kernelSpec.id&&this._connection.name===this._kernelSpec.name&&(this._connection.location??"local")===kernelDescription.location||this._connection.dispose(),this._connection.isDisposed&&(this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0));const e=!1!==this._kernelSpec.params?.notebook;switch(this._connection?.status){case"idle":case"busy":case"autorestarting":case"restarting":case"starting":break;default:{this._connection?.dispose(),this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0;const t=ee(this._kernelSpec.location)?Et.serviceManager.remote?.kernels:Et.serviceManager[this._kernelSpec.location]?.kernels;if(e&&this._kernelSpec.id)try{this._connection=t?.connectTo({model:{id:this._kernelSpec.id,name:this._kernelSpec.name},handleComms:!0})}catch(e){if(!e||"Unable to find the kernel."!==e.message)throw e;console.log(`Persistent kernel ${this._kernelSpec.id} does not exist. Starting a new one...`)}if(!this._connection)try{const{credits:n}=le.J7.getState(),{configuration:s,remoteKernels:r}=Re.iP.getState(),i=(n?.available??0)/Math.max(s.maxCellKernels-r.filter((e=>"cell"===e.kernel_type)).length,1);if(i<3)throw new Error("You do not have enough credits to start a Cell Remote Runtime.");this._connection=await(t?.startNew({name:this._kernelSpec.name,kernelType:e?"notebook":"cell",creditsLimit:i,capabilities:this._kernelSpec.params?.capabilities},{handleComms:!0}))}catch(t){if(503===t.response?.status)(0,E.f1)("Unable to create a new remote kernel",`No kernel available for environment '${this._kernelSpec.name}' sets for cell '${this.cell.model.id}' of notebook '${this.sessionContext?.path??"unknown"}'. Please try again later.`);else if("MaxKernelsError"===t.name){if(!e){const e=new b.PromiseDelegate,t=window.setTimeout((()=>{e.reject("Timeout")}),3e5),n=Re.iP.subscribe((t=>{t.remoteKernels.filter((e=>"cell"===e.kernel_type)).length<t.configuration.maxCellKernels&&e.resolve()}));try{return this.setState(Nt.STARTING_KERNEL,"Waiting for a cell kernel to stopâ€¦"),await e.promise,clearTimeout(t),this.setupKernel()}catch(e){console.log("Waiting for free kernel slot expired.")}finally{n()}}(0,E.f1)("Unable to create a new remote kernel",`${t.message} Cell '${this.cell.model.id}' of notebook '${this.sessionContext?.path??"unknown"}' cannot be executed.`)}else 404===t.response?.status&&(0,E.f1)("Unable to create a new remote kernel",`Unknown environment '${this._kernelSpec.name}' sets for cell '${this.cell.model.id}' of notebook '${this.sessionContext?.path??"unknown"}'. Please select an existing environment.`);throw this.setState(Nt.ERROR,"string"==typeof t?t:t.message??"Unable to start a kernel"),t}this._connection&&(this._connection?.connectionStatusChanged.connect(this.onConnectionChanged,this),this._connection?.statusChanged.connect(this.onKernelStatusChanged,this),this._connection.location=this._kernelSpec.location,e&&(this._kernelSpec.id=this._connection.id,this.cell.model.setMetadata("datalayer",Object.assign(this.cell.model.getMetadata("datalayer")??{},{kernel:this._kernelSpec}))))}}if(!this._connection){const e=`Unable to start a kernel for cell ${this.cell.model.id} with ${JSON.stringify(this._kernelSpec)}`;throw this.setState(Nt.ERROR,e),new Error(e)}}async teardownKernel(){!1===this._kernelSpec.params?.notebook&&(this._connection&&!this._connection.isDisposed&&(ee(this._kernelSpec.location)?Et.serviceManager.remote.kernels.shutdown(this._connection.id):this._connection.shutdown(),this._connection.dispose()),this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0)}onConnectionChanged(){"disconnected"===this._connection?.connectionStatus&&this._processed?.reject("Kernel has been disconnected")}onKernelStatusChanged(){["dead","terminating"].includes(this._connection?.status??"")&&this._processed?.reject(`Kernel status '${this._connection?.status}' is not appropriate`)}}async function Ft(e,t,n,s){const r=new X(e),i=r.saveVariables(n),a=await new M.D({connection:t}).execute(i),o=a.get(0)?.data["text/plain"]??"";if(!o)return!1;{const e=r.loadVariables(o),t=await new M.D({connection:s}).execute(e),i=t.get(0)?.data["text/plain"]||"[]",a=JSON.parse(i.slice(1,i.length-1));if(!n.every((e=>a.includes(e))))return!1;console.debug(`Successfully transfered ${n.join(", ")}`)}return!0}function Lt(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){const t=ut.F.executed,n=ut.F.executionScheduled,s=ut.F.selectionExecuted;async function r(e,r,o,c,d){const h=r[-1];e.mode="command";try{const u=await Promise.all(r.map((s=>async function(e,s,r,o,c){const d=await async function({notebook:e,cell:s,sessionContext:r}){if("code"!==s.model.type)return!1;const o={deletedCells:e.model?.deletedCells??[],recordTiming:e.notebookConfig.recordTiming},l=!!(s.model.getMetadata("datalayer")??{}).kernel,c=new(l?Tt:Dt)({cell:s,sessionContext:r,metadata:o});if(l){Mt.set(s.model,c);const e=()=>{Mt.delete(s.model),c.dispose()};s.disposed.connect(e),r?.disposed.connect(e)}return async function(e,s){const r=new b.PromiseDelegate;i.has(e)||i.set(e,[]);const o=i.get(e),l=0===o.length;return n.emit({notebook:e,cell:s.cell}),s.scheduleExecution(),o.push({cell:s,done:r}),l&&a(o).catch((e=>{console.error("Fail to start processing the cell queue",e)})),r.promise.then((()=>{t.emit({notebook:e,cell:s.cell,success:!0})})).catch((n=>{t.emit({notebook:e,cell:s.cell,success:!1,error:n})})),r.promise}(e,c)}({notebook:e,cell:s,sessionContext:r});if(d)return!0;const h=(c=c||l.wK).load("jupyterlab");switch(s.model.type){case"markdown":s.rendered=!0,s.inputHidden=!1,t.emit({notebook:e,cell:s,success:!0});break;case"code":if(r){if(r.isTerminating){await(0,E.ui)({title:h.__("Kernel Terminating"),body:h.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",r.session?.path),buttons:[E.lG.okButton()]});break}if(r.pendingInput)return await(0,E.ui)({title:h.__("Cell not executed due to pending input"),body:h.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[E.lG.okButton()]}),!1;if(r.hasNoKernel&&await r.startKernel()&&o&&await o.selectKernel(r),r.hasNoKernel)return s.model.sharedModel.transact((()=>{s.model.clearExecution()})),!0;const i=e.model?.deletedCells??[];n.emit({notebook:e,cell:s});let a=!1;try{const t={deletedCells:i,recordTiming:e.notebookConfig.recordTiming};console.debug(`@datalayer/jupyter-kernels: Process normally cell ${s.model.id}`);const n=s.model.sharedModel.source;if((0,At.ZP)(s)){const e=s.model.getMetadata("datalayer").datasource,t=e.variant??"",r=e.database??"",i=e.outputBucket??"",a=e.destinationVar??"";s.model.sharedModel.setSource(`%%${t} ${r} ${i} ${a}\n\n${n}`),s.model.sharedModel.setMetadata("editable",!1)}const o=await St.Yr.execute(s,r,t).finally((()=>{(0,At.ZP)(s)&&(s.model.sharedModel.setSource(n),s.model.sharedModel.setMetadata("editable",!0))}))??void 0;i.splice(0,i.length),a=(()=>{if(s.isDisposed)return!1;if(!o)return!0;if("ok"===o.content.status){const t=o.content;return t.payload&&t.payload.length&&function(e,t,n){const s=e.payload?.filter((e=>"set_next_input"===e.source))[0];if(!s)return;const r=s.text;if(s.replace)return void n.model.sharedModel.setSource(r);const i=t.model.sharedModel,a=t.model.cells,o=(0,N.SL)(a,(e=>e===n.model));-1===o?i.insertCell(i.cells.length,{cell_type:"code",source:r,metadata:{trusted:!1}}):i.insertCell(o+1,{cell_type:"code",source:r,metadata:{trusted:!1}})}(t,e,s),!0}throw new ut.i(o.content)})()}catch(n){if(!s.isDisposed&&!n.message.startsWith("Canceled"))throw t.emit({notebook:e,cell:s,success:!1,error:n}),n;a=!1}return a&&t.emit({notebook:e,cell:s,success:!0}),a}s.model.sharedModel.transact((()=>{s.model.clearExecution()}),!1)}return Promise.resolve(!0)}(e,s,o,c,d))));return!e.isDisposed&&(s.emit({notebook:e,lastCell:h}),e.update(),u.every((e=>e)))}catch(t){if(!t.message||!t.message.startsWith("KernelReplyNotOK"))throw t;return r.map((e=>{"code"===e.model.type&&null===e.model.executionCount&&e.setPrompt("")})),s.emit({notebook:e,lastCell:h}),e.update(),!1}}e.getState=function(e){return{wasFocused:e.node.contains(document.activeElement),activeCellId:e.activeCell?.model.id??null}},e.handleRunState=async function(e,t,n=!1){const{activeCell:s,activeCellIndex:r}=e;n&&s&&await e.scrollToItem(r,"smart",0).catch((e=>{})),(t.wasFocused||"edit"===e.mode)&&e.activate()},e.runCells=r,e.runSelected=function(e,t,n,s){e.mode="command";let i=e.activeCellIndex;const a=e.widgets.filter(((t,n)=>{const s=e.isSelectedOrActive(t);return s&&(i=n),s}));return e.activeCellIndex=i,e.deselectAll(),r(e,a,t,n,s)};const i=new WeakMap;async function a(e){const t=e[0];if(!t)return Promise.resolve();const{done:n,cell:s}=t;try{const t=await s.processCell();n.resolve(t),e.shift(),a(e).catch((e=>{console.error("Error processing cell queue")}))}catch(t){for(s.failedExecution(t.message),n.reject(t),s===e[0]?.cell&&e.shift();e.length;){const{done:t,cell:n}=e.shift()??{};n?.cancelExecution(),t?.reject("Canceled")}}}}(Pt||(Pt={}));class It{constructor(e){Lt(this,"_isDisposed",!1),Lt(this,"_cellFooters",new WeakMap),Lt(this,"_cellResetters",new WeakMap),Lt(this,"_panel",void 0),Lt(this,"_settings",{dateFormat:"yyy-MM-dd HH:mm:ss",showDate:!0,showLiveExecutionTime:!0}),this._panel=e,this._panel.content.model?.cells.changed.connect(this.onCellsChanged,this),this._panel.content.modelChanged.connect((()=>{this._panel.content.model?.cells.changed.connect(this.onCellsChanged,this)})),this._panel.context.sessionContext.statusChanged.connect(this.onKernelStatusChanged,this)}get settings(){return this._settings}set settings(e){b.JSONExt.deepEqual(this._settings,e)||(this._settings=e,this.onCellsChanged(this._panel.context.model.cells,{type:"set",newIndex:0,newValues:Array.from(this._panel.context.model.cells),oldIndex:0,oldValues:Array.from(this._panel.context.model.cells)}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,k.Signal.clearData(this))}onKernelStatusChanged(e,t){["starting","restarting","autorestarting"].includes(t)&&this._panel.content.widgets.forEach((e=>{this._cellResetters.get(e.model)?.emit(void 0)}))}onCellsChanged(e,t){t.oldValues.forEach((e=>{this._removeFooter(e)})),Promise.all(t.newValues.map((e=>this._addFooter(e))))}async _addFooter(e){if("code"===e.type){const t=this._panel.content.widgets.find((t=>t.model===e));if(t){await t.ready;const n=new k.Signal(this),s=T._Q.create((0,V.jsx)($.N,{theme:wt.R,inJupyterLab:!0,children:(0,V.jsx)($t,{model:e,stateReset:n})}));this._cellFooters.has(e)&&this._cellFooters.get(e)?.dispose(),this._cellFooters.set(e,t),this._cellResetters.set(e,n);const r=()=>{this._cellFooters.delete(e),this._cellFooters.delete(e),s.dispose()};t.disposed.connect(r),this._panel.disposed.disconnect(r),F.x0.attach(s,t.inputArea.editorWidget.node)}}}_removeFooter(e){this._cellFooters.get(e)?.dispose()}}const Ot=(e,t="yyy-MM-dd HH:mm:ss")=>(0,kt.A)(e,t),Kt=(e,t)=>{const n=36e5,s=864e5;let r=(0,Ct.A)(e,t);if(r<1e3)return`${r}ms`;const i=Math.floor(r/s);r%=s;const a=Math.floor(r/n);r%=n;const o=Math.floor(r/6e4);r%=6e4;let l="";return i&&(l+=`${i}d `),(i||a)&&(l+=`${a}h `),(i||a||o)&&(l+=`${o}m `),i||(l+=`${(r/1e3).toFixed(a?0:2)}s`),l.trim()};class Ut{constructor(e,t){Lt(this,"_tracker",void 0),Lt(this,"_extensions",new WeakMap),Lt(this,"_settings",{showLiveExecutionTime:!0,showDate:!0,dateFormat:"yyy-MM-dd HH:mm:ss"}),this._tracker=e,t.load("@datalayer/jupyter-kernels:plugin").then((e=>{this._updateSettings(e),e.changed.connect(this._updateSettings.bind(this)),t.load("@jupyterlab/notebook-extension:tracker").then((e=>e.set("recordTiming",!0)),(e=>{console.error("@datalayer/jupyter-kernels: Could not force metadata recording.",e)}))})).catch((e=>{console.error("@datalayer/jupyter-kernels: Could not load settings",e)}))}createNew(e,t){const n=new It(e);return this._extensions.set(e,n),e.disposed.connect((()=>{this._extensions.delete(e)})),n}_updateSettings(e){const t={showLiveExecutionTime:e.get("showLiveExecutionTime").composite,showDate:e.get("showDate").composite},n=e.get("dateFormat").composite,s=(e=>{const t=new Date;try{return(0,kt.A)(t,e),{isValid:!0}}catch(e){return{isValid:!1,message:e.message}}})(n);s.isValid?t.dateFormat=n:(t.dateFormat="yyy-MM-dd HH:mm:ss",(0,E.f1)("Invalid date format in Execute Time extension setting",s.message??"")),this._settings={...this._settings,...t},this._tracker.forEach((e=>{const t=this._extensions.get(e);t&&(t.settings={...this._settings})}))}}function $t(e){const{model:t,stateReset:n}=e,{enqueueToast:s}=(0,de.d)(),[r,i]=(0,D.useState)(""),[a,o]=(0,D.useState)(""),[l,c]=(0,D.useState)(null),[d,h]=(0,D.useState)(""),[u,p]=(0,D.useState)(""),[m,g]=(0,D.useState)(""),[y,f]=(0,D.useState)(Et.getRemoteCell(t)??null),[_,v]=(0,D.useState)(Nt.UNKNOWN),[x,w]=(0,D.useState)("");(0,D.useEffect)((()=>{const e=()=>{v(Nt.UNKNOWN),w(""),f(null)};return n.connect(e),()=>{n.disconnect(e)}}),[n]),(0,D.useEffect)((()=>{const e=()=>{const n=t.getMetadata("datalayer")?.kernel;let s="",r="";if(n){let e=je.A;switch(s=n.displayName??"Unknown kernel",r=`${s} running `,n.location){case"local":r+="locally.";break;case"browser":e=ke.A,r+="in your browser.";break;default:!1===n.params?.notebook?(e=xt.A,r+="remotely."):(e=bt.A,r+="in a Notebook Remote Runtime.")}c(e?(0,D.createElement)(e,{title:n.location}):null),i(s),o(r)}else c(null),i(""),o("");const a=t.getMetadata("execution");if(!a||!b.JSONExt.isObject(a))return d&&h(""),u&&p(""),void(m&&g(""));const l=a["iopub.status.busy"],y=l?new Date(l):null,f=a["shell.execute_reply.started"]||a["iopub.execute_input"],_=f?new Date(f):null,v=a.execution_failed,x=a["shell.execute_reply"]??v,w=x?new Date(x):null,j=x&&!a["iopub.execute_input"],k=setInterval((()=>{if(d.startsWith("Execution started at")){if(t.getMetadata("execution").execution_failed)return clearInterval(k),void e();if(_){const e=Kt(new Date,_);p(`${e} ${m?`(${m})`:""}`)}}else clearInterval(k)}),100);let C="";if(j)C="";else if(w&&_){const e=Kt(w,_);g(e),C=v?"Failed":"Last executed",C&&(C+=` at ${Ot(w,"yyy-MM-dd HH:mm:ss")}`),C+=` in ${e}`}else _?C=`Execution started at ${Ot(_,"yyy-MM-dd HH:mm:ss")}`:y&&(m&&p(`N/A (${m})`),C=`Execution queued at ${Ot(y,"yyy-MM-dd HH:mm:ss")}`);d!==C&&h(C)},n=(e,{notebook:n,cell:s})=>{if(s.model===t){const e=Et.getRemoteCell(t)??null;v(e?.state??Nt.QUEUED),w(e?.state?"":"Queued"),f(e)}},r=(e,{notebook:n,cell:r,success:i,error:a})=>{if(r.model!==t)return;const o=i?Nt.DONE:Nt.ERROR;v(y?.state??o),w(y?.reason??""),y?.state===Nt.ERROR&&s(y.reason??"Failed to execute cell on a remote kernel.",{variant:"error"})};return e(),t.metadataChanged.connect(e),"code"===t.type&&(ut.F.executionScheduled.connect(n),ut.F.executed.connect(r)),()=>{t.metadataChanged.disconnect(e),"code"===t.type&&(ut.F.executionScheduled.disconnect(n),ut.F.executed.disconnect(r))}}),[t,y]),(0,D.useEffect)((()=>{const e=(e,t)=>{switch(v(t),t){case Nt.QUEUED:w("Queued");break;case Nt.ERROR:w(e.reason??"");break;case Nt.EXECUTING:w("Runningâ€¦");break;case Nt.EXPORTING:w("Exporting dataâ€¦");break;case Nt.IMPORTING:w("Importing dataâ€¦");break;case Nt.STARTING_KERNEL:w(e.reason??"Starting the kernelâ€¦");break;default:w("")}};return y?.stateChanged.connect(e),()=>{y?.stateChanged.disconnect(e)}}),[y]);const j=!!l;let k=!1,C=100,S=j?"var(--jp-brand-color1)":"var(--jp-brand-color3)",A="var(--jp-brand-color1)",R="";switch(_){case Nt.QUEUED:R="ðŸ’¤ï¸Ž",C=0;break;case Nt.UNKNOWN:C=0;break;case Nt.DONE:R="âœ”ï¸Ž",S=j?"var(--jp-success-color1)":"var(--jp-success-color3)",A="var(--jp-success-color1)";break;case Nt.ERROR:R="âŒï¸Ž",S=j?"var(--jp-error-color1)":"var(--jp-error-color3)",A="var(--jp-error-color1)";break;case Nt.EXECUTING:R="âš¡ï¸Ž",k=!0,C=40;break;case Nt.EXPORTING:R="ðŸ“¤ï¸Ž",k=!0,C=90;break;case Nt.IMPORTING:R="ðŸ“¥ï¸Ž",k=!0,C=30;break;case Nt.STARTING_KERNEL:R="ðŸ”¥ï¸Ž",k=!0,C=20}const M=["dla-cell-footer"];return j&&M.push("jp-mod-foreign"),(0,V.jsxs)("div",{className:M.join(" "),children:[(0,V.jsx)("div",{style:{minHeight:"3px"},children:_!==Nt.UNKNOWN&&(0,V.jsx)(jt.z,{sx:{maxHeight:"3px"},progress:C,bg:S,animated:k,barSize:"small"})}),(0,V.jsxs)("div",{children:[(0,V.jsx)("span",{style:{color:A},title:x||void 0,children:`${R} ${x}`.trimEnd()}),(0,V.jsx)("span",{children:t.getMetadata("execution")&&(0,V.jsx)(V.Fragment,{children:d})}),(0,V.jsxs)("span",{className:"dla-cell-footer-kernel",title:a,children:[l,r]})]})]})}const Vt={id:"@datalayer/jupyter-kernels:cell-executor",description:"Handle kernel per cells.",requires:[Te,ht.fI],optional:[dt.qe,l.sQ,pt.co,dt.zG],autoStart:!1,activate:(e,t,n,s,r,i,a)=>{Et.serviceManager=t,ut.F.run=Et.run,ut.F.runAll=Et.runAll,ut.F.runAllAbove=Et.runAllAbove,ut.F.runAllBelow=Et.runAllBelow,ut.F.runAndAdvance=Et.runAndAdvance,ut.F.runAndInsert=Et.runAndInsert,ut.F.runCells=Et.runCells,s?.addFactory("Cell","dla-kernel-picker",(s=>{const o=n.find((e=>!(!e.model||!Array.from(e.model.cells).find((e=>e===s.model)))));return"code"!==s.model.type?new F.x0:T._Q.create((0,V.jsxs)($.N,{baseStyles:{backgroundColor:"transparent"},inJupyterLab:!0,children:[(0,V.jsx)(at,{model:s.model,preference:o?.sessionContext?{id:o.sessionContext.session?.kernel?.id,language:o.sessionContext.specsManager.specs?.kernelspecs[o.sessionContext.session?.kernel?.name??""]?.language}:void 0,sessionContext:o?.sessionContext}),(0,V.jsx)(vt,{logIn:e.commands.hasCommand("@datalayer/jupyter-kernels:create-widget")?()=>e.commands.execute("@datalayer/jupyter-kernels:create-widget"):void 0,markdownParser:i??void 0,sanitizer:a??void 0,model:s.model,preference:o?.sessionContext?{id:o.sessionContext.session?.kernel?.id,language:o.sessionContext.specsManager.specs?.kernelspecs[o.sessionContext.session?.kernel?.name??""]?.language,location:o.sessionContext.location}:void 0,serviceManager:t,sessionContext:o?.sessionContext,translator:r??void 0})]}))}))}},zt={id:"@datalayer/jupyter-kernels:cell-footer",description:"Cell footer with Datalayer kernel information",requires:[ht.fI,mt.X],optional:[l.sQ],autoStart:!1,activate:(e,t,n,s)=>{e.docRegistry.addWidgetExtension("Notebook",new Ut(t,n))}};var qt=n(70900),Wt=n(31906),Jt=n(18738),Ht=n(59651);const Bt="The current kernel will be stopped in less than 5 minutes due to credits exhaustion.",Gt="Kernel stopped due to credits exhaustion.";class Yt extends T._Q{constructor(...e){var t,n,s;super(...e),t=this,s="",(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_message"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s}get message(){return this._message}set message(e){this._message!==e&&(this._message=e,this.update())}render(){return this._message?(0,V.jsx)($.N,{inJupyterLab:!0,children:(0,V.jsxs)(Wt.A,{variant:"warning",children:[(0,V.jsx)(Jt.A,{icon:ie._0O}),(0,V.jsx)(be.A,{children:this.message})]})}):null}}const Qt={id:"@datalayer/jupyter-kernels:credits-indicator",description:"Notebook credits indicator",optional:[l.sQ],requires:[Te,dt.qe],autoStart:!1,activate(e,t,n,s){n.addFactory("Notebook",Qt.id,(n=>{const s=new Yt;s.addClass("dla-notebook-warning-notice"),n.contentHeader.addClass("dla-notebook-content-header"),n.contentHeader.addWidget(s);const r=T._Q.create((0,V.jsx)($.N,{inJupyterLab:!0,children:(0,V.jsx)(qt.mE,{signal:n.sessionContext.kernelChanged,initialArgs:{name:"kernel",newValue:n.sessionContext.session?.kernel??null,oldValue:null},children:(r,i)=>i?.newValue?.id?(s.message="",n.contentHeader.node.style.minHeight="0",n.contentHeader.node.style.height="0",n.fit(),(0,V.jsx)(Ht.m,{kernelId:i.newValue.id,serviceManager:t.remote,onClick:e.commands.hasCommand("@datalayer/jupyter-kernels:create-widget")?()=>{e.commands.execute("@datalayer/jupyter-kernels:create-widget")}:void 0,onUpdate:(e,t)=>{100===e?s.message=Gt:(100-e)*t*10<le.zo&&(s.message=Bt),s.message?n.contentHeader.node.style.minHeight="60px":(n.contentHeader.node.style.minHeight="0",n.contentHeader.node.style.height="0"),n.fit()}})):(null===i?.newValue&&i?.oldValue?.id&&s.message===Bt&&(s.message=Gt,n.contentHeader.node.style.minHeight="60px",n.fit()),null)})}));return r.node.title="Runtime credits",r.addClass("dla-toolbar-credits-indicator"),r}))}};var Xt=n(71752),Zt=n(37461),en=n(43602),tn=n(64761),nn=n(62759),sn=n(80955),rn=n(16255),an=n(41665),on=n(62863),ln=n(60872),cn=n(72879),dn=n(15503),hn=n(80578),un=n(39203),pn=n(45427),mn=n(53054);function gn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class yn{constructor(e){gn(this,"sessionContext",void 0),gn(this,"urlResolver",void 0),gn(this,"translator",void 0),gn(this,"_isReady",!1),gn(this,"_isDisposed",!1),gn(this,"_isPopulated",!1),gn(this,"_trans",void 0),gn(this,"_manager",void 0),gn(this,"_opener",void 0),gn(this,"_model",void 0),gn(this,"_path",""),gn(this,"_lineEnding",null),gn(this,"_factory",void 0),gn(this,"_contentsModel",null),gn(this,"_readyPromise",void 0),gn(this,"_populatedPromise",new b.PromiseDelegate),gn(this,"_pathChanged",new k.Signal(this)),gn(this,"_fileChanged",new k.Signal(this)),gn(this,"_saveState",new k.Signal(this)),gn(this,"_disposed",new k.Signal(this)),gn(this,"_dialogs",void 0),gn(this,"_lastModifiedCheckMargin",500),gn(this,"_conflictModalIsOpen",!1);const t=this._manager=e.manager;this.translator=e.translator||l.wK,this._trans=this.translator.load("jupyterlab"),this._factory=e.factory,this._dialogs=e.sessionDialogs??new hn.V({translator:e.translator}),this._opener=e.opener||fn.noOp,this._path=this._manager.contents.normalize(e.path),this._lastModifiedCheckMargin=e.lastModifiedCheckMargin||500;const n=this._manager.contents.localPath(this._path),s=this._factory.preferredLanguage(i.PathExt.basename(n)),r=this._manager.contents.getSharedModelFactory(this._path),a=r?.createNew({path:n,format:this._factory.fileFormat,contentType:this._factory.contentType,collaborative:this._factory.collaborative});this._model=this._factory.createNew({languagePreference:s,sharedModel:a,collaborationEnabled:r?.collaborative??!1}),this._readyPromise=t.ready.then((()=>this._populatedPromise.promise));const o=i.PathExt.extname(this._path);this.sessionContext=new Pe({sessionManager:t.sessions,specsManager:t.kernelspecs,path:n,type:".ipynb"===o?"notebook":"file",name:i.PathExt.basename(n),kernelPreference:e.kernelPreference||{shouldStart:!1},setBusy:e.setBusy},t),this.sessionContext.propertyChanged.connect(this._onSessionChanged,this),t.contents.fileChanged.connect(this._onFileChanged,this),this.urlResolver=new mn.K.UrlResolver({path:this._path,contents:t.contents})}get pathChanged(){return this._pathChanged}get fileChanged(){return this._fileChanged}get saveState(){return this._saveState}get disposed(){return this._disposed}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){this._lastModifiedCheckMargin=e}get model(){return this._model}get path(){return this._path}get localPath(){return this._manager.contents.localPath(this._path)}get contentsModel(){return this._contentsModel?{...this._contentsModel}:null}get factoryName(){return this.isDisposed?"":this._factory.name}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.sessionContext.dispose(),this._model.dispose(),this._model.sharedModel.dispose(),this._disposed.emit(void 0),k.Signal.clearData(this))}get isReady(){return this._isReady}get ready(){return this._readyPromise}get canSave(){return!(!this._contentsModel?.writable||this._model.collaborative)}async initialize(e){e?await this._save():await this._revert(),this.model.sharedModel.clearUndoHistory()}rename(e){return this.ready.then((()=>this._manager.ready.then((()=>this._rename(e)))))}async save(){await this.ready,await this._save()}async saveAs(){await this.ready;const e=this._manager.contents.localPath(this.path),t=await fn.getSavePath(e);if(this.isDisposed||!t)return;const n=this._manager.contents.driveName(this.path),s=""===n?t:`${n}:${t}`;if(s===this._path)return this.save();try{await this._manager.ready,await this._manager.contents.get(s),await this._maybeOverWrite(s)}catch(e){if(!e.response||404!==e.response.status)throw e;await this._finishSaveAs(s)}}async download(){const e=await this._manager.contents.getDownloadUrl(this._path),t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}async revert(){await this.ready,await this._revert()}createCheckpoint(){const e=this._manager.contents;return this._manager.ready.then((()=>e.createCheckpoint(this._path)))}deleteCheckpoint(e){const t=this._manager.contents;return this._manager.ready.then((()=>t.deleteCheckpoint(this._path,e)))}restoreCheckpoint(e){const t=this._manager.contents,n=this._path;return this._manager.ready.then((()=>e?t.restoreCheckpoint(n,e):this.listCheckpoints().then((s=>{if(!this.isDisposed&&s.length)return e=s[s.length-1].id,t.restoreCheckpoint(n,e)}))))}listCheckpoints(){const e=this._manager.contents;return this._manager.ready.then((()=>e.listCheckpoints(this._path)))}addSibling(e,t={}){const n=this._opener;return n&&n(e,t),new w.DisposableDelegate((()=>{e.close()}))}_onFileChanged(e,t){if("rename"!==t.type)return;let n=t.oldValue&&t.oldValue.path,s=t.newValue&&t.newValue.path;if(s&&0===this._path.indexOf(n||"")){let e=t.newValue;n!==this._path&&(s=this._path.replace(new RegExp(`^${n}/`),`${s}/`),n=this._path,e={last_modified:t.newValue?.created,path:s}),this._updateContentsModel({...this._contentsModel,...e}),this._updatePath(s)}}_onSessionChanged(e,t){if("path"!==t)return;const n=this._manager.contents.driveName(this.path);let s=this.sessionContext.session.path;n&&(s=`${n}:${s}`),this._updatePath(s)}_updateContentsModel(e){const t=e.writable&&!this._model.collaborative,n={path:e.path,name:e.name,type:e.type,writable:t,created:e.created,last_modified:e.last_modified,mimetype:e.mimetype,format:e.format,hash:e.hash,hash_algorithm:e.hash_algorithm},s=this._contentsModel?.last_modified??null,r=this._contentsModel?.hash??null;this._contentsModel=n,(!s&&!r||!r&&n.last_modified!==s||r&&n.hash!==r)&&this._fileChanged.emit(n)}_updatePath(e){if(this._path===e)return;this._path=e;const t=this._manager.contents.localPath(e),n=i.PathExt.basename(t);if(this.sessionContext.session?.path!==t&&this.sessionContext.session?.setPath(t),this.sessionContext.session?.name!==n&&this.sessionContext.session?.setName(n),this.urlResolver.path!==e&&(this.urlResolver.path=e),this._contentsModel&&(this._contentsModel.path!==e||this._contentsModel.name!==n)){const t={...this._contentsModel,name:n,path:e};this._updateContentsModel(t)}this._pathChanged.emit(e)}async _populate(){if(this._isPopulated=!0,this._isReady=!0,this._populatedPromise.resolve(void 0),await this._maybeCheckpoint(!1),this.isDisposed)return;const e=this._model.defaultKernelName||this.sessionContext.kernelPreference.name;this.sessionContext.kernelPreference={...this.sessionContext.kernelPreference,name:e,language:this._model.defaultKernelLanguage},this.sessionContext.initialize().then((e=>{e&&this._dialogs.selectKernel(this.sessionContext)}))}async _rename(e){const t=this.localPath.split("/");t[t.length-1]=e;let n=i.PathExt.join(...t);const s=this._manager.contents.driveName(this.path);s&&(n=`${s}:${n}`),await this._manager.contents.rename(this.path,n)}async _save(){this._saveState.emit("started");const e=this._createSaveOptions();try{await this._manager.ready;const t=await this._maybeSave(e);if(this.isDisposed)return;this._model.dirty=!1,this._updateContentsModel(t),this._isPopulated||await this._populate(),this._saveState.emit("completed")}catch(e){const{name:t}=e;if("ModalCancelError"===t||"ModalDuplicateError"===t)throw e;const n=this._manager.contents.localPath(this._path),s=i.PathExt.basename(n);throw this._handleError(e,this._trans.__("File Save Error for %1",s)),this._saveState.emit("failed"),e}}_revert(e=!1){const t={type:this._factory.contentType,content:null!==this._factory.fileFormat,hash:null!==this._factory.fileFormat?1:0,...null!==this._factory.fileFormat?{format:this._factory.fileFormat}:{}},n=this._path,s=this._model;return this._manager.ready.then((()=>this._manager.contents.get(n,t))).then((e=>{if(!this.isDisposed){if(e.content)if("json"===e.format)s.fromJSON(e.content);else{let t=e.content;-1!==t.indexOf("\r\n")?(this._lineEnding="\r\n",t=t.replace(/\r\n/g,"\n")):-1!==t.indexOf("\r")?(this._lineEnding="\r",t=t.replace(/\r/g,"\n")):this._lineEnding=null,s.fromString(t)}return this._updateContentsModel(e),s.dirty=!1,this._isPopulated?void 0:this._populate()}})).catch((async e=>{const t=this._manager.contents.localPath(this._path),n=i.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Load Error for %1",n)),e}))}_maybeSave(e){const t=this._path;return this._manager.contents.get(t,{content:!1,hash:1}).then((n=>{if(this.isDisposed)return Promise.reject(new Error("Disposed"));const s=void 0!==this.contentsModel?.hash&&null!==this.contentsModel?.hash&&void 0!==n.hash&&null!==n.hash,r=this.contentsModel?.hash,i=n.hash;if(s&&r!==i)return console.warn(`Different hash found for ${this.path}`),this._raiseConflict(n,e);const a=this._lastModifiedCheckMargin,o=this.contentsModel?.last_modified,l=o?new Date(o):new Date,c=new Date(n.last_modified);return!s&&o&&c.getTime()-l.getTime()>a?(console.warn(`Last saving performed ${l} while the current file seems to have been saved ${c}`),this._raiseConflict(n,e)):this._manager.contents.save(t,e).then((async e=>{const n=await this._manager.contents.get(t,{content:!1,hash:1});return{...e,hash:n.hash,hash_algorithm:n.hash_algorithm}}))}),(n=>{if(n.response&&404===n.response.status)return this._manager.contents.save(t,e).then((async e=>{const n=await this._manager.contents.get(t,{content:!1,hash:1});return{...e,hash:n.hash,hash_algorithm:n.hash_algorithm}}));throw n}))}async _handleError(e,t){await(0,E.f1)(t,e)}_maybeCheckpoint(e){let t=Promise.resolve(void 0);return this.canSave?(t=e?this.createCheckpoint().then():this.listCheckpoints().then((e=>{if(!this.isDisposed&&!e.length&&this.canSave)return this.createCheckpoint().then()})),t.catch((e=>{if(!e.response||403!==e.response.status)throw e}))):t}_raiseConflict(e,t){if(this._conflictModalIsOpen){const e=new Error("Modal is already displayed");return e.name="ModalDuplicateError",Promise.reject(e)}const n=this._trans.__('"%1" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?',this.path),s=E.lG.okButton({label:this._trans.__("Revert"),actions:["revert"]}),r=E.lG.warnButton({label:this._trans.__("Overwrite"),actions:["overwrite"]});return this._conflictModalIsOpen=!0,(0,E.ui)({title:this._trans.__("File Changed"),body:n,buttons:[E.lG.cancelButton(),s,r]}).then((n=>{if(this._conflictModalIsOpen=!1,this.isDisposed)return Promise.reject(new Error("Disposed"));if(n.button.actions.includes("overwrite"))return this._manager.contents.save(this._path,t);if(n.button.actions.includes("revert"))return this.revert().then((()=>e));const s=new Error("Cancel");return s.name="ModalCancelError",Promise.reject(s)}))}_maybeOverWrite(e){const t=this._trans.__('"%1" already exists. Do you want to replace it?',e),n=E.lG.warnButton({label:this._trans.__("Overwrite"),accept:!0});return(0,E.ui)({title:this._trans.__("File Overwrite?"),body:t,buttons:[E.lG.cancelButton(),n]}).then((t=>this.isDisposed?Promise.reject(new Error("Disposed")):t.button.accept?this._manager.contents.delete(e).then((()=>this._finishSaveAs(e))):void 0))}async _finishSaveAs(e){this._saveState.emit("started");try{await this._manager.ready;const t=this._createSaveOptions();await this._manager.contents.save(e,t),await this._maybeCheckpoint(!0),this._saveState.emit("completed")}catch(e){if("Cancel"===e.message||"Modal is already displayed"===e.message)throw e;const t=this._manager.contents.localPath(this._path),n=i.PathExt.basename(t);return this._handleError(e,this._trans.__("File Save Error for %1",n)),void this._saveState.emit("failed")}}_createSaveOptions(){let e=null;return"json"===this._factory.fileFormat?e=this._model.toJSON():(e=this._model.toString(),this._lineEnding&&(e=e.replace(/\n/g,this._lineEnding))),{type:this._factory.contentType,format:this._factory.fileFormat,content:e}}}let fn,_n;function vn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.getSavePath=function(e,n){const s=(n=n||l.wK).load("jupyterlab"),r=E.lG.okButton({label:s.__("Save"),accept:!0});return(0,E.ui)({title:s.__("Save File Asâ€¦"),body:new t(e),buttons:[E.lG.cancelButton(),r]}).then((e=>{if(e.button.accept)return e.value??void 0}))},e.noOp=function(){};class t extends F.x0{constructor(e){super({node:n(e)})}getValue(){return this.node.value}}function n(e){const t=document.createElement("input");return t.value=e,t}}(fn||(fn={}));class xn{constructor(e){vn(this,"registry",void 0),vn(this,"services",void 0),vn(this,"translator",void 0),vn(this,"_activateRequested",new k.Signal(this)),vn(this,"_contexts",[]),vn(this,"_opener",void 0),vn(this,"_widgetManager",void 0),vn(this,"_isDisposed",!1),vn(this,"_autosave",!0),vn(this,"_autosaveInterval",120),vn(this,"_lastModifiedCheckMargin",500),vn(this,"_renameUntitledFileOnSave",!0),vn(this,"_when",void 0),vn(this,"_setBusy",void 0),vn(this,"_dialogs",void 0),vn(this,"_isConnectedCallback",void 0),vn(this,"_stateChanged",new k.Signal(this)),this.translator=e.translator||l.wK,this.registry=e.registry,this.services=e.manager,this._dialogs=e.sessionDialogs??new hn.V({translator:e.translator}),this._isConnectedCallback=e.isConnectedCallback||(()=>!0),this._opener=e.opener,this._when=e.when||e.manager.ready;const t=new un.p({registry:this.registry,translator:this.translator,recentsManager:e.recentsManager});t.activateRequested.connect(this._onActivateRequested,this),t.stateChanged.connect(this._onWidgetStateChanged,this),this._widgetManager=t,this._setBusy=e.setBusy}get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){if(this._autosave!==e){const t=this._autosave;this._autosave=e,this._contexts.forEach((t=>{const n=_n.saveHandlerProperty.get(t);n&&(!0!==e||n.isActive?!1===e&&n.isActive&&n.stop():n.start())})),this._stateChanged.emit({name:"autosave",oldValue:t,newValue:e})}}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){if(this._autosaveInterval!==e){const t=this._autosaveInterval;this._autosaveInterval=e,this._contexts.forEach((t=>{const n=_n.saveHandlerProperty.get(t);n&&(n.saveInterval=e||120)})),this._stateChanged.emit({name:"autosaveInterval",oldValue:t,newValue:e})}}get confirmClosingDocument(){return this._widgetManager.confirmClosingDocument}set confirmClosingDocument(e){if(this._widgetManager.confirmClosingDocument!==e){const t=this._widgetManager.confirmClosingDocument;this._widgetManager.confirmClosingDocument=e,this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){if(this._lastModifiedCheckMargin!==e){const t=this._lastModifiedCheckMargin;this._lastModifiedCheckMargin=e,this._contexts.forEach((t=>{t.lastModifiedCheckMargin=e})),this._stateChanged.emit({name:"lastModifiedCheckMargin",oldValue:t,newValue:e})}}get renameUntitledFileOnSave(){return this._renameUntitledFileOnSave}set renameUntitledFileOnSave(e){if(this._renameUntitledFileOnSave!==e){const t=this._renameUntitledFileOnSave;this._renameUntitledFileOnSave=e,this._stateChanged.emit({name:"renameUntitledFileOnSave",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,k.Signal.clearData(this),this._contexts.forEach((e=>this._widgetManager.closeWidgets(e))),this._widgetManager.dispose(),this._contexts.length=0)}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map((e=>this._widgetManager.closeWidgets(e)))).then((()=>{}))}closeFile(e){const t=this._contextsForPath(e).map((e=>this._widgetManager.closeWidgets(e)));return Promise.all(t).then((e=>{}))}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",n){return this._createOrOpenDocument("create",e,t,n)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then((()=>this.services.contents.delete(e))).then((()=>(this._contextsForPath(e).forEach((e=>this._widgetManager.deleteWidgets(e))),Promise.resolve(void 0))))}duplicate(e){const t=i.PathExt.dirname(e);return this.services.contents.copy(e,t)}findWidget(e,t="default"){const n=i.PathExt.normalize(e);let s=[t];if("default"===t){const e=this.registry.defaultWidgetFactory(n);if(!e)return;s=[e.name]}else null===t&&(s=this.registry.preferredWidgetFactories(n).map((e=>e.name)));for(const e of this._contextsForPath(n))for(const t of s)if(null!==t){const n=this._widgetManager.findWidget(e,t);if(n)return n}}newUntitled(e){return"file"===e.type&&(e.ext=e.ext||".txt"),this.services.contents.newUntitled(e)}open(e,t="default",n,s){return this._createOrOpenDocument("open",e,t,n,s)}openOrReveal(e,t="default",n,s){const r=this.findWidget(e,t);return r?(this._opener.open(r,{type:t,...s}),r):this.open(e,t,n,s??{})}overwrite(e,t){const n=`${t}.${b.UUID.uuid4()}`,s=()=>this.rename(n,t);return this.rename(e,n).then((()=>this.deleteFile(t))).then(s,s)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const n=this.services.contents.normalize(e);return(0,N.I6)(this._contexts,(e=>e.path===n&&e.factoryName===t))}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter((e=>e.path===t))}_createContext(e,t,n){const s=new yn({opener:(e,t)=>{this._widgetManager.adoptWidget(s,e),this._opener.open(e,t)},manager:this.services,factory:t,path:e,kernelPreference:n,setBusy:this._setBusy,sessionDialogs:this._dialogs,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator}),r=new pn.I({context:s,isConnectedCallback:this._isConnectedCallback,saveInterval:this.autosaveInterval});return _n.saveHandlerProperty.set(s,r),s.ready.then((()=>{this.autosave&&r.start()})),s.disposed.connect(this._onContextDisposed,this),this._contexts.push(s),s}_onContextDisposed(e){N.Rw.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:n}=this;if("default"===t){const s=n.defaultWidgetFactory(e);if(!s)return;t=s.name}return n.getWidgetFactory(t)}_createOrOpenDocument(e,t,n="default",s,r){const i=this._widgetFactoryFor(t,n);if(!i)return;const a=i.modelName||"text",o=this.registry.getModelFactory(a);if(!o)return;const l=this.registry.getKernelPreference(t,i.name,s);let c,d=Promise.resolve(void 0);if("open"===e)c=this._findContext(t,o.name)||null,c||(c=this._createContext(t,o,l),d=this._when.then((()=>c.initialize(!1))));else{if("create"!==e)throw new Error(`Invalid argument 'which': ${e}`);c=this._createContext(t,o,l),d=this._when.then((()=>c.initialize(!0)))}const h=this._widgetManager.createWidget(i,c);return this._opener.open(h,{type:i.name,...r}),d.catch((e=>{console.error(`Failed to initialize the context with '${o.name}' for ${t}`,e),h.close()})),h}_onActivateRequested(e,t){this._activateRequested.emit(t)}_onWidgetStateChanged(e,t){"confirmClosingDocument"===t.name&&this._stateChanged.emit(t)}}(_n||(_n={})).saveHandlerProperty=new dn.AttachedProperty({name:"saveHandler",create:()=>{}});var bn=n(42389),wn=n(46895);function jn(e,t,n){return o.ServerConnection.makeSettings({baseUrl:e,wsUrl:n||e.replace(/^http/,"ws"),token:t,appendToken:!0,init:{mode:"cors",credentials:"include",cache:"no-store"}})}class kn extends Error{constructor(e,t){super(e,t),this.name="MaxKernelsError"}}var Cn=n(10218);function Sn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class An extends o.BaseManager{constructor({serverSettings:e,standby:t}){super({serverSettings:e}),Sn(this,"_changed",new k.Signal(this)),Sn(this,"_connectionFailure",new k.Signal(this)),Sn(this,"_environments",new Array),Sn(this,"_isReady",!1),Sn(this,"_poll",void 0),Sn(this,"_ready",new b.PromiseDelegate),this._poll=new j.Poll({auto:!1,factory:()=>this.refreshEnvironments(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@datalayer/jupyter-kernels:EnvironmentsManager#environments",standby:t??"when-hidden"}),this._ready.promise.then((async()=>{await this._poll.start(),await this._poll.tick,this._isReady=!0})),this.refreshEnvironments().then((()=>{this._ready.resolve()})).catch((e=>{console.error("Failed to fetch the remote environments.",e),this._ready.reject(e)}))}get changed(){return this._changed}get connectionFailure(){return this._connectionFailure}get isReady(){return this._isReady}get ready(){return this._ready.promise}dispose(){this.isDisposed||(this._poll.dispose(),super.dispose())}get(){return[...this._environments]}async refresh(){await this._poll.refresh(),await this._poll.tick}async refreshEnvironments(){try{const e=await(0,Cn.DL)();b.JSONExt.deepEqual(this._environments,e)||(this._environments=e,this._changed.emit([...this._environments]))}catch(e){if(e instanceof o.ServerConnection.ResponseError)throw e;this._connectionFailure.emit(e)}}}class Rn extends Error{constructor(...e){super(...e),Sn(this,"name","KernelUnreachable")}}class Mn{constructor({serverSettings:e,standby:t}){Sn(this,"_connectionFailure",new k.Signal(this)),Sn(this,"_contents",null),Sn(this,"_isDisposed",!1),Sn(this,"_ready",void 0),Sn(this,"kernels",void 0),Sn(this,"kernelspecs",void 0),Sn(this,"serverSettings",void 0),Sn(this,"sessions",void 0),this.serverSettings=e;const n=this.kernels=new o.KernelManager({serverSettings:e,standby:t});this.kernelspecs=new o.KernelSpecManager({serverSettings:e,standby:t}),this.sessions=new o.SessionManager({kernelManager:n,serverSettings:e,standby:t}),this.kernels.connectionFailure.connect(this._onConnectionFailure,this),this.kernelspecs.connectionFailure.connect(this._onConnectionFailure,this),this.sessions.connectionFailure.connect(this._onConnectionFailure,this),this._ready=Promise.all([this.kernels.ready,this.kernelspecs.ready,this.sessions.ready]).then((()=>{}))}get contents(){return this._contents||(this._contents=new o.ContentsManager({serverSettings:this.serverSettings})),this._contents}get isDisposed(){return this._isDisposed}get ready(){return this._ready}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._isDisposed=!0,this.sessions.connectionFailure.disconnect(this._onConnectionFailure,this),this.kernels.connectionFailure.disconnect(this._onConnectionFailure,this),this.kernelspecs.connectionFailure.disconnect(this._onConnectionFailure,this),k.Signal.clearData(this),this.contents?.dispose(),this.sessions.dispose(),this.kernels.dispose(),this.kernelspecs.dispose())}_onConnectionFailure(e,t){this._connectionFailure.emit(t)}}class En extends o.BaseManager{constructor({serverSettings:e,standby:t}){super({serverSettings:e}),Sn(this,"_connectionFailure",new k.Signal(this)),Sn(this,"_disposeStateSubscription",(()=>{})),Sn(this,"_isReady",!1),Sn(this,"_ready",new b.PromiseDelegate),Sn(this,"_standby",void 0),Sn(this,"_changed",new k.Signal(this)),Sn(this,"_kernels",new Map),Sn(this,"_refreshLock",new Set),this._standby=t,this._ready.promise.then((async()=>{const e=async()=>{for(;this._refreshLock.size;)await Promise.all(this._refreshLock);try{const e=Re.iP.getState().kernelServers,t=e.map((e=>e.jupyter_pod_name)),n=Array.from(this._kernels.keys());for(const t of e)if(!n.includes(t.jupyter_pod_name)){const e=new Mn({serverSettings:jn(t.ingress,t.token),standby:this._standby});this._kernels.set(t.jupyter_pod_name,e),e.connectionFailure.connect(((e,n)=>{404===n.response?.status&&(console.info(`Remote kernel ${t.jupyter_pod_name} is not found. Removing it from the state.`),this._kernels.delete(t.jupyter_pod_name),e.dispose())})),await e.ready}const s=await Promise.all(Array.from(this._kernels.entries()).map((async([n,s])=>{if(t.includes(n)){const t=s.kernels.running().next(),r=e.find((e=>e.jupyter_pod_name===n));return t.done?(console.warn(`No kernel in pod ${n}.`),{...r,id:"",name:r?.environment_name,execution_state:"unknown"}):{...r,...t.value,name:r?.environment_name}}s.kernels.isActive;try{await s.kernels.shutdownAll()}catch(e){console.debug(`Fail to shutdown remote kernel ${n}.`,e)}s.dispose(),this._kernels.delete(n),console.info(`Removing Zombie Kernel ${n}`)})));Re.iP.getState().setRemoteKernels(s.filter((e=>!!e)))}catch(e){if(e instanceof o.ServerConnection.ResponseError)throw e;this._connectionFailure.emit(e)}};e().catch((e=>{console.error("Failed to update kernel models list.",e)})),this._disposeStateSubscription=Re.iP.subscribe(((t,n)=>{b.JSONExt.deepEqual(t.kernelServers,n.kernelServers)||e().catch((e=>{console.error("Failed to update kernel models list.",e)})),b.JSONExt.deepEqual(t.remoteKernels,n.remoteKernels)||this._changed.emit([...t.remoteKernels])})),this._isReady=!0})),this.refresh().then((()=>{this._ready.resolve()})).catch((e=>{console.error("Failed to fetch the remote kernels.",e),this._ready.reject(e)}))}get connectionFailure(){return this._connectionFailure}get isReady(){return this._isReady}get ready(){return this._ready.promise}get changed(){return this._changed}dispose(){this.isDisposed||(this._disposeStateSubscription(),super.dispose())}get(){return[...Re.iP.getState().remoteKernels]}getServices(e){return this._kernels.get(e)}async refresh(){await Re.iP.getState().refreshKernelServers()}async startNew(e,t){if(this.isDisposed)throw new Error("Manager is disposed.");const{configuration:n,remoteKernels:s}=Re.iP.getState();if("notebook"===e.kernelType&&s.filter((e=>"notebook"===e.kernel_type)).length>=n.maxNotebookKernels||"cell"===e.kernelType&&s.filter((e=>"cell"===e.kernel_type)).length>=n.maxCellKernels)throw new kn(`You have reached your '${e.kernelType}' Remote Runtimes limit.`);const r=new b.PromiseDelegate;let i,a;this._refreshLock.add(r.promise);try{i=await(0,Cn.eI)({...e});const t=i.jupyter_pod_name;a=new Mn({serverSettings:jn(i.ingress,i.token),standby:this._standby}),this._kernels.set(t,a)}finally{r.resolve(),this._refreshLock.delete(r.promise)}await a.ready;const o=a.kernels,l=Date.now();for(;o.running().next().done&&Date.now()-l<1e4;)await o.refreshRunning();const c=o.running().next();if(!c.done){const e=c.value,n={...e,...i,name:i.environment_name};return Re.iP.getState().addRemoteKernel(n),o.connectTo({...t,model:e})}{const e=i.jupyter_pod_name,t=this._kernels.get(e);this._kernels.delete(e);const n=new b.PromiseDelegate;this._refreshLock.add(n.promise),(0,Cn.ZP)({id:e,reason:"no_kernel"}).catch((t=>{console.error(`Failed to delete broken remote kernel ${e}.`)})).finally((()=>{n.resolve(),this._refreshLock.delete(n.promise)})),t?.dispose()}throw new Rn(`No kernel running on server '${i.jupyter_pod_name}'.`,{cause:"Unable to connect to a kernel within the remote machine."})}async findById(e){for(const t of this.get())if(t.id===e)return t;await this.refresh();for(const t of this.get())if(t.id===e)return t}connectTo(e){const{model:{id:t}}=e;let n;for(const e of this.get())if(e.id===t){n=e;break}if(n){const t=this._kernels.get(n.jupyter_pod_name);if(t)return t.kernels.connectTo(e)}throw new Error("Unable to find the kernel.")}async shutdown(e){const t=await this.findById(e);if(t){const n=new b.PromiseDelegate;this._refreshLock.add(n.promise);try{const n=this._kernels.get(t.jupyter_pod_name);e&&await(n?.kernels.shutdown(e)),await(0,Cn.ZP)({id:t.jupyter_pod_name}),n?.dispose(),this._kernels.delete(t.jupyter_pod_name),Re.iP.getState().removeRemoteKernel(e)}finally{n.resolve(),this._refreshLock.delete(n.promise)}}}async shutdownAll(){const e=new b.PromiseDelegate;this._refreshLock.add(e.promise);try{await Promise.all(Array.from(this._kernels.entries()).map((async([e,t])=>{await t.kernels.shutdownAll(),await(0,Cn.ZP)({id:e}),t.dispose()}))),this._kernels.clear(),Re.iP.getState().setRemoteKernels([])}finally{e.resolve(),this._refreshLock.delete(e.promise)}}async refreshKernels(){return this.refresh()}async snapshot({id:e,podName:t,name:n,description:s,stop:r}){if(!e&&!t)throw new Error("You must provide either the kernel ID or the kernel pod name.");if(!t){const n=await this.findById(e);t=n?.jupyter_pod_name}if(t)return(0,Cn.wV)({id:t,name:n,description:s,stop:r})}async loadSnapshot({id:e,podName:t,snapshot:n}){if(!e&&!t)throw new Error("You must provide either the kernel ID or the kernel pod name.");if(!t){const n=await this.findById(e);t=n?.jupyter_pod_name}if(t)return(0,Cn.Wm)({id:t,from:n})}}class Pn{constructor({serverSettings:e,standby:t}){Sn(this,"_connectionFailure",new k.Signal(this)),Sn(this,"_isDisposed",!1),Sn(this,"_isReady",!1),Sn(this,"_ready",void 0),Sn(this,"_initKernelClients",void 0),Sn(this,"environments",void 0),Sn(this,"kernels",void 0),Sn(this,"serverSettings",void 0),this.serverSettings=e,this.environments=new An({serverSettings:e,standby:t}),this.kernels=new En({serverSettings:e,standby:t}),this.environments.connectionFailure.connect(this._onConnectionFailure,this),this.kernels.connectionFailure.connect(this._onConnectionFailure,this),this._ready=Promise.all([this.environments.ready,this.kernels.ready]).then((()=>{})),this._ready.then((()=>{this._isReady=!0})),this._initKernelClients=new Map}get connectionFailure(){return this._connectionFailure}get isDisposed(){return this._isDisposed}get isReady(){return this._isReady}get ready(){return this._ready}get initKernelClients(){return this._initKernelClients}addInitKernelClient(e,t){this._initKernelClients.set(e,t)}disposeInitKernelClient(e){this._initKernelClients.delete(e)}dispose(){this.isDisposed||(this._isDisposed=!0,this.environments.connectionFailure.disconnect(this._onConnectionFailure,this),this.kernels.connectionFailure.disconnect(this._onConnectionFailure,this),k.Signal.clearData(this),this.environments.dispose(),this.kernels.dispose())}_onConnectionFailure(e,t){this._connectionFailure.emit(t)}}function Nn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Dn{constructor(e){Nn(this,"_remoteServiceManager",void 0),Nn(this,"_localServiceManager",void 0),Nn(this,"_browserServiceManager",void 0),Nn(this,"_browserChanged",new k.Signal(this)),Nn(this,"_remoteChanged",new k.Signal(this)),pe.$K.getState().configuration.jupyterServerless?this._localServiceManager=new bn.Od(e.serverSettings):this._localServiceManager=e,this._localServiceManager=e}get browser(){return this._browserServiceManager}set browser(e){this._browserServiceManager=e,this._browserChanged.emit(this._browserServiceManager)}get browserChanged(){return this._browserChanged}get local(){return this._localServiceManager}get remote(){return this._remoteServiceManager}set remote(e){this._remoteServiceManager=e,this._remoteChanged.emit(this._remoteServiceManager)}get remoteChanged(){return this._remoteChanged}get isReady(){return this._localServiceManager.isReady}get ready(){return this._localServiceManager.ready}get connectionFailure(){return this._localServiceManager.connectionFailure}get isDisposed(){return this._localServiceManager.isDisposed}get builder(){return this._localServiceManager.builder}get contents(){return this._localServiceManager.contents}get events(){return this._localServiceManager.events}get serverSettings(){return this._localServiceManager.serverSettings}get sessions(){return this._localServiceManager.sessions}get kernels(){return this._localServiceManager.kernels}get kernelspecs(){return this._localServiceManager.kernelspecs}get settings(){return this._localServiceManager.settings}get terminals(){return this._localServiceManager.terminals}get user(){return this._localServiceManager.user}get workspaces(){return this._localServiceManager.workspaces}get nbconvert(){return this._localServiceManager.nbconvert}dispose(){this._localServiceManager.dispose()}}async function Tn(e,t,n,s){e.remote?.serverSettings.baseUrl===t?.jupyterRunUrl&&n||e.remote&&(e.remote.dispose(),e.remote=void 0),s?.roles.includes(wn.n.Member.handle)&&n&&t?.jupyterRunUrl&&!e.remote&&(e.remote=new Pn({serverSettings:jn(t.jupyterRunUrl,n)}))}var Fn=n(11160);class Ln extends T._Q{constructor(e){var t,n,s;super(),t=this,s=void 0,(n=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(n="_app"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this._app=e,this.addClass("dla-Container")}render(){return(0,V.jsx)(Fn._,{baseRoute:"",memoryRouter:!0,jupyterLabAdapter:tn.H.create(this._app)})}}var In=n(90058);let On;!function(e){e.createWidget="@datalayer/jupyter-kernels:create-widget",e.launchRemoteKernel="@datalayer/jupyter-kernels:launch-remote"}(On||(On={}));const Kn={id:"@datalayer/jupyter-kernels:manager",description:"Provides the document manager.",provides:ln.c,requires:[ln.g,dt.i_],optional:[l.sQ,r.n3,sn.n.IInfo],activate:(e,t,n,s,r,i)=>{const{docRegistry:a}=e,o=s??l.wK,c=e.restored.then((()=>{}));return new xn({registry:a,manager:e.serviceManager,opener:t,when:c,setBusy:(r&&(()=>r.setBusy()))??void 0,sessionDialogs:n,translator:o??l.wK,isConnectedCallback:()=>!i||i.isConnected})}},Un={id:"@datalayer/jupyter-kernels:service-manager",description:"Overrides the Jupyter service manager.",provides:Te,autoStart:!0,activate:e=>{console.log("Activating JupyterLab @datalayer/jupyter-kernels:service-manager plugin");const t=new Dn(e.serviceManager);return e.serviceManager=t,t}},$n={id:"@datalayer/jupyter-kernels:sessionDialogs",description:"Provides the session context dialogs.",provides:dt.i_,optional:[l.sQ],requires:[Te],autoStart:!0,activate:async(e,t,n)=>(document.body.dataset.portalRoot="true",new Ne({translator:n??l.wK},t,e.commands))},Vn={id:De,autoStart:!1,requires:[R.R,Te],optional:[mt.X,dt.kn,a.k,rn.E,pt.co,dt.zG],provides:Le,activate:async(e,t,n,s,r,a,l,d,h)=>{const{commands:u}=e,p=o.ServerConnection.makeSettings(),m=i.URLExt.join(p.baseUrl,"jupyter_kernels","config");try{const e=await o.ServerConnection.makeRequest(m,{},p);if(e.ok){const t=await e.json(),{setConfiguration:n,setVersion:s}=Re.iP.getState();n(t.configuration),s(t.version)}else console.error("Failed to load @datalayer/jupyter-kernels configuration.")}catch(e){console.error("Failed to load @datalayer/jupyter-kernels configuration.",e)}const{configuration:g,jupyterLabAdapter:y,multiServiceManager:f,setJupyterLabAdapter:_,setMultiServiceManager:v}=Re.iP.getState(),x={configuration:g};y||_(tn.H.create(e)),f||v(n);let b=!1;const w={label:"Runtimes",caption:"Show Runtimes",icon:en.A},j=e=>{if(!b){b=!0;const{category:t="Datalayer",icon:n=null,name:i="Runtimes",rank:o=0}=e.launcher??{},l=On.createWidget;(async()=>{if(i&&(w.label=i,w.caption=`Show ${i}`),n)try{const e=await fetch(n),t=await e.text();w.icon=new cn.Tl({name:"@datalayer/ui:launcher-icon",svgstr:t})}catch(e){console.warn(`Failed to fetch the custom icon SVG from ${n}.`)}u.notifyCommandChanged(l)})(),r?.addItem({command:l,category:t});const c=e=>{const n=e.get("showInLauncher").composite;a&&n&&a.add({command:l,category:t,rank:o})};s&&s.load(Vn.id).then((e=>{console.log(`${Vn.id} settings loaded:`,e.composite),c(e),e.changed.connect(c)})).catch((e=>{console.error(`Failed to load settings for ${Vn.id}.`,e)}))}const{user:t,token:i}=le.J7.getState();console.log("Retrieved Datalayer user and token."),Tn(n,e,i,t),le.J7.subscribe(((t,s)=>{t.token&&t.token!==s.token&&(console.log("Datalayer IAM current and previous states.",t,s),Tn(n,e,t.token,t.user))}))};t.ready.finally((()=>{console.log("Datalayer core plugin is ready."),j(t.configuration.configuration),t.configuration.configurationChanged.connect(((e,t)=>{j(t)}))}));const k=new an.H({namespace:"jupyter-kernels"}),C=On.createWidget;u.addCommand(C,{caption:()=>w.caption,label:()=>w.label,icon:()=>w.icon,execute:()=>{const t=new Ln(e),n=new on.p({content:t});n.title.label=w.label,n.title.icon=w.icon,e.shell.add(n,"main"),k.add(n)}}),l&&l.restore(k,{command:C,name:()=>"@datalayer/jupyter-kernels"}).catch((e=>{console.warn("Unable to restore kernel API.",e)})),u.addCommand(On.launchRemoteKernel,{label:"Launch a Remote Runtime",caption:"Launch a Notebook with a Remote Runtime",icon:e=>e.isLauncher?c.JG:Xt.A,execute:async()=>{if(n.remote){const t=T._Q.create((0,V.jsx)(nn.W,{children:(0,V.jsx)(_t.s,{manager:n.remote,onSubmit:async s=>{t.dispose(),s&&(0,In.I)({app:e,options:{kernelId:s.id}}),await n.kernels.refreshRunning()},markdownParser:d??void 0,sanitizer:h??void 0})}));F.x0.attach(t,document.body),await(0,i.signalToPromise)(t.disposed)}else await u.execute(On.createWidget)}}),a&&a.add({command:On.launchRemoteKernel,category:"Notebook",kernelIconUrl:`data:image/svg+xml,${Zt.A.svgstr}`,rank:-1,args:{isLauncher:!0}});const S=new Set;return setInterval((()=>{const t=Re.iP.getState().remoteKernels;t.forEach((t=>{const s=t.expired_at?1e3*parseFloat(t.expired_at)-Date.now():null;if(!S.has(t.jupyter_pod_name)&&s&&s<le.zo){const{dismiss:r,enqueueToast:i}=(0,de.d)(),a=i(`Kernel '${t.kernel_given_name}' is going to end in less than ${(le.zo/6e4).toFixed(0)} minutes.`,{variant:"warning",actions:[{label:"Show moreâ€¦",callback:()=>{e.commands.execute(On.createWidget)}}]});S.add(t.jupyter_pod_name),setTimeout((()=>{n.remote?.kernels.refresh(),r(a),S.delete(t.jupyter_pod_name)}),s)}}));const s=t.map((e=>e.jupyter_pod_name));[...S].forEach((e=>{s.includes(e)||S.delete(e)}))}),6e4),console.log(`JupyterLab plugin ${Vn.id} is activated.`),x}},zn=[Vn,Kn,Un,$n],qn="autoRestartCellKernels",Wn={id:"@datalayer/jupyter-kernels:lifecycle",description:"Handle foreign cell runtime lifecycle when the document one changes",requires:[Te,ht.fI],optional:[mt.X],autoStart:!1,activate:(e,t,n,s)=>{const r=new WeakMap,i=new WeakMap,a=async e=>{const n=e.kernelDisplayStatus;if(["autorestarting","restarting"].includes(n)&&n!==r.get(e)){r.set(e,e.kernelDisplayStatus);let t=null;const n=new Array,o=(await(s?.get(De,qn)))?.composite??"ask";for(const s of i.get(e)?.model?.cells??[])s.getMetadata("datalayer")?.kernel&&!1!==s.getMetadata("datalayer").kernel.params?.notebook&&s.getMetadata("datalayer").kernel.id&&(n.push(s.getMetadata("datalayer").kernel),"ask"===o&&null===t&&(t=(0,E.ui)({title:"Restart cell kernels",body:"Do you want to restart the cell kernels too?",buttons:[E.lG.cancelButton({label:"No"}),E.lG.okButton({label:"Yes"})],checkbox:{label:"Don't ask me again",caption:"Store your answer and apply it next time a restart is performed."}})));const l=await(t??Promise.resolve(null));"yes"===o?a(n):l&&(l.button.accept&&a(n),l.isChecked&&await(s?.set(De,qn,l.button.accept?"yes":"no")))}else r.set(e,n);function a(e){e.forEach((async e=>{const n=ee(e.location),s=n?t.remote?.kernels:t[e.location]?.kernels;try{const t=s?.connectTo({model:{id:e.id,name:e.name}});await(t?.restart())}catch(t){console.error(`Failed to restart ${n?"remote":e.location} kernel (${e.id})`)}}))}},o=(e,t)=>{e.isDisposed||(r.set(e,e.kernelDisplayStatus),e.statusChanged.connect(a),e.connectionStatusChanged.connect(a),i.set(e,t),e.disposed.connect((()=>{i.delete(e),e.statusChanged.disconnect(a),e.connectionStatusChanged.disconnect(a)})))};n.forEach((e=>{o(e.context.sessionContext,e.content)})),n.widgetAdded.connect(((e,t)=>{o(t.context.sessionContext,t.content)}))}};var Jn=n(76528),Hn=n(95764),Bn=n(68122),Gn=n(44069),Yn=n(10018);function Qn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Xn="jp-mod-kernel";let Zn;!function(e){e.kernelNewConsole="running:kernel-new-console",e.kernelNewNotebook="running:kernel-new-notebook",e.kernelOpenSession="running:kernel-open-session",e.kernelShutDown="running:kernel-shut-down",e.showPanel="running:show-panel"}(Zn||(Zn={}));const es={activate:function(e,t,n,s,r,a){const o=t.load("jupyterlab"),l=new Gn.cR,d=new Gn.vv(l,t);return d.id="jp-running-sessions",d.title.caption=o.__("Running Terminals and Kernels"),d.title.icon=c.z9,d.node.setAttribute("role","region"),d.node.setAttribute("aria-label",o.__("Running Sessions section")),r&&r.add(d,"running-sessions"),a&&(0,Yn.Z)(l,t,a),function(e,t,n,s){n.ready.then((()=>async function(e,t,n,s){const{commands:r,contextMenu:a}=e,o=new k.Signal({}),l=new j.Throttler((()=>o.emit()),100),d=s.load("jupyterlab"),h=()=>l.invoke().catch((e=>{console.error("Failed to refresh the running kernels.",e)}));n.local.kernels.runningChanged.connect(h),n.local.sessions.runningChanged.connect(h);const u=()=>{h(),n.remote?.kernels.changed.connect(h)};u(),n.remoteChanged.connect(u);const p=()=>{h(),n.browser?.kernels.runningChanged.connect(h),n.browser?.sessions.runningChanged.connect(h)};p(),n.browserChanged.connect(p),t.add({name:d.__("Kernels"),running:()=>{const e=[new ns({commands:r,location:"local",kernelspecs:n.local.kernelspecs,kernels:n.local.kernels,sessions:n.local.sessions,trans:d})];return n.remote?e.push(new ss({commands:r,trans:d,kerenels:n.remote.kernels})):e.push(Object.freeze({label:()=>"remote",labelTitle:()=>"Click to connect",detail:()=>"Disconnected",icon:()=>Zt.A,open:()=>{r.execute("@datalayer/jupyter-kernels:create-widget")}})),n.browser&&e.push(new ns({commands:r,location:"browser",kernelspecs:n.browser?.kernelspecs,kernels:n.browser?.kernels,sessions:n.browser?.sessions,trans:d})),e},shutdownAll:()=>Promise.all([n.local.kernels.shutdownAll(),n.remote?.kernels.shutdownAll(),n.browser?.kernels.shutdownAll()]),refreshRunning:()=>Promise.all([n.local.kernels.refreshRunning(),n.local.sessions.refreshRunning(),n.remote?.kernels.refresh(),n.browser?.kernels.refreshRunning(),n.browser?.sessions.refreshRunning()]),runningChanged:o,shutdownLabel:d.__("Shut Down Kernel"),shutdownAllLabel:d.__("Shut Down All"),shutdownAllConfirmationText:d.__("Are you sure you want to permanently shut down all running kernels?")});const m=e=>e.classList.contains(Xn);r.addCommand(Zn.kernelNewConsole,{icon:c.zk,label:d.__("New Console for Kernel"),execute:t=>{const n=e.contextMenuHitTest(m),s=t.id??n?.dataset.context;if(s)return r.execute("console:create",{kernelPreference:{id:s}})}}),r.addCommand(Zn.kernelNewNotebook,{icon:c.JG,label:d.__("New Notebook for Kernel"),execute:t=>{const n=e.contextMenuHitTest(m),s=t.id??n?.dataset.context;if(s)return r.execute("notebook:create-new",{kernelId:s})}}),r.addCommand(Zn.kernelOpenSession,{icon:e=>"console"===e.type?c.zk:"notebook"===e.type?c.JG:void 0,isEnabled:({path:e,type:t})=>!!t||void 0!==e,label:({name:e,path:t})=>e||i.PathExt.basename(t||d.__("Unknown Session")),execute:({path:e,type:t})=>{if(!t||void 0===e)return;const n="console"===t?"console:open":"docmanager:open";return r.execute(n,{path:e})}}),r.addCommand(Zn.kernelShutDown,{icon:c.ut,label:d.__("Shut Down Kernel"),execute:t=>{const s=e.contextMenuHitTest(m),r=t.id??s?.dataset.context;if(r)return Promise.all([n.local.kernels.findById(r).then((()=>n.local.kernels.shutdown(r))),n.remote?.kernels.findById(r).then((()=>n.remote?.kernels.shutdown(r))),n.browser?.kernels.findById(r).then((()=>n.browser?.kernels.shutdown(r)))])}});const g=[];a.opened.connect((async()=>{const t=a.menu.items.find((e=>"submenu"===e.type&&"jp-contextmenu-connected-sessions"===e.submenu?.id))?.submenu??null;if(!t)return;g.forEach((e=>e.dispose())),g.length=0,t.clearItems();const s=e.contextMenuHitTest(m),r=s?.dataset.context;if(!r)return;const i=Zn.kernelOpenSession;for(const e of Array.from(n.local.sessions.running()).concat(Array.from(n.browser?.sessions.running()??[])))if(r===e.kernel?.id){const{name:n,path:s,type:r}=e;g.push(t.addItem({command:i,args:{name:n,path:s,type:r}}))}}))}(e,t,n,s))).catch((e=>{console.error("The services manager failed to initialize.",e)}))}(e,l,n,t),e.shell.add(d,"left",{rank:200,type:"Sessions and Tabs"}),e.commands.addCommand(Zn.showPanel,{label:o.__("Sessions and Tabs"),execute:()=>{e.shell.activateById(d.id)}}),l},id:"@datalayer/jupyter-kernels:running",description:"Provides the running session managers.",provides:Gn.$F,requires:[l.sQ,Te,R.R],optional:[rn.E,Bn.V],autoStart:!0};const ts={browser:Jn.A,local:Hn.A,remote:Zt.A};class ns{constructor({commands:e,location:t,kernelspecs:n,kernels:s,sessions:r,trans:i}){Qn(this,"commands",void 0),Qn(this,"kernelspecs",void 0),Qn(this,"kernels",void 0),Qn(this,"sessions",void 0),Qn(this,"trans",void 0),Qn(this,"context",void 0),this.commands=e,this.context=t,this.kernelspecs=n,this.kernels=s,this.sessions=r,this.trans=i}get children(){return Array.from(this.kernels.running()).map((e=>new rs({commands:this.commands,kernel:e,kernels:this.kernels,sessions:this.sessions,spec:this.kernelspecs.specs?.kernelspecs[e.name],trans:this.trans})))}get className(){return this.kernels.running().next().done?"dla-kernels-empty-group":"dla-kernels-group"}open(){"remote"===this.context&&this.commands.execute("@datalayer/jupyter-kernels:create-widget")}shutdown(){this.kernels.shutdownAll().catch((e=>{console.error(`Failed to shutdown all kernels on ${this.context} location.`,e)}))}icon(){return ts[this.context]}label(){return this.context}detail(){switch(this.context){case"browser":return function(){const e=e=>e.test(navigator.userAgent);return e(/opr\//i)?"Opera":e(/edg/i)?"Microsoft Edge":e(/chrome|chromium|crios/i)?"Google Chrome":e(/firefox|fxios/i)?"Mozilla Firefox":e(/safari/i)?"Apple Safari":e(/trident/i)?"Microsoft Internet Explorer":e(/ucbrowser/i)?"UC Browser":e(/samsungbrowser/i)?"Samsung Browser":"Unknown browser"}();case"local":case"remote":try{return new URL(this.kernels.serverSettings.baseUrl).hostname}catch(e){return""}}return""}}class ss{constructor({commands:e,kerenels:t,trans:n}){Qn(this,"commands",void 0),Qn(this,"trans",void 0),Qn(this,"kernels",void 0),Qn(this,"context",void 0),this.commands=e,this.context="remote",this.trans=n,this.kernels=t}get children(){return this.kernels.get().map((e=>{const t=this.kernels.getServices(e.jupyter_pod_name);return t?new rs({commands:this.commands,kernel:{...e,id:e.jupyter_pod_name.split("-",2).reverse()[0],name:e.kernel_given_name},kernels:this.kernels,sessions:t.sessions,spec:t.kernelspecs.specs?.kernelspecs[e.name]?{...t.kernelspecs.specs.kernelspecs[e.name],name:e.environment_name,display_name:e.environment_display_name}:void 0,trans:this.trans}):null})).filter((e=>!!e))}get className(){return 0===this.kernels.get().length?"dla-kernels-empty-group":"dla-kernels-group"}detail(){return new URL(this.kernels.serverSettings.baseUrl).hostname}icon(){return ts[this.context]}label(){return this.context}open(){this.commands.execute("@datalayer/jupyter-kernels:create-widget")}shutdown(){this.kernels.shutdownAll().catch((e=>{console.error(`Failed to shutdown all kernels on ${this.context} location.`,e)}))}}class rs{constructor(e){Qn(this,"className",void 0),Qn(this,"context",void 0),Qn(this,"commands",void 0),Qn(this,"kernel",void 0),Qn(this,"kernels",void 0),Qn(this,"sessions",void 0),Qn(this,"spec",void 0),Qn(this,"trans",void 0),this.className=Xn,this.commands=e.commands,this.kernel=e.kernel,this.context=this.kernel.id,this.kernels=e.kernels,this.sessions=e.sessions,this.spec=e.spec||null,this.trans=e.trans}get children(){const e=[],t=Zn.kernelOpenSession,{commands:n}=this;for(const s of this.sessions.running())if(this.kernel.id===s.kernel?.id){const{name:r,id:i,path:a,type:o}=s;e.push({className:"ITEM_CLASS",context:this.kernel.id,open:()=>{n.execute(t,{name:r,path:a,type:o})},icon:()=>"console"===o?c.zk:"notebook"===o?c.JG:c.H8,label:()=>r,labelTitle:()=>a,detail:()=>i})}return e}shutdown(){return this.kernels.shutdown(this.kernel.id)}icon(){const{spec:e}=this;return e&&e.resources?e.resources["logo-svg"]||e.resources["logo-64x64"]||e.resources["logo-32x32"]:c.H8}label(){const{kernel:e,spec:t}=this;return t?.display_name||e.name}labelTitle(){const{trans:e}=this,{id:t}=this.kernel,n=[`${this.label()}: ${t}`];for(const t of this.sessions.running())if(this.kernel.id===t.kernel?.id){const{path:s,type:r}=t;n.push(e.__("%1\nPath: %2",r,s))}return n.join("\n\n")}detail(){return this.kernel.id}}const is=[...zn,...et,ct,Vt,zt,Qt,Wn,es],as=is},29745:(e,t,n)=>{n.d(t,{U:()=>c});var s=n(29187),r=n(97096),i=n(98754),a=n(31906),o=n(8250),l=n(18683);const c=()=>(0,l.jsxs)(s.M,{containerWidth:"full",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,l.jsxs)(s.M.Header,{children:[(0,l.jsx)(r.z,{children:(0,l.jsx)(r.z.TitleArea,{variant:"large",children:(0,l.jsx)(r.z.Title,{children:"Content"})})}),(0,l.jsx)(i.A,{children:(0,l.jsx)(a.A,{children:(0,l.jsx)(i.A,{children:"This feature is being developed."})})})]}),(0,l.jsx)(s.M.Content,{children:(0,l.jsx)(o.A,{size:200})})]})},43322:(e,t,n)=>{n.d(t,{J:()=>m});var s=n(9387),r=n(29187),i=n(8586),a=n(98754),o=n(88996),l=n(48371),c=n(99180),d=n(83817),h=n(23530),u=n(53850),p=n(18683);const m=e=>{const{joinWelcomeRoute:t}=e,n=(0,h.Z)(),{confirmJoin:m}=(0,u.E)(),[g,y]=(0,s.useState)(!1),[f,_]=(0,s.useState)({handle:void 0,token:void 0}),[v,x]=(0,s.useState)({handle:void 0,token:void 0});return(0,s.useEffect)((()=>{x({...v,handle:void 0===f.handle?void 0:(0,d.xR)(f.handle,1)?"success":"error",token:void 0===f.token?void 0:(0,d.xR)(f.token,1)?"success":"error"})}),[f]),(0,p.jsxs)(r.M,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,p.jsx)(r.M.Header,{children:(0,p.jsx)(i.A,{children:"Activate your Datalayer account"})}),(0,p.jsx)(r.M.Content,{children:(0,p.jsx)(a.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,p.jsxs)(a.A,{sx:{label:{marginTop:2}},children:[(0,p.jsx)(a.A,{children:(0,p.jsxs)(o.A,{required:!0,children:[(0,p.jsx)(o.A.Label,{children:"Your username"}),(0,p.jsx)(l.A,{autoFocus:!0,value:f.handle,onChange:e=>{_((t=>({...t,handle:e.target.value})))}}),"error"===v.handle&&(0,p.jsx)(o.A.Validation,{variant:v.handle,children:"Your username must have more than 1 character."})]})}),(0,p.jsx)(a.A,{children:(0,p.jsxs)(o.A,{required:!0,children:[(0,p.jsx)(o.A.Label,{children:"Your activation code (check your mail)"}),(0,p.jsx)(l.A,{type:"email",value:f.token,onChange:e=>{_((t=>({...t,token:e.target.value})))}}),"error"===v.token&&(0,p.jsx)(o.A.Validation,{variant:v.token,children:"Your activation code is too small."})]})}),(0,p.jsx)(a.A,{sx:{display:"flex"},mt:2,children:(0,p.jsx)(c.Q,{variant:"primary",type:"submit",disabled:g||"success"!==v.handle||"success"!==v.token,onClick:async()=>{g||Object.values(v).some((e=>"success"!==e))||(y(!0),m(f.handle,f.token).then((e=>{e.success&&n(t)})).finally((()=>{y(!1)})))},children:g?"Activatingâ€¦":"Activate"})})]})})})]})}},75650:(e,t,n)=>{n.d(t,{n:()=>y});var s=n(9387),r=n(38621),i=n(29187),a=n(8586),o=n(98754),l=n(88996),c=n(48371),d=n(99180),h=n(83817),u=n(53850),p=n(97734),m=n(23530),g=n(18683);const y=e=>{const{joinConfirmRoute:t}=e,{requestJoinToken:n}=(0,u.E)(),{enqueueToast:y}=(0,p.d)(),f=(0,m.Z)(),[_,v]=(0,s.useState)(!1),[x,b]=(0,s.useState)({handle:void 0,email:void 0,firstName:void 0,lastName:void 0,password:void 0,passwordConfirm:void 0}),[w,j]=(0,s.useState)({handle:void 0,email:void 0,firstName:void 0,lastName:void 0,password:void 0,passwordConfirm:void 0}),[k,C]=(0,s.useState)(!1),[S,A]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{j({...w,handle:void 0===x.handle?void 0:(0,h.xR)(x.handle,1)?"success":"error",email:void 0===x.email?void 0:(0,h.B9)(x.email)?"success":"error",firstName:void 0===x.firstName?void 0:(0,h.xR)(x.firstName,1)?"success":"error",lastName:void 0===x.lastName?void 0:(0,h.xR)(x.lastName,1)?"success":"error",password:void 0===x.password?void 0:(0,h.sl)(x.password)?"success":"error",passwordConfirm:void 0===x.passwordConfirm?void 0:x.password===x.passwordConfirm?"success":"error"})}),[x]),(0,g.jsxs)(i.M,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,g.jsx)(i.M.Header,{children:(0,g.jsx)(a.A,{children:"Join Datalayer"})}),(0,g.jsx)(i.M.Content,{children:(0,g.jsx)(o.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,g.jsxs)(o.A,{sx:{label:{marginTop:2}},children:[(0,g.jsxs)(l.A,{required:!0,children:[(0,g.jsx)(l.A.Label,{children:"Your username"}),(0,g.jsx)(c.A,{autoFocus:!0,value:x.handle,onChange:e=>{b((t=>({...t,handle:e.target.value})))}}),"error"===w.handle&&(0,g.jsx)(l.A.Validation,{variant:w.handle,children:"Your username must have more than 1 character."})]}),(0,g.jsxs)(l.A,{required:!0,children:[(0,g.jsx)(l.A.Label,{children:"Your email"}),(0,g.jsx)(c.A,{type:"email",value:x.email,onChange:e=>{b((t=>({...t,email:e.target.value})))}}),"error"===w.email&&(0,g.jsx)(l.A.Validation,{variant:w.email,children:"Your email is not valid."})]}),(0,g.jsxs)(l.A,{required:!0,children:[(0,g.jsx)(l.A.Label,{children:"Your first name"}),(0,g.jsx)(c.A,{value:x.firstName,onChange:e=>{b((t=>({...t,firstName:e.target.value})))}}),"error"===w.firstName&&(0,g.jsx)(l.A.Validation,{variant:w.firstName,children:"Your first name must have more than 1 character."})]}),(0,g.jsxs)(l.A,{required:!0,children:[(0,g.jsx)(l.A.Label,{children:"Your last name"}),(0,g.jsx)(c.A,{value:x.lastName,onChange:e=>{b((t=>({...t,lastName:e.target.value})))}}),"error"===w.lastName&&(0,g.jsx)(l.A.Validation,{variant:w.lastName,children:"Your last name must have more than 1 character."})]}),(0,g.jsxs)(l.A,{required:!0,children:[(0,g.jsx)(l.A.Label,{children:"Your password"}),(0,g.jsx)(c.A,{type:k?"text":"password",value:x.password,onChange:e=>{b((t=>({...t,password:e.target.value})))},trailingAction:(0,g.jsx)(c.A.Action,{onClick:()=>{C(!k)},icon:k?r.V$C:r.bMW,"aria-label":k?"Hide password":"Show password",sx:{color:"var(--fgColor-muted)"}}),sx:{overflow:"visible"}}),"error"===w.password&&(0,g.jsx)(l.A.Validation,{variant:w.password,children:"The password must be between 8 and 64 characters with at least one lower case character, one upper case character, one digit and one special character."})]}),(0,g.jsxs)(l.A,{required:!0,children:[(0,g.jsx)(l.A.Label,{children:"Your password confirmation"}),(0,g.jsx)(c.A,{type:S?"text":"password",value:x.passwordConfirm,onChange:e=>{b((t=>({...t,passwordConfirm:e.target.value})))},trailingAction:(0,g.jsx)(c.A.Action,{onClick:()=>{A(!S)},icon:S?r.V$C:r.bMW,"aria-label":S?"Hide password":"Show password",sx:{color:"var(--fgColor-muted)"}}),sx:{overflow:"visible"}}),"error"===w.passwordConfirm&&(0,g.jsx)(l.A.Validation,{variant:w.passwordConfirm,children:"Passwords do not match."})]}),(0,g.jsx)(o.A,{sx:{display:"flex"},mt:2,children:(0,g.jsx)(d.Q,{variant:"primary",type:"submit",disabled:_||Object.values(w).some((e=>"success"!==e)),onClick:async()=>{_||Object.values(w).some((e=>"success"!==e))||(v(!0),n(x.handle,x.email,x.firstName,x.lastName,x.password,x.passwordConfirm).then((e=>{e.success&&(y(e.message,{variant:"success"}),f(t))})).finally((()=>{v(!1)})))},children:_?"Requestingâ€¦":"Request to join"})})]})})})]})}},24630:(e,t,n)=>{n.d(t,{D:()=>o});var s=n(9387),r=n(97734),i=n(23530),a=n(18683);const o=e=>{const{loginRoute:t}=e,{enqueueToast:n}=(0,r.d)(),o=(0,i.Z)();return(0,s.useEffect)((()=>{n("Welcome to Datalayer - Login with your username and password.",{variant:"success"}),o(t)}),[]),(0,a.jsx)(a.Fragment,{})}},29621:(e,t,n)=>{n.d(t,{a:()=>k});var s=n(9387),r=n(38621),i=n(29187),a=n(8586),o=n(98754),l=n(88996),c=n(48371),d=n(99180),h=n(77672),u=n(20938),p=n(76818),m=n(20614),g=n(43715),y=n(44536),f=n(83817),_=n(53850),v=n(24500),x=n(97734),b=n(23530),w=n(81734),j=n(18683);const k=e=>{const{heading:t,homeRoute:n,loginRoute:k,showEmailLogin:C=!0,showGitHubLogin:S=!0,showTokenLogin:A=!0}=e,{login:R}=(0,_.E)({loginRoute:k}),{loginAndNavigate:M,setLogin:E}=(0,v.D)(),{externalToken:P,iamProvidersAuthorizationURL:N,logout:D,checkIAMToken:T}=(0,y.Y)(),{enqueueToast:F}=(0,x.d)(),L=(0,b.Z)(),[I,O]=(0,s.useState)(!1),[K,U]=(0,s.useState)(-1),[$,V]=(0,s.useState)({handle:void 0,password:void 0}),[z,q]=(0,s.useState)({handle:void 0,password:void 0}),[W,J]=(0,s.useState)(!1);(0,s.useEffect)((()=>{P&&(U(1),M(P,D,T,L,n).catch((e=>{console.error("Failed to login with token from cookie..",e),F("Failed to check authentication.",{variant:"error"})})).finally((()=>{U(-1)})))}),[P]);const H=e=>{"Enter"===e.key&&B()},B=async()=>{I||""!==z.handle||""!==z.password||(O(!0),R($.handle,$.password).then((e=>{if(e.success){q({handle:"",password:""});const t=(0,m.ex)(e.user),s=e.token;E(t,s),L(n)}else F("Failed to login. Check your username and password.",{variant:"warning"}),q({handle:"",password:"Invalid credentials"}),console.warn(`Failed to login: ${e.message}`,e.errors??"")})).finally((()=>{O(!1)})))};return(0,s.useEffect)((()=>{q({...z,handle:void 0===$.handle?void 0:(0,f.xR)($.handle,1)?"":"Your username may not be empty.",password:void 0===$.password?void 0:(0,f.xR)($.password,1)?"":"Your password may not be empty."})}),[$]),(0,j.jsxs)(i.M,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,j.jsx)(i.M.Header,{children:(0,j.jsx)(a.A,{children:t||"Login to Datalayer"})}),(0,j.jsx)(i.M.Content,{children:K<0?(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(o.A,{display:"grid",gridTemplateColumns:"1fr 20px 1fr",children:[C&&(0,j.jsxs)(o.A,{sx:{label:{marginTop:2},paddingRight:"10%"},children:[(0,j.jsx)(o.A,{mt:5,children:(0,j.jsxs)(l.A,{required:!0,children:[(0,j.jsx)(l.A.Label,{children:"Your username"}),(0,j.jsx)(c.A,{autoFocus:!0,placeholder:"Your username",value:$.handle,onChange:e=>{V((t=>({...t,handle:e.target.value})))},onKeyDown:H}),z.handle&&(0,j.jsx)(l.A.Validation,{variant:z.handle?"error":"success",children:z.handle})]})}),(0,j.jsx)(o.A,{children:(0,j.jsxs)(l.A,{required:!0,children:[(0,j.jsx)(l.A.Label,{children:"Your password"}),(0,j.jsx)(c.A,{placeholder:"Your password",type:W?"text":"password",value:$.password,onChange:e=>{V((t=>({...t,password:e.target.value})))},onKeyDown:H,trailingAction:(0,j.jsx)(c.A.Action,{onClick:()=>{J(!W)},icon:W?r.V$C:r.bMW,"aria-label":W?"Hide password":"Show password",sx:{color:"var(--fgColor-muted)"}}),sx:{overflow:"visible"}}),z.password&&(0,j.jsx)(l.A.Validation,{variant:z.password?"error":"success",children:z.password})]})}),(0,j.jsxs)(o.A,{mt:5,children:[(0,j.jsx)(d.Q,{variant:"primary",disabled:I||""!==z.handle||""!==z.password,onClick:B,children:I?"Loginâ€¦":t?"Login with Datalayer":"Login"}),(0,j.jsx)(o.A,{pt:6}),(0,j.jsx)(h.A,{href:"https://datalayer.io/join",target:"_blank",children:"Don't have an account?"}),(0,j.jsx)(o.A,{pt:1}),(0,j.jsx)(h.A,{href:"https://datalayer.io/password",target:"_blank",children:"Forgot password?"})]})]}),(0,j.jsxs)(o.A,{display:"flex",flexDirection:"column",sx:{margin:"auto"},children:[S&&N[g.W.GitHub.name]&&(0,j.jsx)(d.Q,{leadingVisual:r.uj0,href:N[g.W.GitHub.name],as:"a",style:{margin:"10px 0"},children:"Login with GitHub"}),A&&(0,j.jsx)(w.f,{homeRoute:n,style:{margin:"10px 0"}})]})]})}):K?(0,j.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:[(0,j.jsx)(u.A,{}),(0,j.jsx)(p.A,{children:"Checking authenticationâ€¦"})]}):null})]})}},56635:(e,t,n)=>{n.d(t,{y:()=>m});var s=n(29187),r=n(8586),i=n(98754),a=n(88996),o=n(48371),l=n(99180),c=n(9387),d=n(83817),h=n(53850),u=n(23530),p=n(18683);const m=e=>{const{loginRoute:t,passwordWelcomeRoute:n}=e,{confirmPassworkWithToken:m}=(0,h.E)(),g=(0,u.Z)(),[y,f]=(0,c.useState)(!1),[_,v]=(0,c.useState)({handle:void 0,token:void 0}),[x,b]=(0,c.useState)({handle:void 0,token:void 0});return(0,c.useEffect)((()=>{b({...x,handle:void 0===_.handle?void 0:(0,d.xR)(_.handle,1)?"success":"error",token:void 0===_.token?void 0:(0,d.xR)(_.token,1)?"success":"error"})}),[_]),(0,p.jsxs)(s.M,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,p.jsx)(s.M.Header,{children:(0,p.jsx)(r.A,{children:"Confirm your password"})}),(0,p.jsx)(s.M.Content,{children:(0,p.jsx)(i.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,p.jsxs)(i.A,{sx:{label:{marginTop:2}},children:[(0,p.jsx)(i.A,{children:(0,p.jsxs)(a.A,{required:!0,children:[(0,p.jsx)(a.A.Label,{children:"Your username"}),(0,p.jsx)(o.A,{autoFocus:!0,value:_.handle,onChange:e=>{v((t=>({...t,handle:e.target.value})))}}),"error"===x.handle&&(0,p.jsx)(a.A.Validation,{variant:x.handle,children:"Your username must have more than 1 character."})]})}),(0,p.jsx)(i.A,{children:(0,p.jsxs)(a.A,{required:!0,children:[(0,p.jsx)(a.A.Label,{children:"Your activation code (check your mail)"}),(0,p.jsx)(o.A,{type:"email",value:_.token,onChange:e=>{v((t=>({...t,token:e.target.value})))}}),"error"===x.token&&(0,p.jsx)(a.A.Validation,{variant:x.token,children:"Your activation token is too small."})]})}),(0,p.jsx)(i.A,{sx:{display:"flex"},mt:2,children:(0,p.jsx)(l.Q,{variant:"primary",type:"submit",disabled:y||"success"!==x.handle||"success"!==x.token,onClick:async()=>{y||Object.values(x).some((e=>"success"!==e))||(f(!0),m(_.handle,_.token).then((e=>{e.success?g(n):g(t)})))},children:y?"Activatingâ€¦":"Activate"})})]})})})]})}},60533:(e,t,n)=>{n.d(t,{U:()=>y});var s=n(9387),r=n(29187),i=n(8586),a=n(98754),o=n(88996),l=n(48371),c=n(99180),d=n(38621),h=n(83817),u=n(53850),p=n(23530),m=n(97734),g=n(18683);const y=e=>{const{passwordConfirmRoute:t}=e,{createTokenForPasswordChange:n}=(0,u.E)(),y=(0,p.Z)(),{enqueueToast:f}=(0,m.d)(),[_,v]=(0,s.useState)(!1),[x,b]=(0,s.useState)(!1),[w,j]=(0,s.useState)(!1),[k,C]=(0,s.useState)({handle:void 0,password:void 0,passwordConfirm:void 0}),[S,A]=(0,s.useState)({handle:void 0,password:void 0,passwordConfirm:void 0}),R=e=>{"Enter"===e.key&&M()};(0,s.useEffect)((()=>{A({...S,handle:void 0===k.handle?void 0:(0,h.xR)(k.handle,1)?"success":"error",password:void 0===k.password?void 0:(0,h.sl)(k.password)?"success":"error",passwordConfirm:void 0===k.passwordConfirm?void 0:k.password===k.passwordConfirm?"success":"error"})}),[k]);const M=async()=>{_||Object.values(S).some((e=>"success"!==e))||(v(!0),n(k.handle,k.password,k.passwordConfirm).then((e=>{e.success?(f(e.message,{variant:"success"}),y(t)):f(e.message,{variant:"error"})})).finally((()=>{v(!1)})))};return(0,g.jsxs)(r.M,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,g.jsx)(r.M.Header,{children:(0,g.jsx)(i.A,{children:"Change your password"})}),(0,g.jsx)(r.M.Content,{children:(0,g.jsxs)(a.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:[(0,g.jsxs)(a.A,{sx:{label:{marginTop:2}},children:[(0,g.jsxs)(o.A,{required:!0,children:[(0,g.jsx)(o.A.Label,{children:"Your username"}),(0,g.jsx)(l.A,{autoFocus:!0,value:k.handle,onChange:e=>{C((t=>({...t,handle:e.target.value})))},onKeyDown:R}),"error"===S.handle&&(0,g.jsx)(o.A.Validation,{variant:S.handle,children:"Your username must have more than 1 character."})]}),(0,g.jsxs)(o.A,{required:!0,children:[(0,g.jsx)(o.A.Label,{children:"Your new password"}),(0,g.jsx)(l.A,{type:x?"text":"password",value:k.password,onChange:e=>{C((t=>({...t,password:e.target.value})))},onKeyDown:R,trailingAction:(0,g.jsx)(l.A.Action,{onClick:()=>{b(!x)},icon:x?d.V$C:d.bMW,"aria-label":x?"Hide password":"Show password",sx:{color:"var(--fgColor-muted)"}}),sx:{overflow:"visible"}}),"error"===S.password&&(0,g.jsx)(o.A.Validation,{variant:S.password,children:"The password must be between 8 and 64 characters with at least one lower case character, one upper case character, one digit and one special character."})]}),(0,g.jsxs)(o.A,{required:!0,children:[(0,g.jsx)(o.A.Label,{children:"Your new password confirmation"}),(0,g.jsx)(l.A,{type:w?"text":"password",value:k.passwordConfirm,onChange:e=>{C((t=>({...t,passwordConfirm:e.target.value})))},onKeyDown:R,trailingAction:(0,g.jsx)(l.A.Action,{onClick:()=>{j(!w)},icon:w?d.V$C:d.bMW,"aria-label":w?"Hide password":"Show password",sx:{color:"var(--fgColor-muted)"}}),sx:{overflow:"visible"}}),"error"===S.passwordConfirm&&(0,g.jsx)(o.A.Validation,{variant:S.passwordConfirm,children:"Passwords do not match."})]})]}),(0,g.jsx)(a.A,{sx:{display:"flex"},mt:2,children:(0,g.jsx)(c.Q,{variant:"primary",type:"submit",disabled:_||"success"!==S.handle||"success"!==S.password||"success"!==S.passwordConfirm,onClick:M,children:_?"Sending mail to change passwordâ€¦":"Request to change password"})})]})})]})}},64983:(e,t,n)=>{n.d(t,{Q:()=>o});var s=n(9387),r=n(97734),i=n(23530),a=n(18683);const o=e=>{const{loginRoute:t}=e,{enqueueToast:n}=(0,r.d)(),o=(0,i.Z)();return(0,s.useEffect)((()=>{o(t),n("Welcome back to Datalayer. Login with your username and new password",{variant:"success"})}),[]),(0,a.jsx)(a.Fragment,{})}},11160:(e,t,n)=>{n.d(t,{_:()=>ye});var s=n(20568),r=n(26939),i=n(99571),a=n(63711),o=n(76417),l=n(83076),c=n(9387),d=n(55285),h=n(49865),u=n(29885),p=n(320),m=n(44536),g=n(51857),y=n(48716),f=n(97734),_=n(23530),v=n(70408),x=n(20938),b=n(98754),w=n(88996),j=n(48371),k=n(59528),C=n(49370),S=n(18683);function A(e){const{currentLimit:t,handleSubmit:n,maximum:s}=e,[r,i]=(0,c.useState)(0),[a,o]=(0,c.useState)(!1),[l,d]=(0,c.useState)(!1),h=((0,c.useCallback)((e=>{o(e.target.checked)}),[]),s-t);return(0,S.jsx)(k.l,{title:"Increase Credit Limit",onClose:()=>{n()},footerButtons:[{buttonType:"default",content:"Cancel",onClick:e=>{e.defaultPrevented||(e.preventDefault(),n())}},{buttonType:"primary",content:l?(0,S.jsx)(x.A,{size:"small"}):"Apply",disabled:l,onClick:e=>{e.defaultPrevented||(e.preventDefault(),d(!0),n({increment:r,permanent:a}).finally((()=>{d(!1)})))},autoFocus:!0}],children:(0,S.jsx)(b.A,{as:"form",onKeyDown:e=>{e.defaultPrevented||"Enter"===e.key&&(e.preventDefault(),d(!0),n({increment:r,permanent:a}).finally((()=>{d(!1)})))},children:(0,S.jsxs)(w.A,{children:[(0,S.jsx)(w.A.Label,{children:"Credits limit increase in US dollars"}),(0,S.jsxs)(b.A,{style:{alignItems:"center",display:"grid",gridTemplateColumns:"max-content 1fr max-content max-content",gridGap:"var(--stack-gap-condensed)"},children:[(0,S.jsx)(v.Ap,{step:1,min:0,max:h,value:r,onChange:i,label:"",displayValue:!1}),(0,S.jsx)(j.A,{type:"number",step:"10",min:"0",max:h,value:r.toFixed(2),onChange:e=>{i(parseFloat(e.target.value))}})]}),(0,S.jsx)(w.A.Caption,{children:`Applying this change will raise your credits limit to $${(t+r).toFixed(2)}.`}),h<Number.EPSILON&&(0,S.jsx)(w.A.Validation,{variant:"error",children:`You cannot increase your credits limit above ${s.toFixed(2)}`})]})})})}function R(){const e=(0,s.Zp)(),{externalToken:t,iamRunUrl:n,refreshCredits:r}=(0,m.Y)(),{enqueueToast:i}=(0,f.d)(),{requestRun:a}=(0,C.X)(),[o,l]=(0,c.useState)(!1),[d,h]=(0,c.useState)(null);(0,c.useEffect)((()=>{a({url:`${n}/api/iam/anaconda/v1/creditsLimits`,headers:{"X-External-Token":t??""},notifyOnError:!1}).then((t=>{t.success?(h({hard:t.hard_limit_in_dollars,soft:t.soft_limit_in_dollars,id:t.subscription_id}),l(!0)):(i("Unable to fetch current credits limit.",{variant:"error"}),e(-1))}))}),[t,n]);const u=(0,c.useCallback)((async s=>{d&&s&&(await a({url:`${n}/api/iam/anaconda/v1/creditsLimits`,method:"PATCH",body:{permanent:s.permanent,soft_limit_in_dollars:d.soft+s.increment,subscription_id:d.id},headers:{"X-External-Token":t??""}})).success&&r().catch((e=>{console.error("Failed to refresh credits following update.",e)})),l(!1),e(-1)}),[t,n,d]);return o?(0,S.jsx)(A,{currentLimit:d.soft,maximum:d.hard,handleSubmit:u}):(0,S.jsx)(b.A,{sx:{display:"grid",alignContent:"center",justifyContent:"center",position:"absolute",top:0,left:0,height:"100%",width:"100%",backgroundColor:"var(--overlay-backdrop-bgColor)"},children:(0,S.jsx)(x.A,{size:"large"})})}var M=n(4338),E=n(29621),P=n(60533),N=n(56635),D=n(64983),T=n(75650),F=n(43322),L=n(24630),I=n(72883),O=n(67776),K=n(22088),U=n(36228),$=n(96308),V=n(86944),z=n(29187),q=n(97096),W=n(99180),J=n(154),H=n(7863),B=n(24079),G=n(94216);const Y=()=>{const e=(0,_.Z)(),{configuration:t}=(0,p._O)();return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(z.M,{containerWidth:"full",padding:"normal",sx:{overflow:"visible"},children:[(0,S.jsx)(z.M.Header,{children:(0,S.jsx)(q.z,{children:(0,S.jsx)(q.z.TitleArea,{variant:"large",children:(0,S.jsx)(q.z.Title,{children:"Jupyter Runtimes"})})})}),(0,S.jsx)(z.M.Content,{children:(0,S.jsxs)(b.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4},children:[(0,S.jsx)(b.A,{sx:{gridColumn:"1 / 3"},children:(0,S.jsx)(H.l,{title:"Runtimes",linkLabel:"More on Runtimes",linkUrl:"/jupyter/kernels/runtimes",content:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(W.Q,{variant:"default",size:"large",leadingVisual:()=>(0,S.jsx)(J.Cx,{type:"kernel"}),onClick:t=>e("/jupyter/kernels/runtimes/new",t),children:"Launch a Runtime"}),(0,S.jsx)(s.BV,{children:(0,S.jsx)(s.qh,{path:"",element:(0,S.jsx)(G.o,{})})}),(0,S.jsx)(W.Q,{variant:"default",leadingVisual:()=>(0,S.jsx)(J.Cx,{type:"documentation"}),onClick:t=>e("/jupyter/kernels/docs",t),children:"Read the documentation"})]})})}),(0,S.jsx)(b.A,{sx:{gridColumn:"3 / 4",gridRow:"1 / 3"},children:(0,S.jsx)(H.l,{title:"Usage",linkLabel:"More on Usage",linkUrl:"/jupyter/kernels/usage",content:(0,S.jsx)(s.BV,{children:(0,S.jsx)(s.qh,{path:"",element:(0,S.jsx)(O.pp,{showLeftPane:!1}),children:(0,S.jsx)(s.qh,{path:"",element:(0,S.jsx)(B.t,{})})})})})})]})})]})})};var Q=n(13214),X=n(77672),Z=n(62759),ee=n(50059);const te=e=>{const{boxPanel:t}=e;return(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(b.A,{className:"jp-LabShell",sx:{position:"relative","& .dla-Jupyter-Notebook":{height:1e3,maxHeight:1e3,width:"100%"},"& .jp-MainAreaWidget":{width:"100%",height:"100%"},"& .jp-Toolbar":{width:"100% !important"},"& .jp-NotebookPanel-notebook":{width:"100% !important",height:"100%"},"& .lm-mod-hidden":{display:"unset !important"}},children:(0,S.jsx)(ee.j,{children:t})})})},ne=e=>{const{version:t}=e,{jupyterLabAdapter:n,multiServiceManager:s}=(0,g.xb)(),{enqueueToast:r}=(0,f.d)(),[i,a]=(0,c.useState)(),[o,l]=(0,c.useState)(),[h,u]=(0,c.useState)(),[p,m]=(0,c.useState)();(0,c.useEffect)((()=>{n&&(async()=>{const e=await n.notebook("test.ipynb");m(e)})().catch(console.error)}),[n]);const y=()=>{a(Array.from(s.local.kernels.running())),l(Array.from(s.local.sessions.running())),u(s.remote.kernels.get())};return(0,d.$$)((()=>{s?.remote&&y()}),5e3),(0,S.jsxs)(b.A,{sx:{width:"xlarge",padding:2},children:[(0,S.jsx)(Q.O,{version:t,skipLocal:!0}),(0,S.jsx)(q.z,{children:"Debugging Section"}),s?.local&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.A,{children:"Local Jupyter Server"}),(0,S.jsxs)(b.A,{children:[s.local.serverSettings.baseUrl," -"," ",s.local.serverSettings.wsUrl]}),(0,S.jsxs)(b.A,{mt:3,children:[(0,S.jsx)(b.A,{children:"Local Kernels [ id | name | last_activity | execution_state | connections ]"}),i?.map((e=>(0,S.jsx)(b.A,{children:(0,S.jsxs)(b.A,{children:[e.id," | ",e.name," | ",e.last_activity," |"," ",e.execution_state," | ",e.connections,(0,S.jsx)(X.A,{sx:{marginLeft:1},href:"",onClick:t=>{var n;t.preventDefault(),n=e.id,s.local.kernels.shutdown(n).then((()=>{r(`Kernel ${n} is terminated.`,{variant:"info"}),console.log(`Kernel ${n} is terminated.`),y()}))},children:"delete"})]})},e.id)))]}),(0,S.jsxs)(b.A,{mt:3,children:[(0,S.jsx)(b.A,{children:"Local Sessions [ id | name | path | type | kernel_id | kernel_name ]"}),o?.map((e=>(0,S.jsx)(b.A,{children:(0,S.jsxs)(b.A,{children:[e.id," | ",e.name," | ",e.path," |"," ",e.type," | ",e.kernel?.id," |"," ",e.kernel?.name,(0,S.jsx)(X.A,{href:"",sx:{marginLeft:1},onClick:t=>{var n;t.preventDefault(),n=e.id,s.local.sessions.shutdown(n).then((()=>{r(`Session ${n} is terminated.`,{variant:"info"}),console.log(`Session ${n} is terminated.`),y()}))},children:"delete"})]})},e.id)))]})]}),s&&s.remote&&h&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(b.A,{mt:3,children:"Remote Jupyter Server"}),(0,S.jsxs)(b.A,{children:[s.remote.serverSettings.baseUrl," -"," ",s.remote.serverSettings.wsUrl]}),(0,S.jsxs)(b.A,{mt:3,children:[(0,S.jsx)(b.A,{children:"Remote Runtimes [ id | name | last_activity | execution_state | connections ]"}),h.map((e=>(0,S.jsx)(b.A,{children:(0,S.jsxs)(b.A,{children:[e.id," | ",e.name," | ",e.last_activity," |"," ",e.execution_state," | ",e.connections,(0,S.jsx)(X.A,{sx:{marginLeft:1},href:"",onClick:t=>{var n;t.preventDefault(),n=e.id,s.remote?.kernels.shutdown(n).then((()=>{r(`Kernel ${n} is terminated.`,{variant:"info"}),console.log(`Kernel ${n} is terminated.`),y()}))},children:"delete"})]})},e.id)))]})]}),p&&(0,S.jsx)(Z.W,{children:(0,S.jsx)(te,{boxPanel:p})})]})};var se=n(69895),re=n(99768),ie=n(94009),ae=n(29745),oe=n(69763),le=n(77544),ce=n(75147);const de=e=>{const{version:t}=e;return(0,S.jsx)(ce.a,{version:t,title:"Jupyter Runtimes",icon:(0,S.jsx)(le.A,{colored:!0,size:42}),description:"ðŸª âšª Jupyter Runtimes scales your Jupyter in the cloud."})};var he=n(94657),ue=n(91676),pe=n(7652);const me="jupyter/kernels";function ge(e){const{memoryRouter:t=!1,baseRoute:n="",jupyterLabAdapter:r}=e,{configuration:i}=(0,p._O)(),{externalToken:o,user:l}=(0,m.Y)(),{checkIsPlatformUsageReviewer:v}=(0,y.x)(),{version:x,remoteKernels:b,setMultiServiceManager:w}=(0,g.xb)(),{enqueueToast:j}=(0,f.d)(),k=(0,s.zy)(),C=k.state??{},A=(0,_.Z)();if((0,c.useEffect)((()=>{r&&w(r.jupyterLab.serviceManager)}),[r]),(0,c.useEffect)((()=>{const e=setTimeout((()=>{l||A(a.URLExt.join("/",n,me,"login"))}),2e3);return()=>{clearTimeout(e)}}),[l]),!t){const e=new Set;(0,d.$$)((()=>{b.forEach((t=>{!e.has(t.jupyter_pod_name)&&t.expired_at&&1e3*parseFloat(t.expired_at)-Date.now()<m.zo&&(j(`Reservation for kernel '${t.kernel_given_name}' is going to end in less than ${(m.zo/6e4).toFixed(0)} minutes.`,{variant:"warning",actions:[{label:"Show moreâ€¦",callback:()=>{A(n)}}]}),e.add(t.jupyter_pod_name))}));const t=b.map((e=>e.jupyter_pod_name));[...e].forEach((n=>{t.includes(n)||e.delete(n)}))}),6e4)}return C.backgroundLocation&&!o&&console.error("Modal will not be displayed due to missing external token."),(0,S.jsxs)(h.N,{inJupyterLab:t,children:[(0,S.jsxs)(s.BV,{location:C.backgroundLocation??k,children:[(0,S.jsx)(s.qh,{path:n,element:(0,S.jsx)(s.C5,{to:a.URLExt.join("/",n,me)})}),(0,S.jsx)(s.qh,{path:a.URLExt.join("/",n,me),element:(0,S.jsx)(u.z,{baseURL:a.URLExt.join(n,me),children:(0,S.jsx)(s.sv,{})}),children:l?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.qh,{index:!0,element:(0,S.jsx)(Y,{})}),(0,S.jsx)(s.qh,{path:"runtimes",element:(0,S.jsx)(Q.O,{version:x})}),(0,S.jsx)(s.qh,{path:"runtimes/new",element:(0,S.jsx)(Q.O,{version:x,openLaunchKernels:!0})}),(0,S.jsx)(s.qh,{path:"environments",element:(0,S.jsx)(se.B,{})}),(0,S.jsx)(s.qh,{path:"login",element:(0,S.jsx)(s.C5,{to:a.URLExt.join("/",n,me)})}),(0,S.jsxs)(s.qh,{path:pe.lx,element:(0,S.jsx)(O.pp,{baseRoute:n}),children:[(0,S.jsx)(s.qh,{index:!0,element:(0,S.jsx)(s.C5,{to:"overview"})}),(0,S.jsx)(s.qh,{path:"overview",element:(0,S.jsx)(K.r,{})}),(0,S.jsx)(s.qh,{path:"reservations",element:(0,S.jsx)(U.r,{})}),(0,S.jsx)(s.qh,{path:"history",element:(0,S.jsx)($.V,{})}),(0,S.jsx)(s.qh,{path:"checkout",element:(0,S.jsx)(oe.O,{})}),v(l)&&(0,S.jsx)(s.qh,{path:"platform",element:(0,S.jsx)(V.$,{})})]}),!i?.whiteLabel&&(0,S.jsx)(s.qh,{path:"settings",element:(0,S.jsx)(ie.w,{})}),(0,S.jsx)(s.qh,{path:pe.lS,element:(0,S.jsx)(he.wX,{})}),(0,S.jsx)(s.qh,{path:a.URLExt.join(pe.uP,pe.lS),element:(0,S.jsx)(he.wX,{})}),(0,S.jsx)(s.qh,{path:pe.uP,element:(0,S.jsx)(ue.q,{})}),(0,S.jsx)(s.qh,{path:"about",element:(0,S.jsx)(de,{version:x})}),(0,S.jsx)(s.qh,{path:"docs",element:(0,S.jsx)(re.H,{})}),!i?.whiteLabel&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.qh,{path:"debug",element:(0,S.jsx)(ne,{version:x})}),(0,S.jsx)(s.qh,{path:"content",element:(0,S.jsx)(ae.U,{})}),(0,S.jsx)(s.qh,{path:"profile",element:(0,S.jsx)(I.a,{})}),(0,S.jsx)(s.qh,{path:"logout",element:(0,S.jsx)(M.f,{homeRoute:a.URLExt.join("/",n,me)})})]})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.qh,{index:!0,element:(0,S.jsx)(s.C5,{to:"login"})}),(0,S.jsx)(s.qh,{path:"login",element:(0,S.jsx)(E.a,{heading:i?.whiteLabel?"Login":"Login to Datalayer",homeRoute:a.URLExt.join("/",n,me),loginRoute:a.URLExt.join("/",n,me,"login"),passwordRoute:a.URLExt.join("/",n,me,"password"),joinRoute:i?.whiteLabel?void 0:a.URLExt.join("/",n,me,"join"),joinConfirmRoute:i?.whiteLabel?void 0:a.URLExt.join("/",n,me,"join","confirm"),showEmailLogin:!i?.whiteLabel,showGitHubLogin:!i?.whiteLabel,showTokenLogin:!0})}),(0,S.jsx)(s.qh,{path:"password",element:(0,S.jsx)(P.U,{passwordConfirmRoute:a.URLExt.join("/",n,me,"password","confirm")})}),(0,S.jsx)(s.qh,{path:"password/confirm",element:(0,S.jsx)(N.y,{loginRoute:a.URLExt.join("/",n,me,"login"),passwordWelcomeRoute:a.URLExt.join("/",n,me,"password","welcome")})}),(0,S.jsx)(s.qh,{path:"password/welcome",element:(0,S.jsx)(D.Q,{loginRoute:a.URLExt.join("/",n,me,"login")})}),!1===i?.whiteLabel&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.qh,{path:"join",element:(0,S.jsx)(T.n,{joinConfirmRoute:a.URLExt.join("/",n,me,"join","confirm")})}),(0,S.jsx)(s.qh,{path:"join/confirm",element:(0,S.jsx)(F.J,{loginRoute:a.URLExt.join("/",n,me,"password","login"),joinWelcomeRoute:a.URLExt.join("/",n,me,"join","welcome")})}),(0,S.jsx)(s.qh,{path:"join/welcome",element:(0,S.jsx)(L.D,{loginRoute:a.URLExt.join("/",n,me,"login")})})]})]})})]}),C.backgroundLocation&&(0,S.jsx)(s.BV,{children:(0,S.jsx)(s.qh,{path:a.URLExt.join("/",n,"anaconda/increaseCreditsLimit"),element:o?(0,S.jsx)(R,{}):null})})]})}function ye(e){const{memoryRouter:t=!1,baseRoute:n=""}=e;return(0,S.jsx)(S.Fragment,{children:t?(0,S.jsx)(o.w2,{children:(0,S.jsx)(s.fS,{initialEntries:[a.URLExt.join("/",n)],children:(0,S.jsx)(ge,{...e})})}):(0,S.jsxs)(l.cG,{children:[(0,S.jsx)(r.Kd,{children:(0,S.jsx)(ge,{...e})}),(0,S.jsx)(i.ToastContainer,{})]})})}},94009:(e,t,n)=>{n.d(t,{w:()=>u});var s=n(98754),r=n(76818),i=n(29187),a=n(97096),o=n(8586),l=n(99180),c=n(50906),d=n(18683);const h=e=>{const{k:t,v:n,code:i}=e;return(0,d.jsxs)(s.A,{sx:{color:"fg.onEmphasis",bg:"neutral.emphasis",p:2},children:[(0,d.jsxs)(r.A,{children:[t,":Â "]}),(0,d.jsx)(r.A,{as:i?"code":"span",style:{overflowWrap:"anywhere"},children:n})]})},u=()=>{const e=(0,c.mt)(),t=e.core().configuration;return(0,d.jsxs)(i.M,{containerWidth:"full",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,d.jsx)(i.M.Header,{children:(0,d.jsx)(a.z,{children:(0,d.jsx)(a.z.TitleArea,{variant:"large",children:(0,d.jsx)(a.z.Title,{children:"Settings"})})})}),(0,d.jsxs)(i.M.Content,{children:[(0,d.jsx)(o.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",mb:2},children:"User"}),(0,d.jsx)(h,{k:"Display Name",v:e.iam().user?.displayName}),(0,d.jsx)(h,{k:"Email",v:e.iam().user?.email}),(0,d.jsx)(h,{k:"Roles",v:e.iam().user?.roles.toString()}),(0,d.jsx)(h,{k:"Token",v:e.iam().token,code:!0}),(0,d.jsx)(h,{k:"External Token",v:e.iam().externalToken,code:!0}),(0,d.jsx)(h,{k:"Credits Available",v:e.iam().credits?.available}),(0,d.jsx)(h,{k:"Credits Quota",v:e.iam().credits?.quota??""}),(0,d.jsx)(h,{k:"Credits Customer ID",v:e.iam().user?.creditsCustomerId}),(0,d.jsx)(o.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",mb:2},children:"Configuration"}),(0,d.jsx)(h,{k:"IAM RUN URL",v:t.iamRunUrl}),(0,d.jsx)(h,{k:"Jupyter RUN URL",v:t.jupyterRunUrl}),(0,d.jsx)(h,{k:"Spacer RUN URL",v:t.spacerRunUrl}),(0,d.jsx)(h,{k:"Library RUN URL",v:t.libraryRunUrl}),(0,d.jsx)(h,{k:"AI Agents RUN URL",v:t.aiagentsRunUrl}),(0,d.jsx)(h,{k:"Success RUN URL",v:t.successRunUrl}),(0,d.jsx)(h,{k:"White Label",v:String(t.whiteLabel)}),(0,d.jsx)(o.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mt:2,mb:2},children:"Danger zone"}),(0,d.jsxs)(s.A,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,display:"flex",alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,d.jsxs)(s.A,{sx:{display:"grid",gap:1},children:[(0,d.jsx)(r.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Delete account"}),(0,d.jsx)(r.A,{sx:{fontSize:1,color:"fg.muted"},children:"Are you sure you don't want to just downgrade your account to a free account? We won't charge your credit card anymore."})]}),(0,d.jsx)(l.Q,{variant:"danger",disabled:!0,children:"Delete account"})]})]})]})}},78269:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAsElEQVQIHQGlAFr/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7+r3zKmT0/+pk9P/7+r3zAAAAAAAAAAABAAAAAAAAAAA6OPzM+/q9wAAAAAA6OPzMwAAAAAAAAAAAgAAAAAAAAAAGR8NiRQaCgAZIA0AGR8NiQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQyoYJ/SY80UAAAAASUVORK5CYII="},22426:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOCAxOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTggMTg7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDpub25lO30KPC9zdHlsZT4KPHBhdGggZD0iTTUuMiw1LjlMOSw5LjdsMy44LTMuOGwxLjIsMS4ybC00LjksNWwtNC45LTVMNS4yLDUuOXoiLz4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAtMC42aDE4djE4SDBWLTAuNnoiLz4KPC9zdmc+Cg"}}]);