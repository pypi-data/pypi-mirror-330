default:
  # all jobs are, by default, interruptible
  interruptible: true
  # retry all jobs at most twice when gitlab-ci fails to start the job properly
  # see https://docs.gitlab.com/ee/ci/yaml/#retry
  retry:
    max: 2
    when:
      - runner_system_failure

variables:
  # run the tests that talk to the internet
  PYTEST_ADDOPTS: "--remote-data"

include:
  # -- Python -------------------------

  # https://computing.docs.ligo.org/guide/gitlab/components/python/all/
  - component: $CI_SERVER_FQDN/computing/gitlab/components/python/all@2
    inputs:
      python_versions:
        - "3.9"
        - "3.10"
        - "3.11"
        - "3.12"
        - "3.13"
      install_extra: "scitokens,test"
      code_quality_analyzer: "ruff"
      run_advanced_sast: true

  # https://computing.docs.ligo.org/guide/gitlab/components/python/type-checking/
  - component: $CI_SERVER_FQDN/computing/gitlab/components/python/type-checking@2

  # -- Documentation ------------------

  # https://computing.docs.ligo.org/guide/gitlab/components/sphinx/build/
  - component: $CI_SERVER_FQDN/computing/gitlab/components/sphinx/build@1
    inputs:
      requirements: ".[docs,scitokens]"
