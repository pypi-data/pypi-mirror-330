build:epwpy:
  tags: [saas-linux-medium-amd64]
  image: ubuntu:24.04
  script:
    - apt-get -qq update
    - apt-get -qq install m4 make wget curl git gfortran gcc libopenblas-dev libfftw3-dev libopenmpi-dev tar libxrender1
    - apt-get -yq install python3.12
    - apt-get -yq install mpich python3-pip
    - ln -sf /usr/bin/python3.12 /usr/bin/python3
    - which python3
    #- #python3 -m 
    - pip3 install numpy --break-system-packages
    #- pip3 install --upgrade pip --break-system-packages
    - pip3 install cython pytest requests alive_progress plotly dash-bio dash mp_api --break-system-packages 
    - pip3 install https://github.com/enthought/mayavi/zipball/master --break-system-packages
    - cd test-suite
    - mkdir build 
    - cd build
    - wget https://gitlab.com/epw/q-e/-/archive/EPW-5.9s/q-e-EPW-5.9s.tar.gz 
    - tar -xvzf q-e-EPW-5.9s.tar.gz
    - mv q-e-EPW-5.9s q-e
    - cd q-e
    - ./configure
    - make epw -j 2
    - cd ../../
    - mkdir /tmp/save
    - make test
    - make clean_cluster 
    #- #./configure
    #- #make epw -j 2
    #- #export OMP_NUM_THREADS=1
    #- #cd test-suite
    #- #mkdir /tmp/save
    #- #make run-tests-epw
    #- #rm -r /tmp/save
